define(["require","../module","text!./viewport.xml","../layers/index","../histogram/index","./viewport","qpf"],function(e){function p(){c=this.renderer,f&&clearInterval(f),l&&clearInterval(l),f=setInterval(v,100)}function d(){c&&c.setSize(this.width(),this.height())}function v(){a.trigger("beforerender"),h.render(c),i.update(c.domElement)}var t=e("../module"),n=e("text!./viewport.xml"),r=e("../layers/index"),i=e("../histogram/index"),s=e("./viewport"),o=e("qpf"),u=o.use("knockout"),a=new t({name:"viewport",xml:n,applyFilter:u.observable(!0),onRender:p,onResize:d,texture:new THREE.Texture,resize:function(){var e=a.texture.image,t=e.height/e.width;if(a.mainComponent&&a.mainComponent.parent){var n=a.mainComponent,r=n.parent.width(),i=n.parent.height();t<1?(n.$el.css({"margin-top":(i-r*t)/2+"px","margin-left":"0px"}),n.height(r*t),n.width(r)):(n.$el.css({"margin-left":(r-i/t)/2,"margin-top":"0px"}),n.width(i/t),n.height(i))}},setImage:function(e){var t=this;if(typeof e=="string"){var n=new Image;n.onload=function(){t.texture.needsUpdate=!0,t.resize()},n.src=e,this.texture.image=n}else this.texture.image=e,e.width?(t.texture.needsUpdate=!0,t.resize()):e.onload=function(){t.texture.needsUpdate=!0,t.resize()}}});a.on("start",function(){a.setImage("../file_upload/1.jpg")});var f=0,l=0,c,h=r.manager;return h.texture=a.texture,u.computed(function(){h.enable(a.applyFilter()),a.applyFilter(h.enable())}),a});