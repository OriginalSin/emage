define(["require","qpf","../module","./list.js","text!./listmodule.xml","../common/modal"],function(e){var t=e("qpf"),n=e("../module"),r=e("./list.js"),i=e("text!./listmodule.xml"),s=t.use("knockout"),o=t.use("components/meta/textfield"),u=e("../common/modal"),a=n.derive(function(){var e=this;return{xml:i,addItemUrl:function(){},fetchListUrl:function(){},fetchDetailUrl:function(){},makeItemHref:function(e){},icon:"",isSelected:function(e){},add:function(){var t=new o({attributes:{width:300},temporary:!0});u.popup("新建",t,function(n){$.post(e.addItemUrl(),{title:t.text()},function(t){e.list.push(e._preProcessData(t)),n()})},function(e){e()})},list:s.observableArray(),id:s.observable(""),title:s.observable("")}},{initialize:function(){var e=this;s.computed(function(){this.loadingStart(),this.list([]),this.title(".....");var t=e.fetchListUrl(),n=e.fetchDetailUrl();t&&n&&($.get(t,function(t){e.loadingEnd(),e.list(e._preProcessData(t))}),$.get(n,function(t){e.title(t.title)}))},this)},_preProcessData:function(e){var t=this;if(e.constructor===Array){var n=[];return _.each(e,function(e,r){n.push(t._preProcessData(e))},this),n}return e.href=t.makeItemHref(e),e.icon=t.icon,t.isSelected(e)&&(e.selected=!0),e}});return a});