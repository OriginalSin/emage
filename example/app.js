/**
 * almond 0.2.5 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

// Knockout JavaScript library v2.2.1
// (c) Steven Sanderson - http://knockoutjs.com/
// License: MIT (http://www.opensource.org/licenses/mit-license.php)

/// Knockout Mapping plugin v2.3.5
/// (c) 2012 Steven Sanderson, Roy Jacobs - http://knockoutjs.com/
/// License: MIT (http://www.opensource.org/licenses/mit-license.php)

/**
 * @license RequireJS text 2.0.5 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

//     Underscore.js 1.4.4
//     http://underscorejs.org
//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore may be freely distributed under the MIT license.

/* Copyright (c) 2013, Brandon Jones, Colin MacKenzie IV. All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  * Redistributions of source code must retain the above copyright notice, this
    list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright notice,
    this list of conditions and the following disclaimer in the documentation 
    and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE 
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. */

(function(e){typeof define!="undefined"&&define.amd?define("qpf",["exports"],e):e(window.qpf={})})(function(e){var t,n,r;(function(e){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(t,n){return function(){return s.apply(e,p.call(arguments,0).concat([t,n]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(t){if(d(f,t)){var n=f[t];delete f[t],c[t]=!0,i.apply(e,n)}if(!d(a,t)&&!d(c,t))throw new Error("No "+t);return a[t]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(t,n,r,i){var s,l,h,p,v,g=[],w;i=i||t;if(typeof r=="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(v=0;v<n.length;v+=1){p=o(n[v],i),l=p.f;if(l==="require")g[v]=u.require(t);else if(l==="exports")g[v]=u.exports(t),w=!0;else if(l==="module")s=g[v]=u.module(t);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=r.apply(a[t],g);if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!w)a[t]=h}else t&&(a[t]=r)},t=n=s=function(t,n,r,a,f){return typeof t=="string"?u[t]?u[t](n):b(o(t,n).f):(t.splice||(l=t,n.splice?(t=n,n=r,r=null):t=e),n=n||function(){},typeof r=="function"&&(r=a,a=f),a?i(e,t,n,r):setTimeout(function(){i(e,t,n,r)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},r=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},r.amd={jQuery:!0}})(),r("build/almond",[],function(){}),r("core/xmlparser",["require","exports","module"],function(e,t,n){function i(e){var t,n;try{return window.DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)),t}catch(r){console.error("Invalid XML:"+e)}}function o(e,t){s[e]=t}function u(e){if(e.nodeType===1){var t={type:e.tagName.toLowerCase()},n=a(e.attributes),r=s[t.type];if(r){var i=r(e);i&&typeof i!="object"?console.error("Parser must return an object converted from attributes"):_.extend(n,i)}var o=f(n,t),u=document.createElement("div");return u.setAttribute("data-bind","qpf:"+o),u}if(e.nodeType===8)return;return}function a(e){var t={};for(var n=0;n<e.length;n++){var r=e[n];t[r.nodeName]=r.nodeValue}return t}function f(e,t){t=t||{};var n=function(e,t){_.each(e,function(e,r){if(e.constructor==Array)t[r]=[],n(e,t[r]);else if(e.constructor==Object)t[r]={},n(e,t[r]);else if(typeof e!="undefined"){var i=/^\s*@binding\[(.*?)\]\s*$/.exec(e);i&&(e="{{BINDINGSTART"+i[1]+"BINDINGEND}}"),t[r]=e}})};n(e,t);var r=JSON.stringify(t);return r=r.replace(/\"\{\{BINDINGSTART(.*?)BINDINGEND\}\}\"/g,"$1"),r}function l(e,t){var n=c(e);for(var r=0;r<n.length;r++){var i=u(n[r]);i&&(t.appendChild(i),l(n[r],i))}}function c(e){var t=[],n=e.firstChild;while(n)t.push(n),n=n.nextSibling;return t}function h(e,t){var n=c(e);return _.filter(n,function(e){return e.tagName&&e.tagName.toLowerCase()===t})}function p(e){var t=c(e),n="";return _.each(t,function(e){e.nodeType==3&&(n+=e.textContent.replace(/(^\s*)|(\s*$)/g,""))}),n}var r=function(e,t){if(typeof e=="string")var n=i(e);else var n=e;if(n){var r=t||document.createElement("div");return l(n,r),r}},s={};t.parse=r,t.provideParser=o,t.util={convertAttributes:a,objectToDataBindingFormat:f,getChildren:c,getChildrenByTagName:h,getTextContent:p}}),r("core/mixin/derive",[],function(){function e(e,t,n){typeof t=="object"&&(n=t,t=null);var r={"instanceof":function(e){var t=s;while(t){if(t===e)return!0;t=t.__super__}}},i=this,s=function(n){i.call(this),_.extend(this,typeof e=="function"?e.call(this):e),_.extend(this,n);if(this.constructor==s){var r=s,o=[t];while(r.__super__)r=r.__super__,o.unshift(r.__initialize__);for(var u=0;u<o.length;u++)o[u]&&o[u].call(this)}};return s.__super__=i,s.__initialize__=t,_.extend(s.prototype,i.prototype,r,n),s.prototype.constructor=s,s.derive=i.derive,s}return{derive:e}}),r("core/mixin/event",[],function(){return{trigger:function(){if(!this.__handlers__)return;var e=arguments[0],t=Array.prototype.slice.call(arguments,1),n=this.__handlers__[e];if(n)for(var r=0;r<n.length;r+=2){var i=n[r],s=n[r+1];i.apply(s||this,t)}},on:function(e,t,n){if(!e)return;var r=this.__handlers__||(this.__handlers__={});return r[e]||(r[e]=[]),r[e].indexOf(t)==-1&&(r[e].push(t),r[e].push(n)),t},off:function(e,t){var n=this.__handlers__||(this.__handlers__={});if(n[e])if(t){var r=n[e],i=r.indexOf(t);i>=0&&r.splice(i,2)}else n[e]=[]}}}),r("core/clazz",["require","./mixin/derive","./mixin/event"],function(e){var t=e("./mixin/derive"),n=e("./mixin/event"),r=new Function;return _.extend(r,t),_.extend(r.prototype,n),r}),function(){var e=!0;(function(t,i,s,o,u){!function(e){if(typeof n=="function"&&typeof exports=="object"&&typeof module=="object"){var i=module.exports||exports;e(i)}else typeof r=="function"&&r.amd?r("knockout",["exports"],e):e(t.ko={})}(function(n){function a(e){var t=this;if(e)for(var n in e){var i=r.extenders[n];typeof i=="function"&&(t=i(t,e[n]))}return t}function v(e){r.bindingHandlers[e]={init:function(t,n,i,s){var o=function(){var t={};return t[e]=n(),t};return r.bindingHandlers.event.init.call(this,t,o,i,s)}}}function y(e,t,n,i){r.bindingHandlers[e]={init:function(e,t,n,i,s){return r.utils.domData.set(e,g,{}),{controlsDescendantBindings:!0}},update:function(e,s,o,u,a){var f=r.utils.domData.get(e,g),l=r.utils.unwrapObservable(s()),c=!n!=!l,h=!f.savedNodes,p=h||t||c!==f.didDisplayOnLastUpdate;p&&(h&&(f.savedNodes=r.utils.cloneNodes(r.virtualElements.childNodes(e),!0)),c?(h||r.virtualElements.setDomNodeChildren(e,r.utils.cloneNodes(f.savedNodes)),r.applyBindingsToDescendants(i?i(a,l):a,e)):r.virtualElements.emptyNode(e),f.didDisplayOnLastUpdate=c)}},r.expressionRewriting.bindingRewriteValidators[e]=!1,r.virtualElements.allowedBindings[e]=!0}function b(e,t,n){n&&t!==r.selectExtensions.readValue(e)&&r.selectExtensions.writeValue(e,t),t!==r.selectExtensions.readValue(e)&&r.dependencyDetection.ignore(r.utils.triggerEvent,null,[e,"change"])}var r=typeof n!="undefined"?n:{};r.exportSymbol=function(e,t){var n=e.split("."),i=r;for(var s=0;s<n.length-1;s++)i=i[n[s]];i[n[n.length-1]]=t},r.exportProperty=function(e,t,n){e[t]=n},r.version="2.2.1",r.exportSymbol("version",r.version),r.utils=new function(){function y(e,t){if(r.utils.tagNameLower(e)!=="input"||!e.type)return!1;if(t.toLowerCase()!="click")return!1;var n=e.type;return n=="checkbox"||n=="radio"}var e=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,n={},a={},f=/Firefox\/2/i.test(s.userAgent)?"KeyboardEvent":"UIEvents";n[f]=["keyup","keydown","keypress"],n.MouseEvents=["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave"];for(var l in n){var c=n[l];if(c.length)for(var h=0,p=c.length;h<p;h++)a[c[h]]=l}var d={propertychange:!0},v=function(){var e=3,t=i.createElement("div"),n=t.getElementsByTagName("i");while(t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",n[0]);return e>4?e:u}(),m=v===6,g=v===7;return{fieldsIncludedWithJsonPost:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],arrayForEach:function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n])},arrayIndexOf:function(e,t){if(typeof Array.prototype.indexOf=="function")return Array.prototype.indexOf.call(e,t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},arrayFirst:function(e,t,n){for(var r=0,i=e.length;r<i;r++)if(t.call(n,e[r]))return e[r];return null},arrayRemoveItem:function(e,t){var n=r.utils.arrayIndexOf(e,t);n>=0&&e.splice(n,1)},arrayGetDistinctValues:function(e){e=e||[];var t=[];for(var n=0,i=e.length;n<i;n++)r.utils.arrayIndexOf(t,e[n])<0&&t.push(e[n]);return t},arrayMap:function(e,t){e=e||[];var n=[];for(var r=0,i=e.length;r<i;r++)n.push(t(e[r]));return n},arrayFilter:function(e,t){e=e||[];var n=[];for(var r=0,i=e.length;r<i;r++)t(e[r])&&n.push(e[r]);return n},arrayPushAll:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var n=0,r=t.length;n<r;n++)e.push(t[n]);return e},extend:function(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},emptyDomNode:function(e){while(e.firstChild)r.removeNode(e.firstChild)},moveCleanedNodesToContainerElement:function(e){var t=r.utils.makeArray(e),n=i.createElement("div");for(var s=0,o=t.length;s<o;s++)n.appendChild(r.cleanNode(t[s]));return n},cloneNodes:function(e,t){for(var n=0,i=e.length,s=[];n<i;n++){var o=e[n].cloneNode(!0);s.push(t?r.cleanNode(o):o)}return s},setDomNodeChildren:function(e,t){r.utils.emptyDomNode(e);if(t)for(var n=0,i=t.length;n<i;n++)e.appendChild(t[n])},replaceDomNodes:function(e,t){var n=e.nodeType?[e]:e;if(n.length>0){var i=n[0],s=i.parentNode;for(var o=0,u=t.length;o<u;o++)s.insertBefore(t[o],i);for(var o=0,u=n.length;o<u;o++)r.removeNode(n[o])}},setOptionNodeSelectionState:function(e,t){v<7?e.setAttribute("selected",t):e.selected=t},stringTrim:function(t){return(t||"").replace(e,"")},stringTokenize:function(e,t){var n=[],i=(e||"").split(t);for(var s=0,o=i.length;s<o;s++){var u=r.utils.stringTrim(i[s]);u!==""&&n.push(u)}return n},stringStartsWith:function(e,t){return e=e||"",t.length>e.length?!1:e.substring(0,t.length)===t},domNodeIsContainedBy:function(e,t){if(t.compareDocumentPosition)return(t.compareDocumentPosition(e)&16)==16;while(e!=null){if(e==t)return!0;e=e.parentNode}return!1},domNodeIsAttachedToDocument:function(e){return r.utils.domNodeIsContainedBy(e,e.ownerDocument)},tagNameLower:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},registerEventHandler:function(e,t,n){var r=v&&d[t];if(!r&&typeof o!="undefined"){if(y(e,t)){var i=n;n=function(e,t){var n=this.checked;t&&(this.checked=t.checkedStateBeforeEvent!==!0),i.call(this,e),this.checked=n}}o(e).bind(t,n)}else if(!r&&typeof e.addEventListener=="function")e.addEventListener(t,n,!1);else{if(typeof e.attachEvent=="undefined")throw new Error("Browser doesn't support addEventListener or attachEvent");e.attachEvent("on"+t,function(t){n.call(e,t)})}},triggerEvent:function(e,n){if(!e||!e.nodeType)throw new Error("element must be a DOM node when calling triggerEvent");if(typeof o!="undefined"){var r=[];y(e,n)&&r.push({checkedStateBeforeEvent:e.checked}),o(e).trigger(n,r)}else if(typeof i.createEvent=="function"){if(typeof e.dispatchEvent!="function")throw new Error("The supplied element doesn't support dispatchEvent");var s=a[n]||"HTMLEvents",u=i.createEvent(s);u.initEvent(n,!0,!0,t,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(u)}else{if(typeof e.fireEvent=="undefined")throw new Error("Browser doesn't support triggering events");y(e,n)&&(e.checked=e.checked!==!0),e.fireEvent("on"+n)}},unwrapObservable:function(e){return r.isObservable(e)?e():e},peekObservable:function(e){return r.isObservable(e)?e.peek():e},toggleDomNodeCssClass:function(e,t,n){if(t){var i=/[\w-]+/g,s=e.className.match(i)||[];r.utils.arrayForEach(t.match(i),function(e){var t=r.utils.arrayIndexOf(s,e);t>=0?n||s.splice(t,1):n&&s.push(e)}),e.className=s.join(" ")}},setTextContent:function(e,t){var n=r.utils.unwrapObservable(t);if(n===null||n===u)n="";if(e.nodeType===3)e.data=n;else{var s=r.virtualElements.firstChild(e);!s||s.nodeType!=3||r.virtualElements.nextSibling(s)?r.virtualElements.setDomNodeChildren(e,[i.createTextNode(n)]):s.data=n,r.utils.forceRefresh(e)}},setElementName:function(e,t){e.name=t;if(v<=7)try{e.mergeAttributes(i.createElement("<input name='"+e.name+"'/>"),!1)}catch(n){}},forceRefresh:function(e){if(v>=9){var t=e.nodeType==1?e:e.parentNode;t.style&&(t.style.zoom=t.style.zoom)}},ensureSelectElementIsRenderedCorrectly:function(e){if(v>=9){var t=e.style.width;e.style.width=0,e.style.width=t}},range:function(e,t){e=r.utils.unwrapObservable(e),t=r.utils.unwrapObservable(t);var n=[];for(var i=e;i<=t;i++)n.push(i);return n},makeArray:function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(e[n]);return t},isIe6:m,isIe7:g,ieVersion:v,getFormFields:function(e,t){var n=r.utils.makeArray(e.getElementsByTagName("input")).concat(r.utils.makeArray(e.getElementsByTagName("textarea"))),i=typeof t=="string"?function(e){return e.name===t}:function(e){return t.test(e.name)},s=[];for(var o=n.length-1;o>=0;o--)i(n[o])&&s.push(n[o]);return s},parseJson:function(e){if(typeof e=="string"){e=r.utils.stringTrim(e);if(e)return t.JSON&&t.JSON.parse?t.JSON.parse(e):(new Function("return "+e))()}return null},stringifyJson:function(e,t,n){if(typeof JSON=="undefined"||typeof JSON.stringify=="undefined")throw new Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return JSON.stringify(r.utils.unwrapObservable(e),t,n)},postJson:function(e,t,n){n=n||{};var s=n.params||{},o=n.includeFields||this.fieldsIncludedWithJsonPost,u=e;if(typeof e=="object"&&r.utils.tagNameLower(e)==="form"){var a=e;u=a.action;for(var f=o.length-1;f>=0;f--){var l=r.utils.getFormFields(a,o[f]);for(var c=l.length-1;c>=0;c--)s[l[c].name]=l[c].value}}t=r.utils.unwrapObservable(t);var h=i.createElement("form");h.style.display="none",h.action=u,h.method="post";for(var p in t){var d=i.createElement("input");d.name=p,d.value=r.utils.stringifyJson(r.utils.unwrapObservable(t[p])),h.appendChild(d)}for(var p in s){var d=i.createElement("input");d.name=p,d.value=s[p],h.appendChild(d)}i.body.appendChild(h),n.submitter?n.submitter(h):h.submit(),setTimeout(function(){h.parentNode.removeChild(h)},0)}}},r.exportSymbol("utils",r.utils),r.exportSymbol("utils.arrayForEach",r.utils.arrayForEach),r.exportSymbol("utils.arrayFirst",r.utils.arrayFirst),r.exportSymbol("utils.arrayFilter",r.utils.arrayFilter),r.exportSymbol("utils.arrayGetDistinctValues",r.utils.arrayGetDistinctValues),r.exportSymbol("utils.arrayIndexOf",r.utils.arrayIndexOf),r.exportSymbol("utils.arrayMap",r.utils.arrayMap),r.exportSymbol("utils.arrayPushAll",r.utils.arrayPushAll),r.exportSymbol("utils.arrayRemoveItem",r.utils.arrayRemoveItem),r.exportSymbol("utils.extend",r.utils.extend),r.exportSymbol("utils.fieldsIncludedWithJsonPost",r.utils.fieldsIncludedWithJsonPost),r.exportSymbol("utils.getFormFields",r.utils.getFormFields),r.exportSymbol("utils.peekObservable",r.utils.peekObservable),r.exportSymbol("utils.postJson",r.utils.postJson),r.exportSymbol("utils.parseJson",r.utils.parseJson),r.exportSymbol("utils.registerEventHandler",r.utils.registerEventHandler),r.exportSymbol("utils.stringifyJson",r.utils.stringifyJson),r.exportSymbol("utils.range",r.utils.range),r.exportSymbol("utils.toggleDomNodeCssClass",r.utils.toggleDomNodeCssClass),r.exportSymbol("utils.triggerEvent",r.utils.triggerEvent),r.exportSymbol("utils.unwrapObservable",r.utils.unwrapObservable),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments),e=n.shift();return function(){return t.apply(e,n.concat(Array.prototype.slice.call(arguments)))}}),r.utils.domData=new function(){var e=0,t="__ko__"+(new Date).getTime(),n={};return{get:function(e,t){var n=r.utils.domData.getAll(e,!1);return n===u?u:n[t]},set:function(e,t,n){if(n===u&&r.utils.domData.getAll(e,!1)===u)return;var i=r.utils.domData.getAll(e,!0);i[t]=n},getAll:function(r,i){var s=r[t],o=s&&s!=="null"&&n[s];if(!o){if(!i)return u;s=r[t]="ko"+e++,n[s]={}}return n[s]},clear:function(e){var r=e[t];return r?(delete n[r],e[t]=null,!0):!1}}},r.exportSymbol("utils.domData",r.utils.domData),r.exportSymbol("utils.domData.clear",r.utils.domData.clear),r.utils.domNodeDisposal=new function(){function i(t,n){var i=r.utils.domData.get(t,e);return i===u&&n&&(i=[],r.utils.domData.set(t,e,i)),i}function s(t){r.utils.domData.set(t,e,u)}function a(e){var t=i(e,!1);if(t){t=t.slice(0);for(var s=0;s<t.length;s++)t[s](e)}r.utils.domData.clear(e),typeof o=="function"&&typeof o["cleanData"]=="function"&&o.cleanData([e]),n[e.nodeType]&&f(e)}function f(e){var t,n=e.firstChild;while(t=n)n=t.nextSibling,t.nodeType===8&&a(t)}var e="__ko_domNodeDisposal__"+(new Date).getTime(),t={1:!0,8:!0,9:!0},n={1:!0,9:!0};return{addDisposeCallback:function(e,t){if(typeof t!="function")throw new Error("Callback must be a function");i(e,!0).push(t)},removeDisposeCallback:function(e,t){var n=i(e,!1);n&&(r.utils.arrayRemoveItem(n,t),n.length==0&&s(e))},cleanNode:function(e){if(t[e.nodeType]){a(e);if(n[e.nodeType]){var i=[];r.utils.arrayPushAll(i,e.getElementsByTagName("*"));for(var s=0,o=i.length;s<o;s++)a(i[s])}}return e},removeNode:function(e){r.cleanNode(e),e.parentNode&&e.parentNode.removeChild(e)}}},r.cleanNode=r.utils.domNodeDisposal.cleanNode,r.removeNode=r.utils.domNodeDisposal.removeNode,r.exportSymbol("cleanNode",r.cleanNode),r.exportSymbol("removeNode",r.removeNode),r.exportSymbol("utils.domNodeDisposal",r.utils.domNodeDisposal),r.exportSymbol("utils.domNodeDisposal.addDisposeCallback",r.utils.domNodeDisposal.addDisposeCallback),r.exportSymbol("utils.domNodeDisposal.removeDisposeCallback",r.utils.domNodeDisposal.removeDisposeCallback),function(){function n(e){var n=r.utils.stringTrim(e).toLowerCase(),s=i.createElement("div"),o=n.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!n.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!n.indexOf("<td")||!n.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],u="ignored<div>"+o[1]+e+o[2]+"</div>";typeof t["innerShiv"]=="function"?s.appendChild(t.innerShiv(u)):s.innerHTML=u;while(o[0]--)s=s.lastChild;return r.utils.makeArray(s.lastChild.childNodes)}function s(e){if(o.parseHTML)return o.parseHTML(e);var t=o.clean([e]);if(t&&t[0]){var n=t[0];while(n.parentNode&&n.parentNode.nodeType!==11)n=n.parentNode;n.parentNode&&n.parentNode.removeChild(n)}return t}var e=/^(\s*)<!--(.*?)-->/;r.utils.parseHtmlFragment=function(e){return typeof o!="undefined"?s(e):n(e)},r.utils.setHtml=function(e,t){r.utils.emptyDomNode(e),t=r.utils.unwrapObservable(t);if(t!==null&&t!==u){typeof t!="string"&&(t=t.toString());if(typeof o!="undefined")o(e).html(t);else{var n=r.utils.parseHtmlFragment(t);for(var i=0;i<n.length;i++)e.appendChild(n[i])}}}}(),r.exportSymbol("utils.parseHtmlFragment",r.utils.parseHtmlFragment),r.exportSymbol("utils.setHtml",r.utils.setHtml),r.memoization=function(){function t(){return((1+Math.random())*4294967296|0).toString(16).substring(1)}function n(){return t()+t()}function i(e,t){if(!e)return;if(e.nodeType==8){var n=r.memoization.parseMemoText(e.nodeValue);n!=null&&t.push({domNode:e,memoId:n})}else if(e.nodeType==1)for(var s=0,o=e.childNodes,u=o.length;s<u;s++)i(o[s],t)}var e={};return{memoize:function(t){if(typeof t!="function")throw new Error("You can only pass a function to ko.memoization.memoize()");var r=n();return e[r]=t,"<!--[ko_memo:"+r+"]-->"},unmemoize:function(t,n){var r=e[t];if(r===u)throw new Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized.");try{return r.apply(null,n||[]),!0}finally{delete e[t]}},unmemoizeDomNodeAndDescendants:function(e,t){var n=[];i(e,n);for(var s=0,o=n.length;s<o;s++){var u=n[s].domNode,a=[u];t&&r.utils.arrayPushAll(a,t),r.memoization.unmemoize(n[s].memoId,a),u.nodeValue="",u.parentNode&&u.parentNode.removeChild(u)}},parseMemoText:function(e){var t=e.match(/^\[ko_memo\:(.*?)\]$/);return t?t[1]:null}}}(),r.exportSymbol("memoization",r.memoization),r.exportSymbol("memoization.memoize",r.memoization.memoize),r.exportSymbol("memoization.unmemoize",r.memoization.unmemoize),r.exportSymbol("memoization.parseMemoText",r.memoization.parseMemoText),r.exportSymbol("memoization.unmemoizeDomNodeAndDescendants",r.memoization.unmemoizeDomNodeAndDescendants),r.extenders={throttle:function(e,t){e.throttleEvaluation=t;var n=null;return r.dependentObservable({read:e,write:function(r){clearTimeout(n),n=setTimeout(function(){e(r)},t)}})},notify:function(e,t){return e.equalityComparer=t=="always"?function(){return!1}:r.observable.fn.equalityComparer,e}},r.exportSymbol("extenders",r.extenders),r.subscription=function(e,t,n){this.target=e,this.callback=t,this.disposeCallback=n,r.exportProperty(this,"dispose",this.dispose)},r.subscription.prototype.dispose=function(){this.isDisposed=!0,this.disposeCallback()},r.subscribable=function(){this._subscriptions={},r.utils.extend(this,r.subscribable.fn),r.exportProperty(this,"subscribe",this.subscribe),r.exportProperty(this,"extend",this.extend),r.exportProperty(this,"getSubscriptionsCount",this.getSubscriptionsCount)};var f="change";r.subscribable.fn={subscribe:function(e,t,n){n=n||f;var i=t?e.bind(t):e,s=new r.subscription(this,i,function(){r.utils.arrayRemoveItem(this._subscriptions[n],s)}.bind(this));return this._subscriptions[n]||(this._subscriptions[n]=[]),this._subscriptions[n].push(s),s},notifySubscribers:function(e,t){t=t||f,this._subscriptions[t]&&r.dependencyDetection.ignore(function(){r.utils.arrayForEach(this._subscriptions[t].slice(0),function(t){t&&t.isDisposed!==!0&&t.callback(e)})},this)},getSubscriptionsCount:function(){var e=0;for(var t in this._subscriptions)this._subscriptions.hasOwnProperty(t)&&(e+=this._subscriptions[t].length);return e},extend:a},r.isSubscribable=function(e){return typeof e.subscribe=="function"&&typeof e["notifySubscribers"]=="function"},r.exportSymbol("subscribable",r.subscribable),r.exportSymbol("isSubscribable",r.isSubscribable),r.dependencyDetection=function(){var e=[];return{begin:function(t){e.push({callback:t,distinctDependencies:[]})},end:function(){e.pop()},registerDependency:function(t){if(!r.isSubscribable(t))throw new Error("Only subscribable things can act as dependencies");if(e.length>0){var n=e[e.length-1];if(!n||r.utils.arrayIndexOf(n.distinctDependencies,t)>=0)return;n.distinctDependencies.push(t),n.callback(t)}},ignore:function(t,n,r){try{return e.push(null),t.apply(n,r||[])}finally{e.pop()}}}}();var l={"undefined":!0,"boolean":!0,number:!0,string:!0};r.observable=function(t){function i(){if(arguments.length>0){if(!i.equalityComparer||!i.equalityComparer(n,arguments[0]))i.valueWillMutate(),n=arguments[0],e&&(i._latestValue=n),i.valueHasMutated();return this}return r.dependencyDetection.registerDependency(i),n}var n=t;return e&&(i._latestValue=n),r.subscribable.call(i),i.peek=function(){return n},i.valueHasMutated=function(){i.notifySubscribers(n)},i.valueWillMutate=function(){i.notifySubscribers(n,"beforeChange")},r.utils.extend(i,r.observable.fn),r.exportProperty(i,"peek",i.peek),r.exportProperty(i,"valueHasMutated",i.valueHasMutated),r.exportProperty(i,"valueWillMutate",i.valueWillMutate),i},r.observable.fn={equalityComparer:function(t,n){var r=t===null||typeof t in l;return r?t===n:!1}};var c=r.observable.protoProperty="__ko_proto__";r.observable.fn[c]=r.observable,r.hasPrototype=function(e,t){return e===null||e===u||e[c]===u?!1:e[c]===t?!0:r.hasPrototype(e[c],t)},r.isObservable=function(e){return r.hasPrototype(e,r.observable)},r.isWriteableObservable=function(e){return typeof e=="function"&&e[c]===r.observable?!0:typeof e=="function"&&e[c]===r.dependentObservable&&e.hasWriteFunction?!0:!1},r.exportSymbol("observable",r.observable),r.exportSymbol("isObservable",r.isObservable),r.exportSymbol("isWriteableObservable",r.isWriteableObservable),r.observableArray=function(e){arguments.length==0&&(e=[]);if(e===null||e===u||"length"in e){var t=r.observable(e);return r.utils.extend(t,r.observableArray.fn),t}throw new Error("The argument passed when initializing an observable array must be an array, or null, or undefined.")},r.observableArray.fn={remove:function(e){var t=this.peek(),n=[],r=typeof e=="function"?e:function(t){return t===e};for(var i=0;i<t.length;i++){var s=t[i];r(s)&&(n.length===0&&this.valueWillMutate(),n.push(s),t.splice(i,1),i--)}return n.length&&this.valueHasMutated(),n},removeAll:function(e){if(e===u){var t=this.peek(),n=t.slice(0);return this.valueWillMutate(),t.splice(0,t.length),this.valueHasMutated(),n}return e?this.remove(function(t){return r.utils.arrayIndexOf(e,t)>=0}):[]},destroy:function(e){var t=this.peek(),n=typeof e=="function"?e:function(t){return t===e};this.valueWillMutate();for(var r=t.length-1;r>=0;r--){var i=t[r];n(i)&&(t[r]._destroy=!0)}this.valueHasMutated()},destroyAll:function(e){return e===u?this.destroy(function(){return!0}):e?this.destroy(function(t){return r.utils.arrayIndexOf(e,t)>=0}):[]},indexOf:function(e){var t=this();return r.utils.arrayIndexOf(t,e)},replace:function(e,t){var n=this.indexOf(e);n>=0&&(this.valueWillMutate(),this.peek()[n]=t,this.valueHasMutated())}},r.utils.arrayForEach(["pop","push","reverse","shift","sort","splice","unshift"],function(e){r.observableArray.fn[e]=function(){var t=this.peek();this.valueWillMutate();var n=t[e].apply(t,arguments);return this.valueHasMutated(),n}}),r.utils.arrayForEach(["slice"],function(e){r.observableArray.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}}),r.exportSymbol("observableArray",r.observableArray),r.dependentObservable=function(t,n,i){function l(e){E.push(e.subscribe(h))}function c(){r.utils.arrayForEach(E,function(e){e.dispose()}),E=[]}function h(){var e=d.throttleEvaluation;e&&e>=0?(clearTimeout(S),S=setTimeout(p,e)):p()}function p(){if(a)return;if(o&&b()){w();return}a=!0;try{var t=r.utils.arrayMap(E,function(e){return e.target});r.dependencyDetection.begin(function(e){var n;(n=r.utils.arrayIndexOf(t,e))>=0?t[n]=u:l(e)});var i=f.call(n);for(var c=t.length-1;c>=0;c--)t[c]&&E.splice(c,1)[0].dispose();o=!0,d.notifySubscribers(s,"beforeChange"),s=i,e&&(d._latestValue=s)}finally{r.dependencyDetection.end()}d.notifySubscribers(s),a=!1,E.length||w()}function d(){if(arguments.length>0){if(typeof g!="function")throw new Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return g.apply(n,arguments),this}return o||p(),r.dependencyDetection.registerDependency(d),s}function v(){return o||p(),s}function m(){return!o||E.length>0}var s,o=!1,a=!1,f=t;f&&typeof f=="object"?(i=f,f=i.read):(i=i||{},f||(f=i.read));if(typeof f!="function")throw new Error("Pass a function that returns the value of the ko.computed");var g=i.write,y=i.disposeWhenNodeIsRemoved||i.disposeWhenNodeIsRemoved||null,b=i.disposeWhen||i.disposeWhen||function(){return!1},w=c,E=[],S=null;n||(n=i.owner),d.peek=v,d.getDependenciesCount=function(){return E.length},d.hasWriteFunction=typeof i.write=="function",d.dispose=function(){w()},d.isActive=m,r.subscribable.call(d),r.utils.extend(d,r.dependentObservable.fn),r.exportProperty(d,"peek",d.peek),r.exportProperty(d,"dispose",d.dispose),r.exportProperty(d,"isActive",d.isActive),r.exportProperty(d,"getDependenciesCount",d.getDependenciesCount),i.deferEvaluation!==!0&&p();if(y&&m()){w=function(){r.utils.domNodeDisposal.removeDisposeCallback(y,arguments.callee),c()},r.utils.domNodeDisposal.addDisposeCallback(y,w);var x=b;b=function(){return!r.utils.domNodeIsAttachedToDocument(y)||x()}}return d},r.isComputed=function(e){return r.hasPrototype(e,r.dependentObservable)};var h=r.observable.protoProperty;r.dependentObservable[h]=r.observable,r.dependentObservable.fn={},r.dependentObservable.fn[h]=r.dependentObservable,r.exportSymbol("dependentObservable",r.dependentObservable),r.exportSymbol("computed",r.dependentObservable),r.exportSymbol("isComputed",r.isComputed),function(){function t(e,r,s){s=s||new i,e=r(e);var o=typeof e=="object"&&e!==null&&e!==u&&!(e instanceof Date);if(!o)return e;var a=e instanceof Array?[]:{};return s.save(e,a),n(e,function(n){var i=r(e[n]);switch(typeof i){case"boolean":case"number":case"string":case"function":a[n]=i;break;case"object":case"undefined":var o=s.get(i);a[n]=o!==u?o:t(i,r,s)}}),a}function n(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)t(n);typeof e["toJSON"]=="function"&&t("toJSON")}else for(var r in e)t(r)}function i(){var e=[],t=[];this.save=function(n,i){var s=r.utils.arrayIndexOf(e,n);s>=0?t[s]=i:(e.push(n),t.push(i))},this.get=function(n){var i=r.utils.arrayIndexOf(e,n);return i>=0?t[i]:u}}var e=10;r.toJS=function(n){if(arguments.length==0)throw new Error("When calling ko.toJS, pass the object you want to convert.");return t(n,function(t){for(var n=0;r.isObservable(t)&&n<e;n++)t=t();return t})},r.toJSON=function(e,t,n){var i=r.toJS(e);return r.utils.stringifyJson(i,t,n)}}(),r.exportSymbol("toJS",r.toJS),r.exportSymbol("toJSON",r.toJSON),function(){var e="__ko__hasDomDataOptionValue__";r.selectExtensions={readValue:function(t){switch(r.utils.tagNameLower(t)){case"option":if(t[e]===!0)return r.utils.domData.get(t,r.bindingHandlers.options.optionValueDomDataKey);return r.utils.ieVersion<=7?t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return t.selectedIndex>=0?r.selectExtensions.readValue(t.options[t.selectedIndex]):u;default:return t.value}},writeValue:function(t,n){switch(r.utils.tagNameLower(t)){case"option":switch(typeof n){case"string":r.utils.domData.set(t,r.bindingHandlers.options.optionValueDomDataKey,u),e in t&&delete t[e],t.value=n;break;default:r.utils.domData.set(t,r.bindingHandlers.options.optionValueDomDataKey,n),t[e]=!0,t.value=typeof n=="number"?n:""}break;case"select":for(var i=t.options.length-1;i>=0;i--)if(r.selectExtensions.readValue(t.options[i])==n){t.selectedIndex=i;break}break;default:if(n===null||n===u)n="";t.value=n}}}}(),r.exportSymbol("selectExtensions",r.selectExtensions),r.exportSymbol("selectExtensions.readValue",r.selectExtensions.readValue),r.exportSymbol("selectExtensions.writeValue",r.selectExtensions.writeValue),r.expressionRewriting=function(){function i(t,n){var r=null;while(t!=r)r=t,t=t.replace(e,function(e,t){return n[t]});return t}function s(e){if(r.utils.arrayIndexOf(t,r.utils.stringTrim(e).toLowerCase())>=0)return!1;var i=e.match(n);return i===null?!1:i[1]?"Object("+i[1]+")"+i[2]:e}function o(e){var t=r.utils.stringTrim(e);switch(t.length&&t.charAt(0)){case"'":case'"':return e;default:return"'"+t+"'"}}var e=/\@ko_token_(\d+)\@/g,t=["true","false"],n=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;return{bindingRewriteValidators:[],parseObjectLiteral:function(e){var t=r.utils.stringTrim(e);if(t.length<3)return[];t.charAt(0)==="{"&&(t=t.substring(1,t.length-1));var n=[],s=null,o;for(var u=0;u<t.length;u++){var a=t.charAt(u);if(s===null)switch(a){case'"':case"'":case"/":s=u,o=a}else if(a==o&&t.charAt(u-1)!=="\\"){var f=t.substring(s,u+1);n.push(f);var l="@ko_token_"+(n.length-1)+"@";t=t.substring(0,s)+l+t.substring(u+1),u-=f.length-l.length,s=null}}s=null,o=null;var c=0,h=null;for(var u=0;u<t.length;u++){var a=t.charAt(u);if(s===null)switch(a){case"{":s=u,h=a,o="}";break;case"(":s=u,h=a,o=")";break;case"[":s=u,h=a,o="]"}if(a===h)c++;else if(a===o){c--;if(c===0){var f=t.substring(s,u+1);n.push(f);var l="@ko_token_"+(n.length-1)+"@";t=t.substring(0,s)+l+t.substring(u+1),u-=f.length-l.length,s=null}}}var p=[],d=t.split(",");for(var v=0,m=d.length;v<m;v++){var g=d[v],y=g.indexOf(":");if(y>0&&y<g.length-1){var b=g.substring(0,y),w=g.substring(y+1);p.push({key:i(b,n),value:i(w,n)})}else p.push({unknown:i(g,n)})}return p},preProcessBindings:function(e){var t=typeof e=="string"?r.expressionRewriting.parseObjectLiteral(e):e,n=[],i=[],u;for(var a=0;u=t[a];a++){n.length>0&&n.push(",");if(u.key){var f=o(u.key),l=u.value;n.push(f),n.push(":"),n.push(l);if(l=s(r.utils.stringTrim(l)))i.length>0&&i.push(", "),i.push(f+" : function(__ko_value) { "+l+" = __ko_value; }")}else u.unknown&&n.push(u.unknown)}var c=n.join("");if(i.length>0){var h=i.join("");c=c+", '_ko_property_writers' : { "+h+" } "}return c},keyValueArrayContainsKey:function(e,t){for(var n=0;n<e.length;n++)if(r.utils.stringTrim(e[n]["key"])==t)return!0;return!1},writeValueToProperty:function(e,t,n,i,s){if(!e||!r.isWriteableObservable(e)){var o=t()._ko_property_writers;o&&o[n]&&o[n](i)}else(!s||e.peek()!==i)&&e(i)}}}(),r.exportSymbol("expressionRewriting",r.expressionRewriting),r.exportSymbol("expressionRewriting.bindingRewriteValidators",r.expressionRewriting.bindingRewriteValidators),r.exportSymbol("expressionRewriting.parseObjectLiteral",r.expressionRewriting.parseObjectLiteral),r.exportSymbol("expressionRewriting.preProcessBindings",r.expressionRewriting.preProcessBindings),r.exportSymbol("jsonExpressionRewriting",r.expressionRewriting),r.exportSymbol("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",r.expressionRewriting.preProcessBindings),function(){function o(n){return n.nodeType==8&&(e?n.text:n.nodeValue).match(t)}function u(t){return t.nodeType==8&&(e?t.text:t.nodeValue).match(n)}function a(e,t){var n=e,r=1,i=[];while(n=n.nextSibling){if(u(n)){r--;if(r===0)return i}i.push(n),o(n)&&r++}if(!t)throw new Error("Cannot find closing comment tag to match: "+e.nodeValue);return null}function f(e,t){var n=a(e,t);return n?n.length>0?n[n.length-1].nextSibling:e.nextSibling:null}function l(e){var t=e.firstChild,n=null;if(t)do if(n)n.push(t);else if(o(t)){var r=f(t,!0);r?t=r:n=[t]}else u(t)&&(n=[t]);while(t=t.nextSibling);return n}var e=i.createComment("test").text==="<!--test-->",t=e?/^<!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*-->$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/,n=e?/^<!--\s*\/ko\s*-->$/:/^\s*\/ko\s*$/,s={ul:!0,ol:!0};r.virtualElements={allowedBindings:{},childNodes:function(e){return o(e)?a(e):e.childNodes},emptyNode:function(e){if(!o(e))r.utils.emptyDomNode(e);else{var t=r.virtualElements.childNodes(e);for(var n=0,i=t.length;n<i;n++)r.removeNode(t[n])}},setDomNodeChildren:function(e,t){if(!o(e))r.utils.setDomNodeChildren(e,t);else{r.virtualElements.emptyNode(e);var n=e.nextSibling;for(var i=0,s=t.length;i<s;i++)n.parentNode.insertBefore(t[i],n)}},prepend:function(e,t){o(e)?e.parentNode.insertBefore(t,e.nextSibling):e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},insertAfter:function(e,t,n){n?o(e)?e.parentNode.insertBefore(t,n.nextSibling):n.nextSibling?e.insertBefore(t,n.nextSibling):e.appendChild(t):r.virtualElements.prepend(e,t)},firstChild:function(e){return o(e)?!e.nextSibling||u(e.nextSibling)?null:e.nextSibling:e.firstChild},nextSibling:function(e){return o(e)&&(e=f(e)),e.nextSibling&&u(e.nextSibling)?null:e.nextSibling},virtualNodeBindingValue:function(e){var t=o(e);return t?t[1]:null},normaliseVirtualElementDomStructure:function(e){if(!s[r.utils.tagNameLower(e)])return;var t=e.firstChild;if(t)do if(t.nodeType===1){var n=l(t);if(n){var i=t.nextSibling;for(var o=0;o<n.length;o++)i?e.insertBefore(n[o],i):e.appendChild(n[o])}}while(t=t.nextSibling)}}}(),r.exportSymbol("virtualElements",r.virtualElements),r.exportSymbol("virtualElements.allowedBindings",r.virtualElements.allowedBindings),r.exportSymbol("virtualElements.emptyNode",r.virtualElements.emptyNode),r.exportSymbol("virtualElements.insertAfter",r.virtualElements.insertAfter),r.exportSymbol("virtualElements.prepend",r.virtualElements.prepend),r.exportSymbol("virtualElements.setDomNodeChildren",r.virtualElements.setDomNodeChildren),function(){function t(e,t){var r=e;return t[r]||(t[r]=n(e))}function n(e){var t=r.expressionRewriting.preProcessBindings(e),n="with($context){with($data||{}){return{"+t+"}}}";return new Function("$context","$element",n)}var e="data-bind";r.bindingProvider=function(){this.bindingCache={}},r.utils.extend(r.bindingProvider.prototype,{nodeHasBindings:function(t){switch(t.nodeType){case 1:return t.getAttribute(e)!=null;case 8:return r.virtualElements.virtualNodeBindingValue(t)!=null;default:return!1}},getBindings:function(e,t){var n=this.getBindingsString(e,t);return n?this.parseBindingsString(n,t,e):null},getBindingsString:function(t,n){switch(t.nodeType){case 1:return t.getAttribute(e);case 8:return r.virtualElements.virtualNodeBindingValue(t);default:return null}},parseBindingsString:function(e,n,r){try{var i=t(e,this.bindingCache);return i(n,r)}catch(s){throw new Error("Unable to parse bindings.\nMessage: "+s+";\nBindings value: "+e)}}}),r.bindingProvider.instance=new r.bindingProvider}(),r.exportSymbol("bindingProvider",r.bindingProvider),function(){function e(e){var t=r.virtualElements.allowedBindings[e];if(!t)throw new Error("The binding '"+e+"' cannot be used with virtual elements")}function n(e,t,n){var s,o=r.virtualElements.firstChild(t);while(s=o)o=r.virtualElements.nextSibling(s),i(e,s,n)}function i(e,t,i){var o=!0,u=t.nodeType===1;u&&r.virtualElements.normaliseVirtualElementDomStructure(t);var a=u&&i||r.bindingProvider.instance.nodeHasBindings(t);a&&(o=s(t,null,e,i).shouldBindDescendants),o&&n(e,t,!u)}function s(t,n,i,s){function f(e){return function(){return a[e]}}function l(){return a}var o=0,a,c;return r.dependentObservable(function(){var h=i&&i instanceof r.bindingContext?i:new r.bindingContext(r.utils.unwrapObservable(i)),p=h.$data;s&&r.storedBindingContextForNode(t,h);var d=typeof n=="function"?n(h,t):n;a=d||r.bindingProvider.instance.getBindings(t,h);if(a){if(o===0){o=1;for(var v in a){var m=r.bindingHandlers[v];m&&t.nodeType===8&&e(v);if(m&&typeof m["init"]=="function"){var g=m.init,y=g(t,f(v),l,p,h);if(y&&y.controlsDescendantBindings){if(c!==u)throw new Error("Multiple bindings ("+c+" and "+v+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");c=v}}}o=2}if(o===2)for(var v in a){var m=r.bindingHandlers[v];if(m&&typeof m["update"]=="function"){var b=m.update;b(t,f(v),l,p,h)}}}},null,{disposeWhenNodeIsRemoved:t}),{shouldBindDescendants:c===u}}r.bindingHandlers={},r.bindingContext=function(e,t,n){t?(r.utils.extend(this,t),this.$parentContext=t,this.$parent=t.$data,this.$parents=(t.$parents||[]).slice(0),this.$parents.unshift(this.$parent)):(this.$parents=[],this.$root=e,this.ko=r),this.$data=e,n&&(this[n]=e)},r.bindingContext.prototype.createChildContext=function(e,t){return new r.bindingContext(e,this,t)},r.bindingContext.prototype.extend=function(e){var t=r.utils.extend(new r.bindingContext,this);return r.utils.extend(t,e)};var o="__ko_bindingContext__";r.storedBindingContextForNode=function(e,t){if(arguments.length!=2)return r.utils.domData.get(e,o);r.utils.domData.set(e,o,t)},r.applyBindingsToNode=function(e,t,n){return e.nodeType===1&&r.virtualElements.normaliseVirtualElementDomStructure(e),s(e,t,n,!0)},r.applyBindingsToDescendants=function(e,t){(t.nodeType===1||t.nodeType===8)&&n(e,t,!0)},r.applyBindings=function(e,n){if(n&&n.nodeType!==1&&n.nodeType!==8)throw new Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");n=n||t.document.body,i(e,n,!0)},r.contextFor=function(e){switch(e.nodeType){case 1:case 8:var t=r.storedBindingContextForNode(e);if(t)return t;if(e.parentNode)return r.contextFor(e.parentNode)}return u},r.dataFor=function(e){var t=r.contextFor(e);return t?t.$data:u},r.exportSymbol("bindingHandlers",r.bindingHandlers),r.exportSymbol("applyBindings",r.applyBindings),r.exportSymbol("applyBindingsToDescendants",r.applyBindingsToDescendants),r.exportSymbol("applyBindingsToNode",r.applyBindingsToNode),r.exportSymbol("contextFor",r.contextFor),r.exportSymbol("dataFor",r.dataFor)}();var p={"class":"className","for":"htmlFor"};r.bindingHandlers.attr={update:function(e,t,n){var i=r.utils.unwrapObservable(t())||{};for(var s in i)if(typeof s=="string"){var o=r.utils.unwrapObservable(i[s]),a=o===!1||o===null||o===u;a&&e.removeAttribute(s),r.utils.ieVersion<=8&&s in p?(s=p[s],a?e.removeAttribute(s):e[s]=o):a||e.setAttribute(s,o.toString()),s==="name"&&r.utils.setElementName(e,a?"":o.toString())}}},r.bindingHandlers.checked={init:function(e,t,n){var i=function(){var i;if(e.type=="checkbox")i=e.checked;else{if(e.type!="radio"||!e.checked)return;i=e.value}var s=t(),o=r.utils.unwrapObservable(s);if(e.type=="checkbox"&&o instanceof Array){var u=r.utils.arrayIndexOf(o,e.value);e.checked&&u<0?s.push(e.value):!e.checked&&u>=0&&s.splice(u,1)}else r.expressionRewriting.writeValueToProperty(s,n,"checked",i,!0)};r.utils.registerEventHandler(e,"click",i),e.type=="radio"&&!e.name&&r.bindingHandlers.uniqueName.init(e,function(){return!0})},update:function(e,t){var n=r.utils.unwrapObservable(t());e.type=="checkbox"?n instanceof Array?e.checked=r.utils.arrayIndexOf(n,e.value)>=0:e.checked=n:e.type=="radio"&&(e.checked=e.value==n)}};var d="__ko__cssValue";r.bindingHandlers.css={update:function(e,t){var n=r.utils.unwrapObservable(t());if(typeof n=="object")for(var i in n){var s=r.utils.unwrapObservable(n[i]);r.utils.toggleDomNodeCssClass(e,i,s)}else n=String(n||""),r.utils.toggleDomNodeCssClass(e,e[d],!1),e[d]=n,r.utils.toggleDomNodeCssClass(e,n,!0)}},r.bindingHandlers.enable={update:function(e,t){var n=r.utils.unwrapObservable(t());n&&e.disabled?e.removeAttribute("disabled"):!n&&!e.disabled&&(e.disabled=!0)}},r.bindingHandlers.disable={update:function(e,t){r.bindingHandlers.enable.update(e,function(){return!r.utils.unwrapObservable(t())})}},r.bindingHandlers.event={init:function(e,t,n,i){var s=t()||{};for(var o in s)(function(){var s=o;typeof s=="string"&&r.utils.registerEventHandler(e,s,function(e){var o,u=t()[s];if(!u)return;var a=n();try{var f=r.utils.makeArray(arguments);f.unshift(i),o=u.apply(i,f)}finally{o!==!0&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}var l=a[s+"Bubble"]!==!1;l||(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())})})()}},r.bindingHandlers.foreach={makeTemplateValueAccessor:function(e){return function(){var t=e(),n=r.utils.peekObservable(t);return!n||typeof n.length=="number"?{foreach:t,templateEngine:r.nativeTemplateEngine.instance}:(r.utils.unwrapObservable(t),{foreach:n.data,as:n.as,includeDestroyed:n.includeDestroyed,afterAdd:n.afterAdd,beforeRemove:n.beforeRemove,afterRender:n.afterRender,beforeMove:n.beforeMove,afterMove:n.afterMove,templateEngine:r.nativeTemplateEngine.instance})}},init:function(e,t,n,i,s){return r.bindingHandlers.template.init(e,r.bindingHandlers.foreach.makeTemplateValueAccessor(t))},update:function(e,t,n,i,s){return r.bindingHandlers.template.update(e,r.bindingHandlers.foreach.makeTemplateValueAccessor(t),n,i,s)}},r.expressionRewriting.bindingRewriteValidators.foreach=!1,r.virtualElements.allowedBindings.foreach=!0;var m="__ko_hasfocusUpdating";r.bindingHandlers.hasfocus={init:function(e,t,n){var i=function(i){e[m]=!0;var s=e.ownerDocument;"activeElement"in s&&(i=s.activeElement===e);var o=t();r.expressionRewriting.writeValueToProperty(o,n,"hasfocus",i,!0),e[m]=!1},s=i.bind(null,!0),o=i.bind(null,!1);r.utils.registerEventHandler(e,"focus",s),r.utils.registerEventHandler(e,"focusin",s),r.utils.registerEventHandler(e,"blur",o),r.utils.registerEventHandler(e,"focusout",o)},update:function(e,t){var n=r.utils.unwrapObservable(t());e[m]||(n?e.focus():e.blur(),r.dependencyDetection.ignore(r.utils.triggerEvent,null,[e,n?"focusin":"focusout"]))}},r.bindingHandlers.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){r.utils.setHtml(e,t())}};var g="__ko_withIfBindingData";y("if"),y("ifnot",!1,!0),y("with",!0,!1,function(e,t){return e.createChildContext(t)}),r.bindingHandlers.options={update:function(e,t,n){if(r.utils.tagNameLower(e)!=="select")throw new Error("options binding applies only to SELECT elements");var s=e.length==0,o=r.utils.arrayMap(r.utils.arrayFilter(e.childNodes,function(e){return e.tagName&&r.utils.tagNameLower(e)==="option"&&e.selected}),function(e){return r.selectExtensions.readValue(e)||e.innerText||e.textContent}),a=e.scrollTop,f=r.utils.unwrapObservable(t()),l=e.value;while(e.length>0)r.cleanNode(e.options[0]),e.remove(0);if(f){var c=n(),h=c.optionsIncludeDestroyed;typeof f.length!="number"&&(f=[f]);if(c.optionsCaption){var p=i.createElement("option");r.utils.setHtml(p,c.optionsCaption),r.selectExtensions.writeValue(p,u),e.appendChild(p)}for(var d=0,v=f.length;d<v;d++){var m=f[d];if(m&&m._destroy&&!h)continue;var p=i.createElement("option");function g(e,t,n){var r=typeof t;return r=="function"?t(e):r=="string"?e[t]:n}var y=g(m,c.optionsValue,m);r.selectExtensions.writeValue(p,r.utils.unwrapObservable(y));var w=g(m,c.optionsText,y);r.utils.setTextContent(p,w),e.appendChild(p)}var E=e.getElementsByTagName("option"),S=0;for(var d=0,v=E.length;d<v;d++)r.utils.arrayIndexOf(o,r.selectExtensions.readValue(E[d]))>=0&&(r.utils.setOptionNodeSelectionState(E[d],!0),S++);e.scrollTop=a,s&&"value"in c&&b(e,r.utils.peekObservable(c.value),!0),r.utils.ensureSelectElementIsRenderedCorrectly(e)}}},r.bindingHandlers.options.optionValueDomDataKey="__ko.optionValueDomData__",r.bindingHandlers.selectedOptions={init:function(e,t,n){r.utils.registerEventHandler(e,"change",function(){var i=t(),s=[];r.utils.arrayForEach(e.getElementsByTagName("option"),function(e){e.selected&&s.push(r.selectExtensions.readValue(e))}),r.expressionRewriting.writeValueToProperty(i,n,"value",s)})},update:function(e,t){if(r.utils.tagNameLower(e)!="select")throw new Error("values binding applies only to SELECT elements");var n=r.utils.unwrapObservable(t());n&&typeof n.length=="number"&&r.utils.arrayForEach(e.getElementsByTagName("option"),function(e){var t=r.utils.arrayIndexOf(n,r.selectExtensions.readValue(e))>=0;r.utils.setOptionNodeSelectionState(e,t)})}},r.bindingHandlers.style={update:function(e,t){var n=r.utils.unwrapObservable(t()||{});for(var i in n)if(typeof i=="string"){var s=r.utils.unwrapObservable(n[i]);e.style[i]=s||""}}},r.bindingHandlers.submit={init:function(e,t,n,i){if(typeof t()!="function")throw new Error("The value for a submit binding must be a function");r.utils.registerEventHandler(e,"submit",function(n){var r,s=t();try{r=s.call(i,e)}finally{r!==!0&&(n.preventDefault?n.preventDefault():n.returnValue=!1)}})}},r.bindingHandlers.text={update:function(e,t){r.utils.setTextContent(e,t())}},r.virtualElements.allowedBindings.text=!0,r.bindingHandlers.uniqueName={init:function(e,t){if(t()){var n="ko_unique_"+ ++r.bindingHandlers.uniqueName.currentIndex;r.utils.setElementName(e,n)}}},r.bindingHandlers.uniqueName.currentIndex=0,r.bindingHandlers.value={init:function(e,t,n){var i=["change"],s=n().valueUpdate,o=!1;s&&(typeof s=="string"&&(s=[s]),r.utils.arrayPushAll(i,s),i=r.utils.arrayGetDistinctValues(i));var u=function(){o=!1;var i=t(),s=r.selectExtensions.readValue(e);r.expressionRewriting.writeValueToProperty(i,n,"value",s)},a=r.utils.ieVersion&&e.tagName.toLowerCase()=="input"&&e.type=="text"&&e.autocomplete!="off"&&(!e.form||e.form.autocomplete!="off");a&&r.utils.arrayIndexOf(i,"propertychange")==-1&&(r.utils.registerEventHandler(e,"propertychange",function(){o=!0}),r.utils.registerEventHandler(e,"blur",function(){o&&u()})),r.utils.arrayForEach(i,function(t){var n=u;r.utils.stringStartsWith(t,"after")&&(n=function(){setTimeout(u,0)},t=t.substring("after".length)),r.utils.registerEventHandler(e,t,n)})},update:function(e,t){var n=r.utils.tagNameLower(e)==="select",i=r.utils.unwrapObservable(t()),s=r.selectExtensions.readValue(e),o=i!=s;i===0&&s!==0&&s!=="0"&&(o=!0);if(o){var u=function(){r.selectExtensions.writeValue(e,i)};u();var a=n;a&&setTimeout(u,0)}n&&e.length>0&&b(e,i,!1)}},r.bindingHandlers.visible={update:function(e,t){var n=r.utils.unwrapObservable(t()),i=e.style.display!="none";n&&!i?e.style.display="":!n&&i&&(e.style.display="none")}},v("click"),r.templateEngine=function(){},r.templateEngine.prototype.renderTemplateSource=function(e,t,n){throw new Error("Override renderTemplateSource")},r.templateEngine.prototype.createJavaScriptEvaluatorBlock=function(e){throw new Error("Override createJavaScriptEvaluatorBlock")},r.templateEngine.prototype.makeTemplateSource=function(e,t){if(typeof e=="string"){t=t||i;var n=t.getElementById(e);if(!n)throw new Error("Cannot find template with ID "+e);return new r.templateSources.domElement(n)}if(e.nodeType==1||e.nodeType==8)return new r.templateSources.anonymousTemplate(e);throw new Error("Unknown template type: "+e)},r.templateEngine.prototype.renderTemplate=function(e,t,n,r){var i=this.makeTemplateSource(e,r);return this.renderTemplateSource(i,t,n)},r.templateEngine.prototype.isTemplateRewritten=function(e,t){return this.allowTemplateRewriting===!1?!0:this.makeTemplateSource(e,t).data("isRewritten")},r.templateEngine.prototype.rewriteTemplate=function(e,t,n){var r=this.makeTemplateSource(e,n),i=t(r.text());r.text(i),r.data("isRewritten",!0)},r.exportSymbol("templateEngine",r.templateEngine),r.templateRewriting=function(){function n(e){var t=r.expressionRewriting.bindingRewriteValidators;for(var n=0;n<e.length;n++){var i=e[n].key;if(t.hasOwnProperty(i)){var s=t[i];if(typeof s=="function"){var o=s(e[n].value);if(o)throw new Error(o)}else if(!s)throw new Error("This template engine does not support the '"+i+"' binding within its templates")}}}function i(e,t,i){var s=r.expressionRewriting.parseObjectLiteral(e);n(s);var o=r.expressionRewriting.preProcessBindings(s),u="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+o+" } })()})";return i.createJavaScriptEvaluatorBlock(u)+t}var e=/(<[a-z]+\d*(\s+(?!data-bind=)[a-z0-9\-]+(=(\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind=(["'])([\s\S]*?)\5/gi,t=/<!--\s*ko\b\s*([\s\S]*?)\s*-->/g;return{ensureTemplateIsRewritten:function(e,t,n){t.isTemplateRewritten(e,n)||t.rewriteTemplate(e,function(e){return r.templateRewriting.memoizeBindingAttributeSyntax(e,t)},n)},memoizeBindingAttributeSyntax:function(n,r){return n.replace(e,function(){return i(arguments[6],arguments[1],r)}).replace(t,function(){return i(arguments[1],"<!-- ko -->",r)})},applyMemoizedBindingsToNextSibling:function(e){return r.memoization.memoize(function(t,n){t.nextSibling&&r.applyBindingsToNode(t.nextSibling,e,n)})}}}(),r.exportSymbol("__tr_ambtns",r.templateRewriting.applyMemoizedBindingsToNextSibling),function(){r.templateSources={},r.templateSources.domElement=function(e){this.domElement=e},r.templateSources.domElement.prototype.text=function(){var e=r.utils.tagNameLower(this.domElement),t=e==="script"?"text":e==="textarea"?"value":"innerHTML";if(arguments.length==0)return this.domElement[t];var n=arguments[0];t==="innerHTML"?r.utils.setHtml(this.domElement,n):this.domElement[t]=n},r.templateSources.domElement.prototype.data=function(e){if(arguments.length===1)return r.utils.domData.get(this.domElement,"templateSourceData_"+e);r.utils.domData.set(this.domElement,"templateSourceData_"+e,arguments[1])};var e="__ko_anon_template__";r.templateSources.anonymousTemplate=function(e){this.domElement=e},r.templateSources.anonymousTemplate.prototype=new r.templateSources.domElement,r.templateSources.anonymousTemplate.prototype.text=function(){if(arguments.length==0){var t=r.utils.domData.get(this.domElement,e)||{};return t.textData===u&&t.containerData&&(t.textData=t.containerData.innerHTML),t.textData}var n=arguments[0];r.utils.domData.set(this.domElement,e,{textData:n})},r.templateSources.domElement.prototype.nodes=function(){if(arguments.length==0){var t=r.utils.domData.get(this.domElement,e)||{};return t.containerData}var n=arguments[0];r.utils.domData.set(this.domElement,e,{containerData:n})},r.exportSymbol("templateSources",r.templateSources),r.exportSymbol("templateSources.domElement",r.templateSources.domElement),r.exportSymbol("templateSources.anonymousTemplate",r.templateSources.anonymousTemplate)}(),function(){function t(e,t,n){var i,s=e,o=r.virtualElements.nextSibling(t);while(s&&(i=s)!==o)s=r.virtualElements.nextSibling(i),(i.nodeType===1||i.nodeType===8)&&n(i)}function n(e,n){if(e.length){var i=e[0],s=e[e.length-1];t(i,s,function(e){r.applyBindings(n,e)}),t(i,s,function(e){r.memoization.unmemoizeDomNodeAndDescendants(e,[n])})}}function i(e){return e.nodeType?e:e.length>0?e[0]:null}function s(t,s,o,u,a){a=a||{};var f=t&&i(t),l=f&&f.ownerDocument,c=a.templateEngine||e;r.templateRewriting.ensureTemplateIsRewritten(o,c,l);var h=c.renderTemplate(o,u,a,l);if(typeof h.length!="number"||h.length>0&&typeof h[0].nodeType!="number")throw new Error("Template engine must return an array of DOM nodes");var p=!1;switch(s){case"replaceChildren":r.virtualElements.setDomNodeChildren(t,h),p=!0;break;case"replaceNode":r.utils.replaceDomNodes(t,h),p=!0;break;case"ignoreTargetNode":break;default:throw new Error("Unknown renderMode: "+s)}return p&&(n(h,u),a.afterRender&&r.dependencyDetection.ignore(a.afterRender,null,[h,u.$data])),h}function a(e,t){var n=r.utils.domData.get(e,o);n&&typeof n.dispose=="function"&&n.dispose(),r.utils.domData.set(e,o,t&&t.isActive()?t:u)}var e;r.setTemplateEngine=function(t){if(!(t==u||t instanceof r.templateEngine))throw new Error("templateEngine must inherit from ko.templateEngine");e=t},r.renderTemplate=function(t,n,o,a,f){o=o||{};if((o["templateEngine"]||e)==u)throw new Error("Set a template engine before calling renderTemplate");f=f||"replaceChildren";if(a){var l=i(a),c=function(){return!l||!r.utils.domNodeIsAttachedToDocument(l)},h=l&&f=="replaceNode"?l.parentNode:l;return r.dependentObservable(function(){var e=n&&n instanceof r.bindingContext?n:new r.bindingContext(r.utils.unwrapObservable(n)),u=typeof t=="function"?t(e.$data,e):t,c=s(a,f,u,e,o);f=="replaceNode"&&(a=c,l=i(a))},null,{disposeWhen:c,disposeWhenNodeIsRemoved:h})}return r.memoization.memoize(function(e){r.renderTemplate(t,n,o,e,"replaceNode")})},r.renderTemplateForEach=function(e,t,i,o,a){var f,l=function(t,n){f=a.createChildContext(r.utils.unwrapObservable(t),i.as),f.$index=n;var o=typeof e=="function"?e(t,f):e;return s(null,"ignoreTargetNode",o,f,i)},c=function(e,t,r){n(t,f),i.afterRender&&i.afterRender(t,e)};return r.dependentObservable(function(){var e=r.utils.unwrapObservable(t)||[];typeof e.length=="undefined"&&(e=[e]);var n=r.utils.arrayFilter(e,function(e){return i.includeDestroyed||e===u||e===null||!r.utils.unwrapObservable(e._destroy)});r.dependencyDetection.ignore(r.utils.setDomNodeChildrenFromArrayMapping,null,[o,n,l,i,c])},null,{disposeWhenNodeIsRemoved:o})};var o="__ko__templateComputedDomDataKey__";r.bindingHandlers.template={init:function(e,t){var n=r.utils.unwrapObservable(t());if(typeof n!="string"&&!n.name&&(e.nodeType==1||e.nodeType==8)){var i=e.nodeType==1?e.childNodes:r.virtualElements.childNodes(e),s=r.utils.moveCleanedNodesToContainerElement(i);(new r.templateSources.anonymousTemplate(e)).nodes(s)}return{controlsDescendantBindings:!0}},update:function(e,t,n,i,s){var o=r.utils.unwrapObservable(t()),u={},f=!0,l,c=null;typeof o!="string"&&(u=o,o=u.name,"if"in u&&(f=r.utils.unwrapObservable(u["if"])),f&&"ifnot"in u&&(f=!r.utils.unwrapObservable(u.ifnot)),l=r.utils.unwrapObservable(u.data));if("foreach"in u){var h=f&&u.foreach||[];c=r.renderTemplateForEach(o||e,h,u,e,s)}else if(!f)r.virtualElements.emptyNode(e);else{var p="data"in u?s.createChildContext(l,u.as):s;c=r.renderTemplate(o||e,p,u,e)}a(e,c)}},r.expressionRewriting.bindingRewriteValidators.template=function(e){var t=r.expressionRewriting.parseObjectLiteral(e);return t.length==1&&t[0].unknown?null:r.expressionRewriting.keyValueArrayContainsKey(t,"name")?null:"This template engine does not support anonymous templates nested within its templates"},r.virtualElements.allowedBindings.template=!0}(),r.exportSymbol("setTemplateEngine",r.setTemplateEngine),r.exportSymbol("renderTemplate",r.renderTemplate),r.utils.compareArrays=function(){function n(n,i,s){return n=n||[],i=i||[],n.length<=i.length?r(n,i,e,t,s):r(i,n,t,e,s)}function r(e,t,n,r,i){var s=Math.min,o=Math.max,u=[],a,f=e.length,l,c=t.length,h=c-f||1,p=f+c+1,d,v,m,g;for(a=0;a<=f;a++){v=d,u.push(d=[]),m=s(c,a+h),g=o(0,a-1);for(l=g;l<=m;l++)if(!l)d[l]=a+1;else if(!a)d[l]=l+1;else if(e[a-1]===t[l-1])d[l]=v[l-1];else{var y=v[l]||p,b=d[l-1]||p;d[l]=s(y,b)+1}}var w=[],E,S=[],x=[];for(a=f,l=c;a||l;)E=u[a][l]-1,l&&E===u[a][l-1]?S.push(w[w.length]={status:n,value:t[--l],index:l}):a&&E===u[a-1][l]?x.push(w[w.length]={status:r,value:e[--a],index:a}):(w.push({status:"retained",value:t[--l]}),--a);if(S.length&&x.length){var T=f*10,N,C,k,L,A;for(N=C=0;(i||N<T)&&(L=S[C]);C++){for(k=0;A=x[k];k++)if(L.value===A.value){L.moved=A.index,A.moved=L.index,x.splice(k,1),N=k=0;break}N+=k}}return w.reverse()}var e="added",t="deleted";return n}(),r.exportSymbol("utils.compareArrays",r.utils.compareArrays),function(){function e(e){while(e.length&&!r.utils.domNodeIsAttachedToDocument(e[0]))e.splice(0,1);if(e.length>1){var t=e[0],n=e[e.length-1],i=[t];while(t!==n){t=t.nextSibling;if(!t)return;i.push(t)}Array.prototype.splice.apply(e,[0,e.length].concat(i))}return e}function t(t,n,i,s,o){var a=[],f=r.dependentObservable(function(){var t=n(i,o)||[];a.length>0&&(r.utils.replaceDomNodes(e(a),t),s&&r.dependencyDetection.ignore(s,null,[i,t,o])),a.splice(0,a.length),r.utils.arrayPushAll(a,t)},null,{disposeWhenNodeIsRemoved:t,disposeWhen:function(){return a.length==0||!r.utils.domNodeIsAttachedToDocument(a[0])}});return{mappedNodes:a,dependentObservable:f.isActive()?f:u}}var n="setDomNodeChildrenFromArrayMapping_lastMappingResult";r.utils.setDomNodeChildrenFromArrayMapping=function(i,s,o,a,f){function x(t,n){S=c[n],m!==n&&(w[t]=S),S.indexObservable(m++),e(S.mappedNodes),d.push(S),y.push(S)}function T(e,t){if(e)for(var n=0,i=t.length;n<i;n++)t[n]&&r.utils.arrayForEach(t[n].mappedNodes,function(r){e(r,n,t[n].arrayEntry)})}s=s||[],a=a||{};var l=r.utils.domData.get(i,n)===u,c=r.utils.domData.get(i,n)||[],h=r.utils.arrayMap(c,function(e){return e.arrayEntry}),p=r.utils.compareArrays(h,s),d=[],v=0,m=0,g=[],y=[],b=[],w=[],E=[],S;for(var N=0,C,k;C=p[N];N++){k=C.moved;switch(C.status){case"deleted":k===u&&(S=c[v],S.dependentObservable&&S.dependentObservable.dispose(),g.push.apply(g,e(S.mappedNodes)),a.beforeRemove&&(b[N]=S,y.push(S))),v++;break;case"retained":x(N,v++);break;case"added":k!==u?x(N,k):(S={arrayEntry:C.value,indexObservable:r.observable(m++)},d.push(S),y.push(S),l||(E[N]=S))}}T(a.beforeMove,w),r.utils.arrayForEach(g,a.beforeRemove?r.cleanNode:r.removeNode);for(var N=0,L=r.virtualElements.firstChild(i),A,O;S=y[N];N++){S.mappedNodes||r.utils.extend(S,t(i,o,S.arrayEntry,f,S.indexObservable));for(var M=0;O=S.mappedNodes[M];L=O.nextSibling,A=O,M++)O!==L&&r.virtualElements.insertAfter(i,O,A);!S.initialized&&f&&(f(S.arrayEntry,S.mappedNodes,S.indexObservable),S.initialized=!0)}T(a.beforeRemove,b),T(a.afterMove,w),T(a.afterAdd,E),r.utils.domData.set(i,n,d)}}(),r.exportSymbol("utils.setDomNodeChildrenFromArrayMapping",r.utils.setDomNodeChildrenFromArrayMapping),r.nativeTemplateEngine=function(){this.allowTemplateRewriting=!1},r.nativeTemplateEngine.prototype=new r.templateEngine,r.nativeTemplateEngine.prototype.renderTemplateSource=function(e,t,n){var i=!(r.utils.ieVersion<9),s=i?e.nodes:null,o=s?e.nodes():null;if(o)return r.utils.makeArray(o.cloneNode(!0).childNodes);var u=e.text();return r.utils.parseHtmlFragment(u)},r.nativeTemplateEngine.instance=new r.nativeTemplateEngine,r.setTemplateEngine(r.nativeTemplateEngine.instance),r.exportSymbol("nativeTemplateEngine",r.nativeTemplateEngine),function(){r.jqueryTmplTemplateEngine=function(){function t(){if(e<2)throw new Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.")}function n(e,t,n){return o.tmpl(e,t,n)}var e=this.jQueryTmplVersion=function(){if(typeof o=="undefined"||!o.tmpl)return 0;try{if(o.tmpl.tag.tmpl.open.toString().indexOf("__")>=0)return 2}catch(e){}return 1}();this.renderTemplateSource=function(e,r,s){s=s||{},t();var u=e.data("precompiled");if(!u){var a=e.text()||"";a="{{ko_with $item.koBindingContext}}"+a+"{{/ko_with}}",u=o.template(null,a),e.data("precompiled",u)}var f=[r.$data],l=o.extend({koBindingContext:r},s.templateOptions),c=n(u,f,l);return c.appendTo(i.createElement("div")),o.fragments={},c},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){i.write("<script type='text/html' id='"+e+"'>"+t+"</script>")},e>0&&(o.tmpl.tag.ko_code={open:"__.push($1 || '');"},o.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},r.jqueryTmplTemplateEngine.prototype=new r.templateEngine;var e=new r.jqueryTmplTemplateEngine;e.jQueryTmplVersion>0&&r.setTemplateEngine(e),r.exportSymbol("jqueryTmplTemplateEngine",r.jqueryTmplTemplateEngine)}()})})(window,document,navigator,window.jQuery)}(),r("components/base",["core/clazz","core/mixin/event","knockout"],function(e,t,n){function o(e){var t=e.data.context,n=e.type;t.trigger(n)}function l(e,t){var n=t(),r=f(n)||{},i=f(r.type);if(i){var s=a[i];if(s){var o=c(r,s);o&&(e.innerHTML="",e.appendChild(o.$el[0]),$(e).addClass("qpf-wrapper")),e.setAttribute("data-qpf-guid",o.__GUID__)}else console.error("Unkown UI type, "+i)}else console.error("UI type is needed");return o}function c(e,t){var n=f(e.type),r=f(e.name),i=_.omit(e,"type","name"),s={};_.each(i,function(e,n){n.indexOf("on")==0&&t.prototype.eventsProvided.indexOf(n.substr("on".length))>=0&&typeof e=="function"&&(delete i[n],s[n.substr("on".length)]=e)});var o=new t({name:r||"",attributes:i,events:s});return o}function h(e,t){e(t());var n=_.clone(e());e.subscribe(function(e){try{_.isEqual(n,e)||(n=_.clone(e),t(e))}catch(r){console.error(r.toString())}}),t.subscribe(function(t){try{_.isEqual(n,t)||(n=_.clone(t),e(t))}catch(r){console.error(r.toString())}})}var r={},i=e.derive(function(){return{name:"",tag:"div",attr:{},$el:null,attributes:{},parent:null,skin:"",classPrefix:"qpf-ui-",skinPrefix:"qpf-skin-",id:n.observable(""),width:n.observable(),"class":n.observable(),height:n.observable(),visible:n.observable(!0),disable:n.observable(!1),style:n.observable(""),temporary:!1,events:{}}},function(){this.__GUID__=u(),this.temporary||(r[this.__GUID__]=this),this.$el||(this.$el=$(document.createElement(this.tag))),this.$el[0].setAttribute("data-qpf-guid",this.__GUID__),this.$el.attr(this.attr),this.skin&&this.$el.addClass(this.withPrefix(this.skin,this.skinPrefix)),this.css&&_.each(_.union(this.css),function(e){this.$el.addClass(this.withPrefix(e,this.classPrefix))},this),this.width.subscribe(function(e){this.$el.width(e),this.afterResize()},this),this.height.subscribe(function(e){this.$el.height(e),this.afterResize()},this),this.disable.subscribe(function(e){this.$el[e?"addClass":"removeClass"]("qpf-disable")},this),this.id.subscribe(function(e){this.$el.attr("id",e)},this),this.class.subscribe(function(e){this.$el.addClass(e)},this),this.visible.subscribe(function(e){e?this.$el.show():this.$el.hide()},this),this.style.subscribe(function(e){var t=e,r=/(\S*?)\s*:\s*(.*)/g;e="{"+_.chain(e.split(";")).map(function(e){return e.replace(/(^\s*)|(\s*$)/g,"").replace(r,'"$1":"$2"')}).filter(function(e){return e}).value().join(",")+"}";try{var i=n.utils.parseJson(e);this.$el.css(i)}catch(s){console.error("Syntax Error of style: "+t)}},this);for(var e in this.events){var t=this.events[e];typeof t=="function"&&this.on(e,t)}this._mappingAttributes(this.attributes),this.initialize(),this.trigger("initialize")},{type:"BASE",template:"",eventsProvided:["click","mousedown","mouseup","mousemove","resize","initialize","beforerender","render","dispose"],initialize:function(){},set:function(e,t){if(typeof e=="string"){var n={};n[e]=t}else n=e;this._mappingAttributes(n,!0)},render:function(){this.beforeRender&&this.beforeRender(),this.trigger("beforerender"),this.doRender(),this.afterRender&&this.afterRender(),this.trigger("render"),this.afterResize()},doRender:function(){this.$el.children().each(function(){i.disposeDom(this)}),this.$el.html(this.template),n.applyBindings(this,this.$el[0])},dispose:function(){this.$el&&this.$el.remove(),r[this.__GUID__]=null,this.trigger("dispose")},resize:function(e,t){typeof e=="number"&&this.width(e),typeof t=="number"&&this.height(t)},afterResize:function(){this.trigger("resize")},withPrefix:function(e,t){if(e.indexOf(t)!=0)return t+e},withoutPrefix:function(e,t){if(e.indexOf(t)==0)return e.substr(t.length)},_mappingAttributes:function(e,t){for(var r in e){var i=e[r],s=this[r];if(!s){var o=n.utils.unwrapObservable(i);n.isObservable(i)&&i.push||i.constructor==Array?this[r]=n.observableArray(o):this[r]=n.observable(o),s=this[r]}else n.isObservable(s)?s(n.utils.unwrapObservable(i)):this[r]=n.utils.unwrapObservable(i);t||n.isObservable(i)&&h(s,i)}}}),s=["click","mousedown","mouseup","mousemove"];i.prototype.on=function(e){s.indexOf(e)>=0&&this.$el.unbind(e,o).bind(e,{context:this},o),t.on.apply(this,arguments)},i.get=function(e){return r[e]},i.getByDom=function(e){var t=e.getAttribute("data-qpf-guid");return i.get(t)},i.disposeDom=function(e,t){function n(e){var t=e.getAttribute("data-qpf-guid"),r=i.get(t);if(r)r.dispose();else if(recursive)for(var s=0;s<e.childNodes.length;s++){var o=e.childNodes[s];o.nodeType==1&&n(o)}}typeof recursive=="undefined"&&(recursive=!0),n(e)};var u=function(){var e=0;return function(){return e++}}();n.extenders.numeric=function(e,t){var r=n.computed({read:e,write:function(r){if(r===""){e("");return}var i=parseFloat(r);i=isNaN(i)?0:i;var s=parseFloat(n.utils.unwrapObservable(t));if(!isNaN(s)){var o=Math.pow(10,s);i=Math.round(i*o)/o}e(i)}});return r(e()),r},n.extenders.clamp=function(e,t){var r=t.min,i=t.max,s=n.computed({read:e,write:function(t){var s=parseFloat(n.utils.unwrapObservable(r)),o=parseFloat(n.utils.unwrapObservable(i));isNaN(s)||(t=Math.max(s,t)),isNaN(o)||(t=Math.min(o,t)),e(t)}});return s(e()),s};var a={};i.provideBinding=function(e,t){a[e]=t},n.bindingHandlers.qpf={createComponent:function(e,t){var n=i.getByDom(e);n&&n.dispose();var r=l(e,t,a);return r},init:function(e,t){var r=n.bindingHandlers.qpf.createComponent(e,t);return r.render(),{controlsDescendantBindings:!0}},update:function(e,t){}},n.bindingHandlers.qpf_view={init:function(e,t){var r=t(),s=n.utils.unwrapObservable(r);return s&&s.$el&&(i.disposeDom(e),e.parentNode.replaceChild(s.$el[0],e)),{controlsDescendantBindings:!0}}},$.fn.qpf=function(e,t){e=e||"get";if(e==="get"){var r=[];return this.each(function(){var e=i.getByDom(this);e&&r.push(e)}),r}if(e==="init")return this.each(function(){n.applyBindings(t,this)}),this.qpf("get");e==="dispose"&&this.each(function(){i.disposeDom(this)})};var f=n.utils.unwrapObservable;return i}),r("components/util",["knockout","core/xmlparser","./base","exports"],function(e,t,n,r){r.createComponentsFromXML=function(r,i){var s=t.parse(r);e.applyBindings(i||{},s);var o=[],u=s.firstChild;while(u){var a=n.getByDom(u);a&&o.push(a),u=u.nextSibling}return o}}),function(e){typeof n=="function"&&typeof exports=="object"&&typeof module=="object"?e(n("knockout"),exports):typeof r=="function"&&r.amd?r("ko.mapping",["knockout","exports"],e):e(ko,ko.mapping={})}(function(e,t){function h(e,t){var n={};for(var r=e.length-1;r>=0;--r)n[e[r]]=e[r];for(var r=t.length-1;r>=0;--r)n[t[r]]=t[r];var i=[];for(var s in n)i.push(n[s]);return i}function p(e,n){var r;for(var i in n)if(n.hasOwnProperty(i)&&n[i]){r=t.getType(e[i]);if(i&&e[i]&&r!=="array"&&r!=="string")p(e[i],n[i]);else{var s=t.getType(e[i])==="array"&&t.getType(n[i])==="array";s?e[i]=h(e[i],n[i]):e[i]=n[i]}}}function d(e,t){var n={};return p(n,e),p(n,t),n}function v(e,t){var n=d({},e);for(var r=a.length-1;r>=0;r--){var i=a[r];if(!n[i])continue;n[""]instanceof Object||(n[""]={}),n[""][i]=n[i],delete n[i]}return t&&(n.ignore=m(t.ignore,n.ignore),n.include=m(t.include,n.include),n.copy=m(t.copy,n.copy),n.observe=m(t.observe,n.observe)),n.ignore=m(n.ignore,c.ignore),n.include=m(n.include,c.include),n.copy=m(n.copy,c.copy),n.observe=m(n.observe,c.observe),n.mappedProperties=n.mappedProperties||{},n.copiedProperties=n.copiedProperties||{},n}function m(n,r){return t.getType(n)!=="array"&&(t.getType(n)==="undefined"?n=[]:n=[n]),t.getType(r)!=="array"&&(t.getType(r)==="undefined"?r=[]:r=[r]),e.utils.arrayGetDistinctValues(n.concat(r))}function g(t,r){var s=e.dependentObservable;e.dependentObservable=function(r,s,o){o=o||{},r&&typeof r=="object"&&(o=r);var u=o.deferEvaluation,a=!1,f=function(r){var s=e.dependentObservable;e.dependentObservable=i;var o=e.isWriteableObservable(r);e.dependentObservable=s;var u=i({read:function(){return a||(e.utils.arrayRemoveItem(t,r),a=!0),r.apply(r,arguments)},write:o&&function(e){return r(e)},deferEvaluation:!0});return n&&(u._wrapper=!0),u};o.deferEvaluation=!0;var l=new i(r,s,o);return u||(l=f(l),t.push(l)),l},e.dependentObservable.fn=i.fn,e.computed=e.dependentObservable;var o=r();return e.dependentObservable=s,e.computed=e.dependentObservable,o}function y(n,i,s,a,l,c,h){var p=t.getType(e.utils.unwrapObservable(i))==="array";c=c||"";if(t.isMapped(n)){var v=e.utils.unwrapObservable(n)[r];s=d(v,s)}var m={data:i,parent:h||l},w=function(){return s[a]&&s[a].create instanceof Function},N=function(t){return g(o,function(){return e.utils.unwrapObservable(l)instanceof Array?s[a].create({data:t||m.data,parent:m.parent,skip:f}):s[a].create({data:t||m.data,parent:m.parent})})},C=function(){return s[a]&&s[a].update instanceof Function},k=function(t,n){var r={data:n||m.data,parent:m.parent,target:e.utils.unwrapObservable(t)};return e.isWriteableObservable(t)&&(r.observable=t),s[a].update(r)},L=u.get(i);if(L)return L;a=a||"";if(!p)if(!T(i))switch(t.getType(i)){case"function":C()?e.isWriteableObservable(i)?(i(k(i)),n=i):n=k(i):n=i;break;default:if(e.isWriteableObservable(n)){if(C()){var A=k(n);return n(A),A}var A=e.utils.unwrapObservable(i);return n(A),A}var O=w()||C();w()?n=N():n=e.observable(e.utils.unwrapObservable(i)),C()&&n(k(n));if(O)return n}else{n=e.utils.unwrapObservable(n);if(!n){if(w()){var M=N();return C()&&(M=k(M)),M}if(C())return k(M);n={}}C()&&(n=k(n)),u.save(i,n);if(C())return n;x(i,function(t){var r=c.length?c+"."+t:t;if(e.utils.arrayIndexOf(s.ignore,r)!=-1)return;if(e.utils.arrayIndexOf(s.copy,r)!=-1){n[t]=i[t];return}if(typeof i[t]!="object"&&typeof i[t]!="array"&&s.observe.length>0&&e.utils.arrayIndexOf(s.observe,r)==-1){n[t]=i[t],s.copiedProperties[r]=!0;return}var o=u.get(i[t]),a=y(n[t],i[t],s,t,n,r,n),f=o||a;if(s.observe.length>0&&e.utils.arrayIndexOf(s.observe,r)==-1){n[t]=f(),s.copiedProperties[r]=!0;return}e.isWriteableObservable(n[t])?n[t](e.utils.unwrapObservable(f)):(f=n[t]===undefined?f:e.utils.unwrapObservable(f),n[t]=f),s.mappedProperties[r]=!0})}else{var _=[],D=!1,P=function(e){return e};s[a]&&s[a].key&&(P=s[a].key,D=!0),e.isObservable(n)||(n=e.observableArray([]),n.mappedRemove=function(e){var t=typeof e=="function"?e:function(t){return t===P(e)};return n.remove(function(e){return t(P(e))})},n.mappedRemoveAll=function(t){var r=S(t,P);return n.remove(function(t){return e.utils.arrayIndexOf(r,P(t))!=-1})},n.mappedDestroy=function(e){var t=typeof e=="function"?e:function(t){return t===P(e)};return n.destroy(function(e){return t(P(e))})},n.mappedDestroyAll=function(t){var r=S(t,P);return n.destroy(function(t){return e.utils.arrayIndexOf(r,P(t))!=-1})},n.mappedIndexOf=function(t){var r=S(n(),P),i=P(t);return e.utils.arrayIndexOf(r,i)},n.mappedCreate=function(t){if(n.mappedIndexOf(t)!==-1)throw new Error("There already is an object with the key that you specified.");var r=w()?N(t):t;if(C()){var i=k(r,t);e.isWriteableObservable(r)?r(i):r=i}return n.push(r),r});var H=S(e.utils.unwrapObservable(n),P).sort(),B=S(i,P);D&&B.sort();var j=e.utils.compareArrays(H,B),F={},I,q,R=e.utils.unwrapObservable(i),U={},z=!0;for(I=0,q=R.length;I<q;I++){var W=P(R[I]);if(W===undefined||W instanceof Object){z=!1;break}U[W]=R[I]}var X=[],V=0;for(I=0,q=j.length;I<q;I++){var W=j[I],$,J=c+"["+I+"]";switch(W.status){case"added":var K=z?U[W.value]:E(e.utils.unwrapObservable(i),W.value,P);$=y(undefined,K,s,a,n,J,l),w()||($=e.utils.unwrapObservable($));var Q=b(e.utils.unwrapObservable(i),K,F);$===f?V++:X[Q-V]=$,F[Q]=!0;break;case"retained":var K=z?U[W.value]:E(e.utils.unwrapObservable(i),W.value,P);$=E(n,W.value,P),y($,K,s,a,n,J,l);var Q=b(e.utils.unwrapObservable(i),K,F);X[Q]=$,F[Q]=!0;break;case"deleted":$=E(n,W.value,P)}_.push({event:W.status,item:$})}n(X),s[a]&&s[a].arrayChanged&&e.utils.arrayForEach(_,function(e){s[a].arrayChanged(e.event,e.item)})}return n}function b(e,t,n){for(var r=0,i=e.length;r<i;r++){if(n[r]===!0)continue;if(e[r]===t)return r}return null}function w(n,r){var i;return r&&(i=r(n)),t.getType(i)==="undefined"&&(i=n),e.utils.unwrapObservable(i)}function E(t,n,r){t=e.utils.unwrapObservable(t);for(var i=0,s=t.length;i<s;i++){var o=t[i];if(w(o,r)===n)return o}throw new Error("When calling ko.update*, the key '"+n+"' was not found!")}function S(t,n){return e.utils.arrayMap(e.utils.unwrapObservable(t),function(e){return n?w(e,n):e})}function x(e,n){if(t.getType(e)==="array")for(var r=0;r<e.length;r++)n(r);else for(var i in e)n(i)}function T(e){var n=t.getType(e);return(n==="object"||n==="array")&&e!==null}function N(e,n,r){var i=e||"";return t.getType(n)==="array"?e&&(i+="["+r+"]"):(e&&(i+="."),i+=r),i}function C(){var t=[],n=[];this.save=function(r,i){var s=e.utils.arrayIndexOf(t,r);s>=0?n[s]=i:(t.push(r),n.push(i))},this.get=function(r){var i=e.utils.arrayIndexOf(t,r),s=i>=0?n[i]:undefined;return s}}function k(){var e={},t=function(t){var n;try{n=t}catch(r){n="$$$"}var i=e[n];return i===undefined&&(i=new C,e[n]=i),i};this.save=function(e,n){t(e).save(e,n)},this.get=function(e){return t(e).get(e)}}var n=!0,r="__ko_mapping__",i=e.dependentObservable,s=0,o,u,a=["create","update","key","arrayChanged"],f={},l={include:["_destroy"],ignore:[],copy:[],observe:[]},c=l;t.isMapped=function(t){var n=e.utils.unwrapObservable(t);return n&&n[r]},t.fromJS=function(e){if(arguments.length==0)throw new Error("When calling ko.fromJS, pass the object you want to convert.");s=0,s++||(o=[],u=new k);var t,n;arguments.length==2&&(arguments[1][r]?n=arguments[1]:t=arguments[1]),arguments.length==3&&(t=arguments[1],n=arguments[2]),n&&(t=d(t,n[r])),t=v(t);var i=y(n,e,t);return n&&(i=n),--s||window.setTimeout(function(){while(o.length){var e=o.pop();e&&e()}},0),i[r]=d(i[r],t),i},t.fromJSON=function(n){var r=e.utils.parseJson(n);return arguments[0]=r,t.fromJS.apply(this,arguments)},t.updateFromJS=function(e){throw new Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!")},t.updateFromJSON=function(e){throw new Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!")},t.toJS=function(n,i){c||t.resetDefaultOptions();if(arguments.length==0)throw new Error("When calling ko.mapping.toJS, pass the object you want to convert.");if(t.getType(c.ignore)!=="array")throw new Error("ko.mapping.defaultOptions().ignore should be an array.");if(t.getType(c.include)!=="array")throw new Error("ko.mapping.defaultOptions().include should be an array.");if(t.getType(c.copy)!=="array")throw new Error("ko.mapping.defaultOptions().copy should be an array.");return i=v(i,n[r]),t.visitModel(n,function(t){return e.utils.unwrapObservable(t)},i)},t.toJSON=function(n,r){var i=t.toJS(n,r);return e.utils.stringifyJson(i)},t.defaultOptions=function(){if(!(arguments.length>0))return c;c=arguments[0]},t.resetDefaultOptions=function(){c={include:l.include.slice(0),ignore:l.ignore.slice(0),copy:l.copy.slice(0)}},t.getType=function(e){if(e&&typeof e=="object"){if(e.constructor==(new Date).constructor)return"date";if(Object.prototype.toString.call(e)==="[object Array]")return"array"}return typeof e},t.visitModel=function(n,i,s){s=s||{},s.visitedObjects=s.visitedObjects||new k;var o,u=e.utils.unwrapObservable(n);if(!T(u))return i(n,s.parentName);s=v(s,u[r]),i(n,s.parentName),o=t.getType(u)==="array"?[]:{},s.visitedObjects.save(n,o);var a=s.parentName;return x(u,function(n){if(s.ignore&&e.utils.arrayIndexOf(s.ignore,n)!=-1)return;var f=u[n];s.parentName=N(a,u,n);if(e.utils.arrayIndexOf(s.copy,n)===-1&&e.utils.arrayIndexOf(s.include,n)===-1&&u[r]&&u[r].mappedProperties&&!u[r].mappedProperties[n]&&u[r].copiedProperties&&!u[r].copiedProperties[n]&&t.getType(u)!=="array")return;var l;switch(t.getType(e.utils.unwrapObservable(f))){case"object":case"array":case"undefined":var c=s.visitedObjects.get(f);o[n]=t.getType(c)!=="undefined"?c:t.visitModel(f,i,s);break;default:o[n]=i(f,s.parentName)}}),o}}),r("components/meta/meta",["../base","knockout","ko.mapping"],function(e,t,n){var r=e.derive({},{type:"META",css:"meta"});return r.provideBinding=e.provideBinding,r}),r("components/meta/button",["./meta","core/xmlparser","knockout"],function(e,t,n){var r=e.derive(function(){return{$el:$('<button data-bind="html:text"></button>'),text:n.observable("Button")}},{type:"BUTTON",css:"button",afterRender:function(){var e=this}});return e.provideBinding("button",r),t.provideParser("button",function(e){var n=t.util.getTextContent(e);if(n)return{text:n}}),r}),function(e){typeof r!="undefined"&&r.amd?r("goo",["exports"],e):e(window.GooJS={})}(function(e){function r(e,t,n){if(!e)return;if(Array.prototype.forEach)Array.prototype.forEach.call(e,t,n);else for(var r=0;r<e.length;r++)t.call(n,e[r],r)}function i(e){return r(Array.prototype.slice.call(arguments,1),function(t,n){if(t)for(var r in t)e[r]=t[r]}),e}function s(e){return(e||"").replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"")}function o(e,t,n){typeof t=="object"&&(n=t,t=null);var r={"instanceof":function(e){var t=o;while(t){if(t===e)return!0;t=t.__super__}}},s=this,o=function(n){s.call(this),i(this,typeof e=="function"?e.call(this):e);for(var r in n)typeof this[r]=="undefined"&&console.warn(r+" is not an option");i(this,n);if(this.constructor==o){var u=o,a=[t];while(u.__super__)u=u.__super__,a.unshift(u.__initialize__);for(var f=0;f<a.length;f++)a[f]&&a[f].call(this)}};return o.__super__=s,o.__initialize__=t,i(o.prototype,s.prototype,r,n),o.prototype.constructor=o,o.derive=s.derive,o}function u(e){this.cancelBubble=!1,i(this,e)}var t=e;t.create=function(e){function h(e){e&&(n[e.__GUID__]=e)}function p(e){typeof e=="string"&&(e=elementsMap[e]),delete n[e.__GUID__]}function d(){function h(e){if(!e.visible)return;i.save();if(e.style)if(!e.style instanceof t.Style)for(var n in e.style)e.style[n].bind(i);else e.style.bind(i);e._transform&&i.transform(e._transform[0],e._transform[1],e._transform[2],e._transform[3],e._transform[4],e._transform[5]),e.draw(i),e.clip&&i.clip();var r=d(e.children);for(var s=0;s<r.length;s++)h(r[s]);i.restore()}function p(e){if(!e.visible)return;l.push(e),f.save();var n=E(l.length),r="rgb("+n.r+","+n.g+","+n.b+")";f.fillStyle=r,f.strokeStyle=r,e.intersectLineWidth?f.lineWidth=e.intersectLineWidth:e.style&&e.style.lineWidth&&(f.lineWidth=e.style.lineWidth),e._transform&&f.transform(e._transform[0],e._transform[1],e._transform[2],e._transform[3],e._transform[4],e._transform[5]),e instanceof t.Text||e instanceof t.Image||e.draw(f),e.clip&&f.clip();var i=d(e.children);for(var s=0;s<i.length;s++)p(i[s]);f.restore()}function d(e){var t=[];for(var n in e)t.push(e[n]);return t.sort(function(e,t){return e.z==t.z?e.__GUID__>t.__GUID__?1:-1:e.z>t.z?1:-1}),t}i.clearRect(0,0,s,o),f.clearRect(0,0,s,o),l=[];var e=d(n);for(var r=0;r<e.length;r++){var u=e[r];h(u),p(u)}c=f.getImageData(0,0,a.width,a.height)}function v(e){var t=e.pageX-this.offsetLeft,n=e.pageY-this.offsetTop,r=this,i={};while(r=r.offsetParent)t-=r.offsetLeft,n-=r.offsetTop;return{x:t,y:n,pageX:e.pageX,pageY:e.pageY}}function m(e){x.call(this,e,"click")}function g(e){x.call(this,e,"mousedown")}function y(e){var t=v.call(this,e);for(var n=0;n<l.length;n++){var r=l[n];u.throw("mouseup",r,t)}}function b(e){var t=v.call(this,e);for(var n=0;n<l.length;n++){var r=l[n];u.throw("mousemove",r,t)}var i=x.call(this,e,"mouseover");i&&(i.__mouseover__=!0)}function w(e){var t=v.call(this,e);for(var n=0;n<l.length;n++){var r=l[n];r.__mouseover__&&(u.throw("mouseout",r,t),r.__mouseover__=!1)}}function E(e){var t=e>>16,n=e-(t<<8)>>8,r=e-(t<<16)-(n<<8);return{r:t,g:n,b:r}}function S(e,t,n){return(e<<16)+(t<<8)+n}function x(e,t){var n=v.call(this,e),r=n.x,i=n.y,s=null,o=((i-1)*a.width+r-1)*4,f=c.data[o],h=c.data[o+1],p=c.data[o+2],d=c.data[o+3],m=S(f,h,p);if(m&&(d==255||d==0)){s=l[m-1];if(t=="mouseover"&&s.__mouseover__)return null;u.throw(t,s,n)}for(var g=0;g<l.length;g++){var y=l[g];y.__mouseover__&&y!=s&&(u.throw("mouseout",y,n),y.__mouseover__=!1)}return s}function T(e){typeof e=="string"&&(e=document.getElementById(e)),r=e,s=e.width,o=e.height,i=e.getContext("2d"),a=document.createElement("canvas"),a.width=s,a.height=o,f=a.getContext("2d")}function N(e,t){r.width=e,r.height=t,a.width=e,a.height=t,s=e,o=t}var n={},r=null,i=null,s=0,o=0,a=null,f=null,l=[],c;return T(e),{add:h,remove:p,render:d,initContext:T,resize:N,getContext:function(){return i},getClientWidth:function(){return s},getClientHeight:function(){return o},getContainer:function(){return r},getGhostCanvas:function(){return a},getGhostContext:function(){return f}}},t.Util={};var n=function(){var e=0;return function(){return++e}}();u.prototype.stopPropagation=function(){this.cancelBubble=!0},u.throw=function(e,t,n){var r=new u(n);r.sourceTarget=t;while(t&&!r.cancelBubble)r.target=t,t.trigger(e,r),t=t.parent};var a={trigger:function(){if(!this.__handlers__)return;var e=arguments[0],t=Array.prototype.slice.call(arguments,1),n=this.__handlers__[e];if(n)for(var r=0;r<n.length;r+=2){var i=n[r],s=n[r+1];i.apply(s||this,t)}},on:function(e,t,n){if(!e)return;var r=this.__handlers__||(this.__handlers__={});r[e]||(r[e]=[]),r[e].indexOf(t)==-1&&(r[e].push(t),r[e].push(n))},off:function(e,t){var n=this.__handlers__;if(n[e])if(t){var r=n[e];r.splice(r.indexOf(t),2)}else n[e]=[]}};t.Event=a,_Math={},t.Math=_Math,_Math.max=function(e){var t=0;for(var n=0;n<e.length;n++)e[n]>t&&(t=e[n]);return t},_Math.min=function(e){var t=9999999999;for(var n=0;n<e.length;n++)e[n]<t&&(t=e[n]);return t},_Math.computeAABB=function(e){var t=e[0][0],n=e[0][0],r=e[0][1],i=e[0][1];for(var s=1;s<e.length;s++)t=e[s][0]<t?e[s][0]:t,n=e[s][0]>n?e[s][0]:n,r=e[s][1]<r?e[s][1]:r,i=e[s][1]>i?e[s][1]:i;return[[t,r],[n,i]]},_Math.intersectAABB=function(e,t){var n=e[0],r=e[1];return t[0][0]<n&&n<t[1][0]&&t[0][1]<r&&r<t[1][1]};var f=[.5,.5];_Math.fixPos=function(e){return _Math.Vector.add(e,f)},_Math.fixPosArray=function(e){var t=[],n=e.length;for(var r=0;r<n;r++)t.push(_Math.Vector.add(e[r],f));return t},_Math.unfixAA=function(e){return _Math.Vector.sub(e,[.5,.5])},_Math.Vector={},_Math.Vector.add=function(e,t){return[e[0]+t[0],e[1]+t[1]]},_Math.Vector.sub=function(e,t){return[e[0]-t[0],e[1]-t[1]]},_Math.Vector.abs=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},_Math.Vector.mul=function(e,t){return[e[0]*t[0],e[1]*t[1]]},_Math.Vector.scale=function(e,t){return[e[0]*t,e[1]*t]},_Math.Vector.expand=function(e){return[e[0],e[0],1]},_Math.Vector.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},_Math.Vector.normalize=function(e){var t=_Math.Vector.length(e),n=[];return n[0]=e[0]/t,n[1]=e[1]/t,n},_Math.Vector.distance=function(e,t){return this.length(this.sub(e,t))},_Math.Vector.middle=function(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]},_Math.Matrix={},_Math.Matrix.identity=function(){return[1,0,0,1,0,0]},_Math.Matrix.mul=function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},_Math.Matrix.translate=function(e,t){return this.mul([1,0,0,1,t[0],t[1]],e)},_Math.Matrix.rotate=function(e,t){var n=Math.sin(t),r=Math.cos(t);return this.mul([r,n,-n,r,0,0],e)},_Math.Matrix.scale=function(e,t){return this.mul([t[0],0,0,t[1],0,0],e)},_Math.Matrix.inverse=function(e){var t=e[4]*e[8]-e[5]*e[7],n=e[1]*e[8]-e[2]*e[7],r=e[1]*e[5]-e[2]*e[4],i=1/(e[0]*t-e[3]*n+e[6]*r);return[i*t,-i*n,i*r,-i*(e[3]*e[8]-e[5]*e[6]),i*(e[0]*e[8]-e[2]*e[6]),-i*(e[0]*e[5]-e[2]*e[3]),i*(e[3]*e[7]-e[4]*e[6]),-i*(e[0]*e[7]-e[1]*e[6]),i*(e[0]*e[4]-e[1]*e[3])]},_Math.Matrix.expand=function(e){return[e[0],e[1],0,e[2],e[3],0,e[4],e[5],1]},_Math.Matrix.mulVector=function(e,t){var n=[];for(var r=0;r<3;r++)n[r]=t[0]*e[r]+t[1]*e[r+3]+t[2]*e[r+6];return n},t.Element=function(){this.__mouseover__=!1,this.id=0,this.__GUID__=n(),this.AABB=[[0,0],[0,0]],this.z=0,this.style=null,this._position=[0,0],this._rotation=0,this._scale=[1,1],this._transform=null,this._transformInverse=null,this._data={},this.visible=!0,this.children={},this.intersectLineWidth=0},t.Element.prototype={fill:!0,stroke:!0,clip:!1,fixAA:!0,intersectAABB:function(e,t){return _Math.intersectAABB([e,t],this.AABB)},position:function(e,t){this._position=[e,t],this.updateTransform()},rotation:function(e){this._rotation=e,this.updateTransform()},scale:function(e){typeof e=="number"&&(e=[e,e]),this._scale=e,this.updateTransform()},updateTransform:function(){var e=_Math.Matrix,t=e.identity();return this._scale&&(t=e.scale(t,this._scale)),this._rotation&&(t=e.rotate(t,this._rotation)),this._position&&(t=e.translate(t,this._position)),this._transform=t,t},updateTransformInverse:function(){this._transformInverse=_Math.Matrix.inverse(_Math.Matrix.expand(this._transform))},getTransformInverse:function(){return this._transformInverse},getTransform:function(){return this._transform||this.updateTransform(),this._transform},setTransform:function(e){this._transform=e},pushMatrix:function(e){this._transform=_Math.Matrix.mul(e,this._transform)},popMatrix:function(){var e=this._transform;return this._transform=_Math.Matrix.identity(),e},getTransformedAABB:function(){var e=[],t=_Math.Matrix,n=_Math.Vector;return e[0]=t.mulVector(this._transform,n.expand(this.AABB[0])),e[1]=t.mulVector(this._transform,n.expand(this.AABB[1])),e[2]=t.mulVector(this._transform,[this.AABB[0][0],this.AABB[1][1],1]),e[3]=t.mulVector(this._transform,[this.AABB[1][0],this.AABB[0][1],1]),_Math.computeAABB(e)},intersect:function(e,t,n){},draw:function(e){},computeAABB:function(){},add:function(e){e&&(this.children[e.__GUID__]=e,e.parent=this)},remove:function(e){delete this.children[e.__GUID__],e.parent=null},data:function(e,t){return typeof t=="undefined"?this._data[e]:(this._data[e]=t,this._data[e])}},i(t.Element.prototype,a),t.Element.derive=o,t.Style=function(e){i(this,e)},t.Style.__STYLES__=["fillStyle","strokeStyle","lineWidth","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","globalAlpha","font"],t.Style.__STYLEALIAS__={fill:"fillStyle",stroke:"strokeStyle",alpha:"globalAlpha",shadow:["shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor"]};var l=/(.*?)\s+(.*?)\s+(.*?)\s+(rgb\(.*?\))/;t.Style.prototype.bind=function(e){var n=t.Style.__STYLES__,i=t.Style.__STYLEALIAS__;for(var o in i)if(this.hasOwnProperty(o)){var u=i[o],a=this[o];if(u.constructor==Array){var f=l.exec(s(a));if(!f)continue;a=f.slice(1),r(a,function(t,n){u[n]&&(e[u[n]]=t)},this)}else e[u]=a}r(n,function(t){this.hasOwnProperty(t)&&(e[t]=this[t])},this)},t.Line=t.Element.derive(function(){return{start:[0,0],end:[0,0],width:0}},{computeAABB:function(){this.AABB=_Math.computeAABB([this.start,this.end]),this.AABB[0][0]==this.AABB[1][0]&&(this.AABB[0][0]-=this.width/2,this.AABB[1][0]+=this.width/2),this.AABB[0][1]==this.AABB[1][1]&&(this.AABB[0][1]-=this.width/2,this.AABB[1][1]+=this.width/2)},draw:function(e){var t=this.fixAA?_Math.fixPos(this.start):this.start,n=this.fixAA?_Math.fixPos(this.end):this.end;e.beginPath(),e.moveTo(t[0],t[1]),e.lineTo(n[0],n[1]),e.stroke()},intersect:function(e,t){if(!this.intersectAABB(e,t))return!1;var n=_Math.Vector,r=[e,t];b=this.start,c=this.end,ba=[r[0]-b[0],r[1]-b[1]],bc=[c[0]-b[0],c[1]-b[1]],dd=n.dot(n.normalize(bc),ba),d=n.add(b,n.scale(n.normalize(bc),dd));var i=n.length(n.sub(r,d));return i<this.width/2}}),t.Rectangle=t.Element.derive(function(){return{start:[0,0],size:[0,0]}},{computeAABB:function(){this.AABB=_Math.computeAABB([this.start,_Math.Vector.add(this.start,this.size)])},draw:function(e){var t=this.fixAA?_Math.fixPos(this.start):this.start;e.beginPath(),e.rect(t[0],t[1],this.size[0],this.size[1]),this.stroke&&e.stroke(),this.fill&&e.fill()},intersect:function(e,t){return this.intersectAABB(e,t)}}),t.RoundedRectangle=t.Element.derive(function(){return{start:[0,0],size:[0,0],radius:0}},{computeAABB:function(){this.AABB=_Math.computeAABB([this.start,_Math.Vector.add(this.start,this.size)])},draw:function(e){if(this.radius.constructor==Number)var t=[this.radius,this.radius,this.radius,this.radius];else if(this.radius.length==2)var t=[this.radius[0],this.radius[1],this.radius[0],this.radius[1]];else var t=this.radius;var n=_Math.Vector,r=this.fixAA?_Math.fixPos(this.start):this.start,i=this.size,s=n.add(r,[t[0],0]),o=n.add(r,[i[0],0]),u=n.add(r,i),a=n.add(r,[0,i[1]]);e.beginPath(),e.moveTo(s[0],s[1]),t[1]?e.arcTo(o[0],o[1],u[0],u[1],t[1]):e.lineTo(o[0],o[1]),t[2]?e.arcTo(u[0],u[1],a[0],a[1],t[2]):e.lineTo(u[0],u[1]),t[3]?e.arcTo(a[0],a[1],r[0],r[1],t[3]):e.lineTo(a[0],a[1]),t[0]?e.arcTo(r[0],r[1],o[0],o[1],t[0]):e.lineTo(r[0],r[1]),this.stroke&&e.stroke(),this.fill&&e.fill()},intersect:function(e,t){return!1}}),t.Circle=t.Element.derive(function(){return{center:[0,0],radius:0}},{computeAABB:function(){this.AABB=[[this.center[0]-this.radius,this.center[1]-this.radius],[this.center[0]+this.radius,this.center[1]+this.radius]]},draw:function(e){var t=this.fixAA?_Math.fixPos(this.center):this.center;e.beginPath(),e.arc(t[0],t[1],this.radius,0,2*Math.PI,!1),this.stroke&&e.stroke(),this.fill&&e.fill()},intersect:function(e,t){return _Math.Vector.length([this.center[0]-e,this.center[1]-t])<this.radius}}),t.Arc=t.Element.derive(function(){return{center:[0,0],radius:0,startAngle:0,endAngle:Math.PI*2,clockwise:!0}},{computeAABB:function(){this.AABB=[[0,0],[0,0]]},draw:function(e){var t=this.fixAA?_Math.fixPos(this.center):this.center;e.beginPath(),e.arc(t[0],t[1],this.radius,this.startAngle,this.endAngle,!this.clockwise),this.stroke&&e.stroke(),this.fill&&e.fill()},intersect:function(e,t){return!1}}),t.Polygon=t.Element.derive(function(){return{points:[]}},{computeAABB:function(){this.AABB=_Math.computeAABB(this.points)},draw:function(e){var t=this.fixAA?_Math.fixPosArray(this.points):this.points;e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(var n=1;n<t.length;n++)e.lineTo(t[n][0],t[n][1]);e.closePath(),this.stroke&&e.stroke(),this.fill&&e.fill()},intersect:function(e,t){if(!this.intersectAABB(e,t))return!1;var n=this.points.length,r=0,i=_Math.Vector,s=this.points;for(var o=0;o<n;o++){var u=i.normalize([s[o][0]-e,s[o][1]-t]),a=(o+1)%n,f=i.normalize([s[a][0]-e,s[a][1]-t]),l=Math.acos(i.dot(u,f));r+=l}return Math.length(r-2*Math.PI)<.1}}),t.Sector=t.Element.derive(function(){return{center:[0,0],innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,clockwise:!0}},{computeAABB:function(){this.AABB=[0,0]},intersect:function(e,t){var n=_Math.Vector,r=this.startAngle,i=this.endAngle,s=this.innerRadius,o=this.outerRadius,u=this.center,a=n.sub([e,t],u),f=n.length(a),l=Math.PI*2;if(f<s||f>o)return!1;var c=Math.atan2(a[1],a[0]);return c<0&&(c+=l),this.clockwise?c<i&&c>r:(r=l-r,i=l-i,c>i&&c<r)},draw:function(e){var t=_Math.Vector;startAngle=this.startAngle,endAngle=this.endAngle,r1=this.innerRadius,r2=this.outerRadius,c=this.fixAA?_Math.fixPos(this.center):this.center,this.clockwise||(startAngle=Math.PI*2-startAngle,endAngle=Math.PI*2-endAngle);var n=t.add(c,[r1*Math.cos(startAngle),r1*Math.sin(startAngle)]),r=t.add(c,[r2*Math.cos(startAngle),r2*Math.sin(startAngle)]),i=t.add(c,[r1*Math.cos(endAngle),r1*Math.sin(endAngle)]),s=t.add(c,[r2*Math.cos(endAngle),r2*Math.sin(endAngle)]);e.beginPath(),e.moveTo(n[0],n[1]),e.lineTo(r[0],r[1]),e.arc(c[0],c[1],r2,startAngle,endAngle,!this.clockwise),e.lineTo(i[0],i[1]),e.arc(c[0],c[1],r1,endAngle,startAngle,this.clockwise),this.stroke&&e.stroke(),this.fill&&e.fill()}}),t.Path=t.Element.derive(function(){return{segments:[],globalStyle:!0}},{computeAABB:function(){this.AABB=[[0,0],[0,0]]},draw:function(e){this.globalStyle?this.drawWithSameStyle(e):this.drawWithDifferentStyle(e)},drawWithSameStyle:function(e){var t=this.segments.length,n=this.segments;e.beginPath(),e.moveTo(n[0].point[0],n[0].point[1]);for(var r=1;r<t;r++)if(n[r-1].handleOut||n[r].handleIn){var i=n[r-1].handleOut||n[r-1].point,s=n[r].handleIn||n[r].point;e.bezierCurveTo(i[0],i[1],s[0],s[1],n[r].point[0],n[r].point[1])}else e.lineTo(n[r].point[0],n[r].point[1]);this.fill&&e.fill(),this.stroke&&e.stroke()},drawWithDifferentStyle:function(e){var t=this.segments.length,n=this.segments;for(var r=0;r<t-1;r++){e.save(),n[r].style&&n[r].style.bind(e),e.beginPath(),e.moveTo(n[r].point[0],n[r].point[1]);if(n[r].handleOut||n[r+1].handleIn){var i=n[r].handleOut||n[r].point,s=n[r+1].handleIn||n[r+1].point;e.bezierCurveTo(i[0],i[1],s[0],s[1],n[r+1].point[0],n[r+1].point[1])}else e.lineTo(n[r+1].point[0],n[r+1].point[1]);this.stroke&&e.stroke(),this.fill&&e.fill(),e.restore()}},smooth:function(e){function s(e,n,r){var i=t.middle(n,r);return t.sub(e,i)}var t=_Math.Vector,n=this.segments.length,r=[],i=this.segments;for(var o=0;o<n;o++){var u=i[o].point,a=o==n-1?i[0].point:i[o+1].point;r.push(t.middle(u,a))}for(var o=0;o<n;o++){var u=i[o].point,f=r[o],l=o==0?r[n-1]:r[o-1],e=i[o].smoothLevel||e||1,c=t.middle(f,l);v1=t.sub(f,c),v2=t.sub(l,c);var h=s(u,l,f);i[o].handleIn=t.add(t.add(c,t.scale(v2,e)),h),i[o].handleOut=t.add(t.add(c,t.scale(v1,e)),h)}i[0].handleOut=i[0].handleIn=null,i[n-1].handleIn=i[n-1].handleOut=null},pushPoints:function(e){for(var t=0;t<e.length;t++)this.segments.push({point:e[t],handleIn:null,handleOut:null})}}),t.Image=t.Element.derive(function(){return{img:"",start:[0,0],size:0,onload:function(){}}},function(){if(typeof this.img=="string"){var e=this;t.Image.load(this.img,function(t){e.img=t,e.onload.call(e)})}},{computeAABB:function(){this.AABB=_Math.computeAABB([this.start,[this.start[0]+this.size[0],this.start[1]+this.size[1]]])},draw:function(e){var t=this.fixAA?_Math.fixPos(this.start):this.start;typeof this.img!="string"&&(this.size?e.drawImage(this.img,t[0],t[1],this.size[0],this.size[1]):e.drawImage(this.img,t[0],t[1]))},intersect:function(e,t){return this.intersectAABB(e,t)}}),_imageCache={},t.Image.load=function(e,t){if(_imageCache[e]){var n=_imageCache[e];n.constructor==Array?n.push(t):t(n)}else{_imageCache[e]=[t];var n=new Image;n.onload=function(){r(_imageCache[e],function(e){e(n)}),_imageCache[e]=n},n.src=e}},t.Text=t.Element.derive(function(){return{text:"",start:[0,0],size:[0,0],font:"",textAlign:"",textBaseline:""}},{computeAABB:function(){this.AABB=_Math.computeAABB([this.start,[this.start[0]+this.size[0],this.start[1]+this.size[1]]])},draw:function(e){var t=this.fixAA?_Math.fixPos(this.start):this.start;this.font&&(e.font=this.font),this.textAlign&&(e.textAlign=this.textAlign),this.textBaseline&&(e.textBaseline=this.textBaseline),this.fill&&(this.size.length&&this.size[0]?e.fillText(this.text,t[0],t[1],this.size[0]):e.fillText(this.text,t[0],t[1])),this.stroke&&(this.size.length&&this.size[0]?e.strokeText(this.text,t[0],t[1],this.size[0]):e.strokeText(this.text,t[0],t[1]))},resize:function(e){if(!this.size[0]||this.needResize)this.size[0]=e.measureText(this.text).width,this.size[1]=e.measureText("m").width},intersect:function(e,t){return this.intersectAABB(e,t)}}),t.TextBox=t.Element.derive(function(){return{text:"",textAlign:"",textBaseline:"top",font:"",start:[0,0],width:0,wordWrap:!1,wordBreak:!1,lineHeight:0,stroke:!1,_texts:[]}},function(){this._oldText=""},{computeAABB:function(){},draw:function(e){if(this.text!=this._oldText){this._oldText=this.text,this.font&&(e.font=this.font);if(this.wordBreak)this._texts=this.computeWordBreak(e);else if(this.wordWrap)this._texts=this.computeWordWrap(e);else{var n=new t.Text({text:this.text,textBaseline:this.textBaseline});this.extendCommonProperties(n),this._texts=[n]}}r(this._texts,function(t){t.draw(e)})},computeWordWrap:function(e){if(!this.text)return;var n=this.text.split(" "),r=n.length,i=0,s,o,u=[],a;for(var f=0;f<r;f++)o=f==r-1?n[f]:n[f]+" ",s=e.measureText(o).width,i+s>this.width||!a?(a=new t.Text({text:o,start:_Math.Vector.add(this.start,[0,this.lineHeight*u.length])}),this.extendCommonProperties(a),u.push(a),i=s):(i+=s,a.text+=o);return u},computeWordBreak:function(e){if(!this.text)return;var n=this.text.length,r,i,s=e.measureText(this.text[0]).width,o=[],u;for(var a=0;a<n;a++){i=this.text[a],r=e.measureText(i).width;if(s+r>this.width||!u){var u=new t.Text({text:i,start:_Math.Vector.add(this.start,[0,this.lineHeight*o.length])});this.extendCommonProperties(u),o.push(u),s=r}else s+=r,u.text+=i}return o},extendCommonProperties:function(e){var t={};i(e,{textAlign:this.textAlign,textBaseline:this.textBaseline,style:this.style,font:this.font,fill:this.fill,stroke:this.stroke})},intersect:function(e,t){}})}),r("components/meta/canvas",["goo","knockout","./meta"],function(e,t,n){var r=n.derive(function(){return{tag:"canvas",framerate:t.observable(0),stage:null}},{type:"CANVAS",css:"canvas",initialize:function(){this.stage=e.create(this.$el[0]),this.framerate.subscribe(function(e){e?this.run(e):this.stop()}),this.afterResize()},_runInstance:0,run:function(e){this._runInstance&&clearTimeout(this._runInstance),this._runInstance=setTimeout(this.render.bind(this),1e3/e)},stop:function(){clearTimeout(this._runInstance),this._runInstance=0},doRender:function(){this.stage.render()},afterResize:function(){if(this.stage){var e=this.width(),t=this.height();e&&t&&this.stage.resize(e,t),this.doRender()}}});return n.provideBinding("canvas",r),r}),r("components/meta/checkbox",["./meta","knockout"],function(e,t){var n=e.derive(function(){return{checked:t.observable(!1),label:t.observable("")}},{template:'<input type="checkbox" data-bind="checked:checked" />				<span data-bind="css:{checked:checked}"></span>				<label data-bind="text:label"></label>',type:"CHECKBOX",css:"checkbox",afterRender:function(){var e=this;this.$el.click(function(){e.checked(!e.checked())})}});return e.provideBinding("checkbox",n),n}),r("components/meta/combobox",["./meta","core/xmlparser","knockout"],function(e,t,n){var r=e.derive(function(){return{$el:$('<div data-bind="css:{active:active}" tabindex="0"></div>'),value:n.observable(),items:n.observableArray(),defaultText:n.observable("select"),active:n.observable(!1)}},{type:"COMBOBOX",css:"combobox",eventsProvided:_.union(e.prototype.eventsProvided,"change"),initialize:function(){this.selectedText=n.computed(function(){var e=this.value(),t=_.filter(this.items(),function(t){return n.utils.unwrapObservable(t.value)==e})[0];return typeof t=="undefined"?this.defaultText():n.utils.unwrapObservable(t.text)},this)},template:'<div class="qpf-combobox-selected" data-bind="click:_toggle">					<div class="qpf-left" data-bind="html:selectedText"></div>					<div class="qpf-right qpf-common-button">						<div class="qpf-icon"></div>					</div>				</div>				<ul class="qpf-combobox-items" data-bind="foreach:items">					<li data-bind="html:text,attr:{\'data-qpf-value\':value},click:$parent._select.bind($parent,value),css:{selected:$parent._isSelected(value)}"></li>				</ul>',afterRender:function(){var e=this;this._$selected=this.$el.find(".qpf-combobox-selected"),this._$items=this.$el.find(".qpf-combobox-items"),this.$el.blur(function(){e._blur()})},_focus:function(){this.active(!0)},_blur:function(){this.active(!1)},_toggle:function(){this.active(!this.active())},_select:function(e){e=n.utils.unwrapObservable(e),this.value(e),this._blur()},_isSelected:function(e){return this.value()===n.utils.unwrapObservable(e)}});return e.provideBinding("combobox",r),t.provideParser("combobox",function(e){var n=[],r=t.util.getChildrenByTagName(e,"item");_.each(r,function(e){var r=e.getAttribute("value"),i=e.getAttribute("text")||t.util.getTextContent(e);r!==null&&n.push({value:r,text:i})});if(n.length)return{items:n}}),r}),r("components/meta/label",["./meta","core/xmlparser","knockout"],function(e,t,n){var r=e.derive(function(){return{text:n.observable("Label")}},{template:'<Label data-bind="html:text"></Label>',type:"LABEL",css:"label"});return e.provideBinding("label",r),t.provideParser("label",function(e){var n=t.util.getTextContent(e);if(n)return{text:n}}),r}),r("components/mixin/draggable",["core/mixin/derive","core/mixin/event","knockout"],function(e,t,n){var r=new Function;_.extend(r,e),_.extend(r.prototype,t);var i=r.derive(function(){return{id:0,target:null,handle:null,margins:{},originPosition:{},offsetParentOffset:{},width:0,height:0,positionType:"",data:{},host:null}},{setData:function(e){},remove:function(){this.host.remove(this.target)}}),s=r.derive(function(){return{items:{},axis:null,container:null,helper:null,_boundingBox:null,_mouseStart:{},_$helper:null}},{add:function(e,t){var n=o(),r=$(e);if(t)var s=$(t);r.attr("data-qpf-draggable",n).addClass("qpf-draggable"),(t?$(t):r).unbind("mousedown",this._mouseDown).bind("mousedown",{context:this},this._mouseDown);var u=new i({id:n,target:e,host:this,handle:t});return this.items[n]=u,u},remove:function(e){if(e instanceof i)var t=e,n=$(t.elem),r=t.id;else{var n=$(e),r=n.attr("data-qpf-draggable");if(r)var t=this.items[r]}delete this.items[r],n.removeAttr("data-qpf-draggable").removeClass("qpf-draggable"),(t.handle?$(t.handle):n).unbind("mousedown",this._mouseDown)},clear:function(){_.each(this.items,function(e){this.remove(e.target)},this)},_save:function(){_.each(this.items,function(e){var t=$(e.target),n=t.offsetParent(),r=t.position(),i=n.offset(),s={left:parseInt(t.css("marginLeft"))||0,top:parseInt(t.css("marginTop"))||0};e.margin=s,e.originPosition={left:r.left-s.left,top:r.top-s.top},e.offsetParentOffset=i,e.width=t.width(),e.height=t.height(),e.positionType=t.css("position")},this)},_restore:function(e){_.each(this.items,function(t){var n=$(t.target),r=n.offset();n.css("position",t.positionType),e?n.offset({left:t.originPosition.left+t.margin.left,top:t.originPosition.top+t.margin.top}):n.offset(r)},this)},_mouseDown:function(e){if(e.which!==1)return;var t=e.data.context;e.preventDefault(),t._save(),t._triggerProxy("dragstart",e),t.helper?(t._$helper=$(t.helper),document.body.appendChild(t._$helper[0]),t._$helper.css({left:e.pageX,top:e.pageY})):(_.each(t.items,function(e){var t=$(e.target);t.addClass("qpf-draggable-dragging"),t.css({position:"absolute",left:e.originPosition.left+"px",top:e.originPosition.top+"px"})},t),t.container?t._boundingBox=t._computeBoundingBox(t.container):t._boundingBox=null),$(document.body).unbind("mousemove",t._mouseMove).bind("mousemove",{context:t},t._mouseMove).unbind("mouseout",t._mouseOut).bind("mouseout",{context:t},t._mouseOut).unbind("mouseup",t._mouseUp).bind("mouseup",{context:t},t._mouseUp),t._mouseStart={x:e.pageX,y:e.pageY}},_computeBoundingBox:function(e){if(_.isArray(e))return{left:e[0][0],top:e[0][1],right:e[1][0],bottom:e[1][1]};if(e.left&&e.right&&e.top&&e.bottom)return e;try{var t=$(e),n=t.offset(),r={left:n.left+parseInt(t.css("padding-left"))||0,top:n.top+parseInt(t.css("padding-top"))||0,right:n.left+t.width()-parseInt(t.css("padding-right"))||0,bottom:n.top+t.height()-parseInt(t.css("padding-bottom"))||0};return r}catch(i){console.error("Invalid container type")}},_mouseMove:function(e){var t=e.data.context;t._triggerProxy("drag",e);var r={x:e.pageX-t._mouseStart.x,y:e.pageY-t._mouseStart.y};t._$helper?t._$helper.css({left:e.pageX,top:e.pageY}):_.each(t.items,function(e){var i=e.originPosition.left+e.offsetParentOffset.left+r.x,s=e.originPosition.top+e.offsetParentOffset.top+r.y;if(t._boundingBox){var o=t._boundingBox;i=i>o.left?i+e.width<o.right?i:o.right-e.width:o.left,s=s>o.top?s+e.height<o.bottom?s:o.bottom-e.height:o.top}var u=n.utils.unwrapObservable(t.axis);(!u||u.toLowerCase()!=="y")&&$(e.target).css("left",i-e.offsetParentOffset.left+"px"),(!u||u.toLowerCase()!=="x")&&$(e.target).css("top",s-e.offsetParentOffset.top+"px")},t)},_mouseUp:function(e){var t=e.data.context;$(document.body).unbind("mousemove",t._mouseMove).unbind("mouseout",t._mouseOut).unbind("mouseup",t._mouseUp),t._$helper?t._$helper.remove():_.each(t.items,function(e){var t=$(e.target);t.removeClass("qpf-draggable-dragging")},t),t._restore(),t._triggerProxy("dragend",e)},_mouseOut:function(e){},_triggerProxy:function(){var e=arguments;_.each(this.items,function(t){t.trigger.apply(t,e)})}}),o=function(){var e=1;return function(){return e++}}();return{applyTo:function(e,t){e.draggable=e.draggable||{},_.extend(e.draggable,new s(t))}}}),r("components/meta/range",["./meta","../mixin/draggable","knockout"],function(e,t,n){var r=e.derive(function(){var e={$el:$('<div data-bind="css:orientation"></div>'),value:n.observable(0),step:n.observable(1),min:n.observable(-100),max:n.observable(100),orientation:n.observable("horizontal"),precision:n.observable(0),format:"{{value}}",_format:function(e){return this.format.replace("{{value}}",e)},autoResize:!0};return e.value=n.observable(1).extend({numeric:e.precision,clamp:{max:e.max,min:e.min}}),e},{type:"RANGE",css:"range",template:'<div class="qpf-range-groove-box">					<div class="qpf-range-groove-outer">						<div class="qpf-range-groove">							<div class="qpf-range-percentage"></div>						</div>					</div>				</div>				<div class="qpf-range-min" data-bind="text:_format(min())"></div>				<div class="qpf-range-max" data-bind="text:_format(max())"></div>				<div class="qpf-range-slider">					<div class="qpf-range-slider-inner"></div>					<div class="qpf-range-value" data-bind="text:_format(value())"></div>				</div>',eventsProvided:_.union(e.prototype.eventsProvided,"change"),initialize:function(){t.applyTo(this,{axis:n.computed(function(){return this.orientation()=="horizontal"?"x":"y"},this)});var e=this.value();this.value.subscribe(function(t){this._$box&&this.updatePosition(),this.trigger("change",parseFloat(t),parseFloat(e),this),e=t},this)},afterRender:function(){this._$box=this.$el.find(".qpf-range-groove-box"),this._$percentage=this.$el.find(".qpf-range-percentage"),this._$slider=this.$el.find(".qpf-range-slider"),this.draggable.container=this.$el.find(".qpf-range-groove-box");var e=this.draggable.add(this._$slider);e.on("drag",this._dragHandler,this),this.updatePosition(),this.$el.mousedown(function(e){e.preventDefault()})},afterResize:function(){this.updatePosition(),e.prototype.afterResize.call(this)},_dragHandler:function(){var e=this.computePercentage(),t=parseFloat(this.min()),n=parseFloat(this.max()),r=(n-t)*e+t;this.value(r)},_cacheSize:function(){var e=this._isHorizontal();this._boxSize=e?this._$box.width():this._$box.height(),this._sliderSize=e?this._$slider.width():this._$slider.height()},computePercentage:function(){this.autoResize&&this._cacheSize();var e=this._computeOffset();return e/(this._boxSize-this._sliderSize)},_computeOffset:function(){var e=this._isHorizontal(),t=e?this._$box.offset().left:this._$box.offset().top;return sliderOffset=e?this._$slider.offset().left:this._$slider.offset().top,sliderOffset-t},_setOffset:function(e){var t=this._isHorizontal(),n=t?this._$box.offset().left:this._$box.offset().top,r=t?{left:n+e}:{top:n+e};this._$slider.offset(r)},updatePosition:function(){if(!this._$slider)return;this.autoResize&&this._cacheSize();var e=this.min(),t=this.max(),n=this.value(),r=(n-e)/(t-e),i=(this._boxSize-this._sliderSize)*r;this._boxSize>0?this._setOffset(i):this._$slider.css(this._isHorizontal()?"right":"bottom",(1-r)*100+"%"),this._$percentage.css(this._isHorizontal()?"width":"height",r*100+"%")},_isHorizontal:function(){return n.utils.unwrapObservable(this.orientation)=="horizontal"}});return e.provideBinding("range",r),r}),r("components/meta/spinner",["./meta","knockout"],function(e,t){function n(){this.value(parseFloat(this.value())+parseFloat(this.step()))}function r(){this.value(parseFloat(this.value())-parseFloat(this.step()))}var i=e.derive(function(){var e={step:t.observable(1),valueUpdate:"afterkeydown",precision:t.observable(2),min:t.observable(null),max:t.observable(null),increase:n,decrease:r};return e.value=t.observable(1).extend({numeric:e.precision,clamp:{max:e.max,min:e.min}}),e},{type:"SPINNER",css:"spinner",initialize:function(){var e=this.value()||0;this.value.subscribe(function(t){this.trigger("change",parseFloat(t),parseFloat(e),this),e=t},this)},eventsProvided:_.union(e.prototype.eventsProvided,"change"),template:'<div class="qpf-left">					<input type="text" class="qpf-spinner-value" data-bind="value:value,valueUpdate:valueUpdate" />				</div>				<div class="qpf-right">					<div class="qpf-common-button qpf-increase" data-bind="click:increase">					+</div>					<div class="qpf-common-button qpf-decrease" data-bind="click:decrease">					-</div>				</div>',afterRender:function(){var e=this;this.$el.find(".qpf-increase,.qpf-decrease").mousedown(function(e){e.preventDefault()}),this._$value=this.$el.find(".qpf-spinner-value"),this._$value.keydown(function(e){if(e.keyCode==46||e.keyCode==8||e.keyCode==9||e.keyCode==27||e.keyCode==190||e.keyCode==65&&e.ctrlKey===!0||e.keyCode>=35&&e.keyCode<=39)return;(e.shiftKey||(e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105))&&e.preventDefault()}),this._$value.change(function(){this.value!==e.value().toString()&&(this.value=e.value())})}});return e.provideBinding("spinner",i),i}),r("components/meta/textfield",["./meta","knockout"],function(e,t){var n=e.derive(function(){return{tag:"div",text:t.observable(""),placeholder:t.observable("")}},{type:"TEXTFIELD",css:"textfield",template:'<input type="text" data-bind="attr:{placeholder:placeholder}, value:text"/>',afterResize:function(){this.$el.find("input").width(this.width()),e.prototype.afterResize.call(this)}});return e.provideBinding("textfield",n),n}),r("components/container/container",["../base","knockout"],function(e,t){var n=e.derive(function(){return{children:t.observableArray()}},{type:"CONTAINER",css:"container",template:'<div data-bind="foreach:children" class="qpf-children">					<div data-bind="qpf_view:$data"></div>				</div>',initialize:function(){function r(){e.remove(this)}var e=this,n=this.children().slice();this.children.subscribe(function(e){var i=t.utils.compareArrays(n,e);_.each(i,function(e){e.status=="added"?e.value.on("dispose",r,e.value):e.status=="deleted"&&e.value.off("dispose",r)},this)})},add:function(e){e.parent=this,this.children.push(e)},remove:function(e){e.parent=null,this.children.remove(e)},removeAll:function(){_.each(this.children(),function(e){this.remove(e)},this)},children:function(){return this.children()},doRender:function(){e.prototype.doRender.call(this),_.each(this.children(),function(e){e.render()})},afterResize:function(){this.height()&&this.$el.children(".qpf-children").height(this.height()),_.each(this.children(),function(e){e.afterResize()},this),e.prototype.afterResize.call(this)},dispose:function(){_.each(this.children(),function(e){e.dispose()}),e.prototype.dispose.call(this)},get:function(e){if(!e)return;return _.filter(this.children(),function(t){return t.name===e})[0]}});n.provideBinding=e.provideBinding;var r=t.bindingHandlers.qpf;return t.bindingHandlers.qpf={init:function(i,s,o,u){var a=Array.prototype.slice.call(i.childNodes),f=r.createComponent(i,s);if(f&&f.instanceof(n)){var l={__deferredrender__:!0};_.extend(l,u);for(var c=0;c<a.length;c++){var h=a[c];if(t.bindingProvider.prototype.nodeHasBindings(h)){t.applyBindings(l,h);var p=e.getByDom(h);p&&f.add(p)}}}return u.__deferredrender__||f.render(),{controlsDescendantBindings:!0}},update:function(e,t){r.update(e,t)}},n.provideBinding("container",n),n}),r("components/container/panel",["./container","knockout"],function(e,t){var n=e.derive(function(){return{title:t.observable("")}},{type:"PANEL",css:"panel",template:'<div class="qpf-panel-header">					<div class="qpf-panel-title" data-bind="html:title"></div>					<div class="qpf-panel-tools"></div>				</div>				<div class="qpf-panel-body" data-bind="foreach:children" class="qpf-children">					<div data-bind="qpf_view:$data"></div>				</div>				<div class="qpf-panel-footer"></div>',afterRender:function(){var e=this.$el;this._$header=e.children(".qpf-panel-header"),this._$tools=this._$header.children(".qpf-panel-tools"),this._$body=e.children(".qpf-panel-body"),this._$footer=e.children(".qpf-panel-footer")},afterResize:function(){if(this._$body&&this.height()){var t=this._$header.height(),n=this._$footer.height();this._$body.height(this.$el.height()-t-n)}e.prototype.afterResize.call(this)}});return e.provideBinding("panel",n),n}),r("components/container/window",["./container","./panel","../mixin/draggable","knockout"],function(e,t,n,r){var i=t.derive(function(){return{$el:$('<div data-bind="style:{left:_leftPx, top:_topPx}"></div>'),children:r.observableArray(),title:r.observable("Window"),left:r.observable(0),top:r.observable(0),_leftPx:r.computed(function(){return this.left()+"px"},this,{deferEvaluation:!0}),_topPx:r.computed(function(){return this.top()+"px"},this,{deferEvaluation:!0})}},{type:"WINDOW",css:_.union("window",t.prototype.css),initialize:function(){n.applyTo(this),t.prototype.initialize.call(this)},afterRender:function(){t.prototype.afterRender.call(this),this.draggable.add(this.$el,this._$header)}});return e.provideBinding("window",i),i}),r("components/container/tab",["./panel","./container","../base","knockout"],function(e,t,n,r){var i=e.derive(function(){var e={actived:r.observable(0),maxTabWidth:100,minTabWidth:30};return e.actived.subscribe(function(e){this._active(e)},this),e},{type:"TAB",css:"tab",add:function(t){t.instanceof(e)?e.prototype.add.call(this,t):console.error("Children of tab container must be instance of panel"),this._active(this.actived())},eventsProvided:_.union("change",t.prototype.eventsProvided),initialize:function(){this.children.subscribe(function(){this._updateTabSize()},this),e.prototype.initialize.call(this)},template:'<div class="qpf-tab-header">					<ul class="qpf-tab-tabs" data-bind="foreach:children">						<li data-bind="click:$parent.actived.bind($data, $index())">							<a data-bind="html:title"></a>						</li>					</ul>					<div class="qpf-tab-tools"></div>				</div>				<div class="qpf-tab-body">					<div class="qpf-tab-views" data-bind="foreach:children" class="qpf-children">						<div data-bind="qpf_view:$data"></div>					</div>				</div>				<div class="qpf-tab-footer"></div>',afterRender:function(){this._updateTabSize();var e=this.$el;this._$header=e.children(".qpf-tab-header"),this._$tools=this._$header.children(".qpf-tab-tools"),this._$body=e.children(".qpf-tab-body"),this._$footer=e.children(".qpf-tab-footer"),this._active(this.actived())},afterResize:function(){this._adjustCurrentSize(),this._updateTabSize(),t.prototype.afterResize.call(this)},_unActiveAll:function(){_.each(this.children(),function(e){e.$el.css("display","none")})},_updateTabSize:function(){var e=this.children().length,t=Math.floor((this.$el.width()-20)/e);t=Math.min(this.maxTabWidth,Math.max(this.minTabWidth,t)),this.$el.find(".qpf-tab-header>.qpf-tab-tabs>li").width(t)},_adjustCurrentSize:function(){var e=this.children()[this.actived()];if(e&&this._$body){var t=this._$header.height(),n=this._$footer.height();this.height()&&this.height()!=="auto"&&e.height(this.$el.height()-t-n),this.width()=="auto"}},_active:function(e){this._unActiveAll();var t=this.children()[e];t&&(t.$el.css("display","block"),this._adjustCurrentSize(),t.afterResize(),this.trigger("change",e,t)),this.$el.find(".qpf-tab-header>.qpf-tab-tabs>li").removeClass("actived").eq(e).addClass("actived")}});return t.provideBinding("tab",i),i}),r("components/container/box",["./container","knockout"],function(e,t){var n=e.derive(function(){return{}},{type:"BOX",css:"box",initialize:function(){this.children.subscribe(function(e){this.afterResize()},this),this.$el.css("position","relative"),e.prototype.initialize.call(this)},_getMargin:function(e){return{left:parseInt(e.css("marginLeft"))||0,top:parseInt(e.css("marginTop"))||0,bottom:parseInt(e.css("marginBottom"))||0,right:parseInt(e.css("marginRight"))||0}},_resizeTimeout:0,afterResize:function(){var t=this;this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(function(){t.resizeChildren(),e.prototype.afterResize.call(t)})}});return n}),r("components/container/vbox",["./container","./box","knockout"],function(e,t,n){var r=t.derive(function(){return{}},{type:"VBOX",css:"vbox",resizeChildren:function(){var e=0,t=this.$el.height(),r=[];marginCache=[],marginCacheWithFlex=[],_.each(this.children(),function(i){var s=this._getMargin(i.$el);marginCache.push(s),i.width(this.$el.width()-s.left-s.right);var o=n.utils.unwrapObservable(i.prefer);if(o)o=Math.min(o,t),i.height(o),t-=o+s.top+s.bottom;else{var u=parseInt(n.utils.unwrapObservable(i.flex)||1);r.push(i),marginCacheWithFlex.push(s),e+=u}},this),_.each(r,function(r,i){var s=marginCacheWithFlex[i],o=parseInt(n.utils.unwrapObservable(r.flex)||1),u=o/e;r.height(Math.floor(t*u)-s.top-s.bottom)});var i=0;_.each(this.children(),function(e,t){var n=marginCache[t];e.$el.css({position:"absolute",left:"0px",top:i+"px"}),i+=e.height()+n.top+n.bottom})}});return e.provideBinding("vbox",r),r}),r("components/container/hbox",["./container","./box","knockout"],function(e,t,n){var r=t.derive(function(){return{}},{type:"HBOX",css:"hbox",resizeChildren:function(){var e=0,t=this.$el.width(),r=[],i=[],s=[];_.each(this.children(),function(o,u){var a=this._getMargin(o.$el);i.push(a),o.height(this.$el.height()-a.top-a.bottom);var f=n.utils.unwrapObservable(o.prefer);if(f)f=Math.min(f,t),o.width(f),t-=f+a.left+a.right;else{var l=parseInt(n.utils.unwrapObservable(o.flex)||1);r.push(o),s.push(a),e+=l}},this),_.each(r,function(r,i){var o=s[i],u=parseInt(n.utils.unwrapObservable(r.flex)||1),a=u/e;r.width(Math.floor(t*a)-o.left-o.right)});var o=0;_.each(this.children(),function(e,t){var n=i[t];e.$el.css({position:"absolute",top:"0px",left:o+"px"}),o+=e.width()+n.left+n.right})}});return e.provideBinding("hbox",r),r}),r("components/container/inline",["./container","knockout"],function(e,t){var n=e.derive({},{type:"INLINE",css:"inline",template:'<div data-bind="foreach:children" class="qpf-children">					<div data-bind="qpf_view:$data"></div>				</div>				<div style="clear:both"></div>'});return e.provideBinding("inline",n),n}),r("components/container/application",["./container","knockout"],function(e,t){var n=e.derive(function(){},{type:"APPLICATION",css:"application",initialize:function(){$(window).resize(this._resize.bind(this)),this._resize()},_resize:function(){this.width($(window).width()),this.height($(window).height())}});return e.provideBinding("application",n),n}),r("components/widget/widget",["../base","../meta/meta","../container/container","knockout","ko.mapping"],function(e,t,n,r,i){var s=e.derive({},{type:"WIDGET",css:"widget"});return s.provideBinding=e.provideBinding,s.provideBinding("widget",s),s}),r("components/widget/vector",["./widget","../base","core/xmlparser","knockout","../meta/spinner","../meta/range"],function(e,t,n,r){var i=e.derive(function(){return{items:r.observableArray(),constrainProportion:r.observable(!1),constrainType:r.observable("diff"),_toggleConstrain:function(){this.constrainProportion(!this.constrainProportion())},_constrainRatio:[],_constrainDiff:[],_sub:[]}},{type:"VECTOR",css:"vector",initialize:function(){this.$el.attr("data-bind",'css:{"qpf-vector-constrain":constrainProportion}'),this.items.subscribe(function(e){this._$list&&(this._cacheSubComponents(),this._updateConstraint())},this),this.constrainProportion.subscribe(function(e){e&&this._computeContraintInfo()},this)},eventsProvided:_.union(e.prototype.eventsProvided,"change"),template:'<div class="qpf-left">					<div class="qpf-vector-link" data-bind="click:_toggleConstrain"></div>				</div>				<div class="qpf-right" >					<ul class="qpf-list" data-bind="foreach:items">						<li data-bind="qpf:$data"></li>					</ul>				</div>',afterRender:function(){this._$list=this.$el.find(".qpf-list"),this._cacheSubComponents(),this._updateConstraint()},afterResize:function(){_.each(this._sub,function(e){e.afterResize()}),e.prototype.afterResize.call(this)},dispose:function(){_.each(this._sub,function(e){e.dispose()}),t.prototype.dispose.call(this)},_cacheSubComponents:function(){var e=this;e._sub=[],this._$list.children().each(function(){var n=t.getByDom(this);e._sub.push(n)}),this._computeContraintInfo()},_computeContraintInfo:function(){this._constrainDiff=[],this._constrainRatio=[],_.each(this._sub,function(e,t){var n=this._sub[t+1];if(!n)return;var r=e.value(),i=n.value();this._constrainDiff.push(i-r),this._constrainRatio.push(r==0?1:i/r)},this)},_updateConstraint:function(){_.each(this._sub,function(e){e.on("change",this._constrainHandler,this)},this)},_constrainHandler:function(e,t,n){if(this.constrainProportion()){var r=this._sub.indexOf(n),i=this.constrainType();for(var s=r;s>0;s--){var o=this._sub[s].value,u=this._sub[s-1].value;if(i=="diff"){var a=this._constrainDiff[s-1];u(o()-a)}else if(i=="ratio"){var f=this._constrainRatio[s-1];u(o()/f)}}for(var s=r;s<this._sub.length-1;s++){var o=this._sub[s].value,l=this._sub[s+1].value;if(i=="diff"){var a=this._constrainDiff[s];l(o()+a)}else if(i=="ratio"){var f=this._constrainRatio[s];l(o()*f)}}}}});return e.provideBinding("vector",i),n.provideParser("vector",function(e){var t=[],r=n.util.getChildren(e);_.chain(r).filter(function(e){var t=e.tagName&&e.tagName.toLowerCase();return t&&(t==="spinner"||t==="range")}).each(function(e){var r=n.util.convertAttributes(e.attributes);r.type=e.tagName.toLowerCase(),t.push(r)});if(t.length)return{items:t}}),i}),r("components/widget/color_vm",["require","knockout","core/clazz"],function(e){function r(e,t,n){e/=255,t/=255,n/=255;var r=Math.max(e,t,n),i=Math.min(e,t,n),s,o,u=r,a=r-i;o=r==0?0:a/r;if(r==i)s=0;else{switch(r){case e:s=(t-n)/a+(t<n?6:0);break;case t:s=(n-e)/a+2;break;case n:s=(e-t)/a+4}s/=6}return[s*360,o*100,u*100]}function i(e,t,n){e/=360,t/=100,n/=100;var r,i,s,o=Math.floor(e*6),u=e*6-o,a=n*(1-t),f=n*(1-u*t),l=n*(1-(1-u)*t);switch(o%6){case 0:r=n,i=l,s=a;break;case 1:r=f,i=n,s=a;break;case 2:r=a,i=n,s=l;break;case 3:r=a,i=f,s=n;break;case 4:r=l,i=a,s=n;break;case 5:r=n,i=a,s=f}return[Math.round(r*255),Math.round(i*255),Math.round(s*255)]}function s(e){var t=e>>16&255,n=e>>8&255,r=e&255;return[t,n,r]}function o(e,t,n){return e<<16|t<<8|n}function u(e){var t=s(e);return r(t[0],t[1],t[2])}function a(e,t,n){return o(i(e,t,n))}var t=e("knockout"),n=e("core/clazz"),f=n.derive({_r:t.observable().extend({numeric:0}),_g:t.observable().extend({numeric:0}),_b:t.observable().extend({numeric:0}),_h:t.observable().extend({clamp:{min:0,max:360}}),_s:t.observable().extend({clamp:{min:0,max:100}}),_v:t.observable().extend({clamp:{min:0,max:100}}),alpha:t.observable(1).extend({numeric:2,clamp:{min:0,max:1}})},function(){this.hex=t.computed({read:function(){return o(this._r(),this._g(),this._b())},write:function(e){var t=u(e);this._h(t[0]),this._s(t[1]),this._v(t[2])}},this),this.rgb=t.computed({read:function(){var e=i(this._h(),this._s(),this._v());return this._r(e[0]),this._g(e[1]),this._b(e[2]),e}},this),this.hsv=t.computed(function(){return[this._h(),this._s(),this._v()]},this),this.set=function(e){var t=u(e),n=s(e);this._h(t[0]),this._s(t[1]),this._v(t[2]),this._r(n[0]),this._g(n[1]),this._b(n[2])},this.hexString=t.computed({read:function(){var e=this.hex().toString(16),t=[];for(var n=0;n<6-e.length;n++)t.push("0");return t.join("")+e},write:function(){}},this),this.hueRGB=t.computed(function(){return"rgb("+i(this._h(),100,100).join(",")+")"},this);var e=["_r","_g","_b"];this.rgbVector=[];for(var n=0;n<3;n++)this.rgbVector.push({type:"spinner",min:0,max:255,step:1,precision:0,value:this[e[n]]});var e=["_h","_s","_v"];this.hsvVector=[];for(var n=0;n<3;n++)this.hsvVector.push({type:"spinner",min:0,max:100,step:1,precision:0,value:this[e[n]]});this.hsvVector[0].max=360,this.set(16777215)});return f.intToRgb=s,f.rgbToInt=o,f.rgbToHsv=r,f.hsvToRgb=i,f.intToHsv=u,f.hsvToInt=a,f}),r("components/widget/palette",["require","./widget","knockout","./color_vm","components/widget/vector","components/meta/textfield","components/meta/range"],function(e){var t=e("./widget"),n=e("knockout"),r=e("./color_vm");e("components/widget/vector"),e("components/meta/textfield"),e("components/meta/range");var i=t.derive(function(){var e=new r,t=this;return _.extend(e,{_recent:n.observableArray(),_recentMax:5}),e},{type:"PALETTE",css:"palette",eventsProvided:_.union(t.prototype.eventsProvided,["change","apply"]),template:'<div class="qpf-palette-adjuster">					<div class="qpf-left">						<div class="qpf-palette-picksv" data-bind="style:{backgroundColor:hueRGB}">							<div class="qpf-palette-saturation">								<div class="qpf-palette-value"></div>							</div>							<div class="qpf-palette-picker"></div>						</div>						<div class="qpf-palette-pickh">							<div class="qpf-palette-picker"></div>						</div>						<div style="clear:both"></div>						<div class="qpf-palette-alpha">							<div data-bind="qpf:{type:\'range\', min:0, max:1, value:alpha, precision:2}"></div>						</div>					</div>					<div class="qpf-right">						<div class="qpf-palette-rgb">							<div data-bind="qpf:{type:\'label\', text:\'RGB\'}"></div>							<div data-bind="qpf:{type:\'vector\', items:rgbVector}"></div>						</div>						<div class="qpf-palette-hsv">							<div data-bind="qpf:{type:\'label\', text:\'HSV\'}"></div>							<div data-bind="qpf:{type:\'vector\', items:hsvVector}"></div>						</div>						<div class="qpf-palette-hex">							<div data-bind="qpf:{type:\'label\', text:\'#\'}"></div>							<div data-bind="qpf:{type:\'textfield\',text:hexString}"></div>						</div>					</div>				</div>				<div style="clear:both"></div>				<ul class="qpf-palette-recent" data-bind="foreach:_recent">					<li data-bind="style:{backgroundColor:rgbString},									attr:{title:hexString},									click:$parent.hex.bind($parent, hex)"></li>				</ul>				<div class="qpf-palette-buttons">					<div data-bind="qpf:{type:\'button\', text:\'Cancel\', class:\'small\', onclick:_cancel.bind($data)}"></div>					<div data-bind="qpf:{type:\'button\', text:\'Apply\', class:\'small\', onclick:_apply.bind($data)}"></div>				</div>',initialize:function(){this.hsv.subscribe(function(e){this._setPickerPosition(),this.trigger("change",this.hex())},this),this._h.subscribe(this._setPickerPosition,this)},afterRender:function(){this._$svSpace=$(".qpf-palette-picksv"),this._$hSpace=$(".qpf-palette-pickh"),this._$svPicker=this._$svSpace.children(".qpf-palette-picker"),this._$hPicker=this._$hSpace.children(".qpf-palette-picker"),this._svSize=this._$svSpace.height(),this._hSize=this._$hSpace.height(),this._setPickerPosition(),this._setupSvDragHandler(),this._setupHDragHandler()},_setupSvDragHandler:function(){var e=this,t=function(t){var n=e._$svSpace.offset(),r=t.pageX-n.left,i=t.pageY-n.top;return{left:r,top:i}},n=function(n){var r=t(n);e._computeSV(r.left,r.top)},r=function(e){$(document.body).unbind("mousemove",n).unbind("mouseup",r).unbind("mousedown",i)},i=function(e){e.preventDefault()};this._$svSpace.mousedown(function(s){var o=t(s);e._computeSV(o.left,o.top),$(document.body).bind("mousemove",n).bind("mouseup",r).bind("mousedown",i)})},_setupHDragHandler:function(){var e=this,t=function(t){var n=e._$hSpace.offset(),r=t.pageY-n.top;return r},n=function(n){e._computeH(t(n))},r=function(e){e.preventDefault()},i=function(e){$(document.body).unbind("mousemove",n).unbind("mouseup",i).unbind("mousedown",r)};this._$hSpace.mousedown(function(s){e._computeH(t(s)),$(document.body).bind("mousemove",n).bind("mouseup",i).bind("mousedown",r)})},_computeSV:function(e,t){var n=e/this._svSize,r=(this._svSize-t)/this._svSize;this._s(n*100),this._v(r*100)},_computeH:function(e){this._h(e/this._hSize*360)},_setPickerPosition:function(){if(this._$svPicker){var e=this.hsv(),t=e[0],n=e[1],r=e[2];this._$svPicker.css({left:Math.round(n/100*this._svSize)+"px",top:Math.round((100-r)/100*this._svSize)+"px"}),this._$hPicker.css({top:Math.round(t/360*this._hSize)+"px"})}},_apply:function(){this._recent().length>this._recentMax&&this._recent.shift(),this._recent.push({rgbString:"rgb("+this.rgb().join(",")+")",hexString:this.hexString(),hex:this.hex()}),this.trigger("apply",this.hex())},_cancel:function(){}});return t.provideBinding("palette",i),i}),r("src/main",["core/xmlparser","core/mixin/derive","core/mixin/event","components/base","components/util","components/meta/button","components/meta/canvas","components/meta/checkbox","components/meta/combobox","components/meta/label","components/meta/meta","components/meta/range","components/meta/spinner","components/meta/textfield","components/container/container","components/container/panel","components/container/window","components/container/tab","components/container/vbox","components/container/hbox","components/container/inline","components/container/application","components/widget/vector","components/widget/widget","components/widget/palette"],function(){return console.log("qpf is loaded"),{core:{xmlparser:n("core/xmlparser"),mixin:{derive:n("core/mixin/derive"),event:n("core/mixin/event")}},components:{base:n("components/base"),mixin:{draggable:n("components/mixin/draggable")},meta:{meta:n("components/meta/meta"),button:n("components/meta/button"),checkbox:n("components/meta/checkbox"),combobox:n("components/meta/combobox"),label:n("components/meta/label"),range:n("components/meta/range"),spinner:n("components/meta/spinner"),textfield:n("components/meta/textfield"),canvas:n("components/meta/canvas")},container:{container:n("components/container/container"),panel:n("components/container/panel"),window:n("components/container/window"),tab:n("components/container/tab"),vbox:n("components/container/vbox"),hbox:n("components/container/hbox"),inline:n("components/container/inline"),application:n("components/container/application")},widget:{widget:n("components/widget/widget"),vector:n("components/widget/vector"),palette:n("components/widget/palette")}}}});var i=n("src/main");e.use=function(e){return n(e)}}),define("modules/module",["require","qpf"],function(e){var t=e("qpf"),n=t.use("components/base"),r=t.use("knockout"),i=t.use("core/xmlparser"),s=t.use("core/mixin/derive"),o=t.use("core/mixin/event"),u=new Function;_.extend(u,s),_.extend(u.prototype,o);var a=u.derive(function(){return{name:"",$el:$("<div style='position:relative'></div>"),xml:"",context:{}}},{start:function(){return this.xml&&this.applyXML(this.xml),this._$mask=$("<div class='mask'></div>"),this.$el.append(this._$mask),this.trigger("start"),this.$el},enable:function(e){this.$el.show(),this.trigger("enable"),e&&e()},disable:function(e){this.$el.hide(),this.trigger("disable"),e&&e()},setContext:function(e){this._defaultContext||(this._defaultContext={},_.each(this.context,function(e,t){this._defaultContext[t]=e()},this));for(var t in this.context)typeof e[t]!="undefined"?this.context[t](e[t]):this.context[t](this._defaultContext[t]);n.prototype._mappingAttributes.call(this.context,e,!0)},dispose:function(){n.disposeByDom(this.$el[0]),this.$el.remove()},loadingStart:function(){this._$mask&&this._$mask.addClass("loading").show()},loadingEnd:function(){this._$mask&&this._$mask.removeClass("loading").hide()},applyXML:function(e){i.parse(e,this.$el[0]),r.applyBindings(this,this.$el[0]);var t=this.$el[0].firstChild;t&&(this.mainComponent=n.getByDom(t))}});return a}),define("text",["module"],function(e){var t,n,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o=typeof location!="undefined"&&location.href,u=o&&location.protocol&&location.protocol.replace(/\:/,""),a=o&&location.hostname,f=o&&(location.port||undefined),l=[],c=e.config&&e.config()||{};t={version:"2.0.5",strip:function(e){if(e){e=e.replace(i,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=r[t];try{e=new ActiveXObject(n)}catch(i){}if(e){r=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,c.isBuild&&(l[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}c.isBuild=i.isBuild;var s=t.parseName(e),l=s.moduleName+(s.ext?"."+s.ext:""),h=n.toUrl(l),p=c.useXhr||t.useXhr;!o||p(h,u,a,f)?t.get(h,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([l],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(l.hasOwnProperty(n)){var s=t.jsEscape(l[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(c.env==="node"||!c.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node)n=require.nodeRequire("fs"),t.get=function(e,t){var r=n.readFileSync(e,"utf8");r.indexOf("﻿")===0&&(r=r.substring(1)),t(r)};else if(c.env==="xhr"||!c.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);c.onXhr&&c.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText))},s.send(null)};else if(c.env==="rhino"||!c.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};return t}),define("text!modules/filters/filters.xml",[],function(){return'<panel title="Filters" id="Filters">\n	<container>\n		<textfield text="@binding[seachKeyword]" class="qpf-fitlers-search" placeholder="search"></textfield>\n	</container>\n	<list dataSource="@binding[filters]" itemView="@binding[FilterView]"/>\n</panel>'}),define("text!modules/filters/filter.html",[],function(){return'<div class="qpf-filter-header" data-bind="click:use.bind($data)">\n	<div class="qpf-filter-preview">\n		<img data-bind="attr:{src:_previewSrc}" />\n	</div>\n	<div class="qpf-filter-title">\n		<h5 data-bind="html:title"></h5>\n	</div>\n</div>'}),define("text!modules/layers/layers.xml",[],function(){return'<container title="Layers" id="Layers">\n	<list dataSource="@binding[manager.provides]" itemView="@binding[Layer]"></list>\n</container>'}),define("text!modules/layers/layer.html",[],function(){return'<div class="qpf-layer-header">\n	<a class="qpf-layer-title" data-bind="html:title"></a>\n</div>\n<div class="qpf-layer-parameters">\n	<ul data-bind="foreach:parameters">\n		<li>\n			<label data-bind="html:$data.name"></label>\n			<div data-bind="qpf:$data" class="qpf-parameter-component"></div>\n		</li>\n	</ul>\n</div>'}),define("modules/layers/layer",["require","qpf","text!./layer.html"],function(e){var t=e("qpf"),n=t.use("components/widget/widget"),r=t.use("knockout"),i=e("text!./layer.html"),s=n.derive(function(){return{title:r.observable(""),parameters:r.observableArray()}},{type:"Layer",css:"layer",template:i,afterResize:function(){_.each(this.$el.find(".qpf-parameter-component").qpf("get"),function(e){e.afterResize()}),n.prototype.afterResize.call(this)}});return s}),define("modules/common/listitem",["require","qpf"],function(e){var t=e("qpf"),n=t.use("components/meta/meta"),r=t.use("knockout"),i=n.derive(function(){return{title:r.observable(""),icon:r.observable(""),href:r.observable("")}},{type:"LISTITEM",css:"list-item",initialize:function(){this.$el.mousedown(function(e){e.preventDefault()});var e=this;this.$el.click(function(){var t=e.href();t&&t.indexOf("#")==0&&(window.location.hash=t)})},template:'<div class="icon" data-bind="css:icon"></div>					<div class="title" data-bind="html:title"></div>'});return i}),define("modules/common/list",["require","qpf","./listitem"],function(e){var t=e("qpf"),n=e("./listitem"),r=t.use("components/container/container"),i=t.use("knockout"),s=r.derive(function(){return{dataSource:i.observableArray([]),itemView:i.observable(n),selected:i.observable()}},{type:"LIST",css:"list",template:'<div data-bind="foreach:children" >						<div class="qpf-container-item">							<div data-bind="qpf_view:$data"></div>						</div>					</div>',initialize:function(){var e=_.clone(this.dataSource()),t=this;this.dataSource.subscribe(function(t){this._update(e,t),e=_.clone(t),_.each(e,function(e,t){i.utils.unwrapObservable(e.selected)&&this.selected(t)},this)},this),this.selected.subscribe(function(e){this._unSelectAll();var t=this.children()[e];t&&t.$el.addClass("selected")},this),this.$el.delegate(".qpf-container-item","click",function(){var e=i.contextFor(this);t.selected(e.$index())}),this._update([],e)},_update:function(e,t){var n=this.children(),r=this.itemView(),s=[],o=i.utils.compareArrays(e,t),u=[];_.each(o,function(t){if(t.status==="retained"){var i=e.indexOf(t.value);s[i]=n[i]}else if(t.status==="added"){var o=new r({attributes:t.value});s[t.index]=o,n.splice(t.index,0,o),u.push(o)}},this),this.children(s),_.each(u,function(e){e.render()})},_unSelectAll:function(){_.each(this.children(),function(e,t){e.$el.removeClass("selected")},this)}});return r.provideBinding("list",s),s}),function(){function r(e){var n=!1;return function(){if(n)throw new Error("Callback was already called.");n=!0,e.apply(t,arguments)}}var e={},t,n;t=this,t!=null&&(n=t.async),e.noConflict=function(){return t.async=n,e};var i=function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n+=1)t(e[n],n,e)},s=function(e,t){if(e.map)return e.map(t);var n=[];return i(e,function(e,r,i){n.push(t(e,r,i))}),n},o=function(e,t,n){return e.reduce?e.reduce(t,n):(i(e,function(e,r,i){n=t(n,e,r,i)}),n)},u=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};typeof process=="undefined"||!process.nextTick?typeof setImmediate=="function"?(e.setImmediate=setImmediate,e.nextTick=setImmediate):(e.setImmediate=e.nextTick,e.nextTick=function(e){setTimeout(e,0)}):(e.nextTick=process.nextTick,e.setImmediate=setImmediate),e.each=function(e,t,n){n=n||function(){};if(!e.length)return n();var s=0;i(e,function(i){t(i,r(function(t){t?(n(t),n=function(){}):(s+=1,s>=e.length&&n(null))}))})},e.forEach=e.each,e.eachSeries=function(e,t,n){n=n||function(){};if(!e.length)return n();var r=0,i=function(){t(e[r],function(t){t?(n(t),n=function(){}):(r+=1,r>=e.length?n(null):i())})};i()},e.forEachSeries=e.eachSeries,e.eachLimit=function(e,t,n,r){var i=a(t);i.apply(null,[e,n,r])},e.forEachLimit=e.eachLimit;var a=function(e){return function(t,n,r){r=r||function(){};if(!t.length||e<=0)return r();var i=0,s=0,o=0;(function u(){if(i>=t.length)return r();while(o<e&&s<t.length)s+=1,o+=1,n(t[s-1],function(e){e?(r(e),r=function(){}):(i+=1,o-=1,i>=t.length?r():u())})})()}},f=function(t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[e.each].concat(n))}},l=function(e,t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[a(e)].concat(n))}},c=function(t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[e.eachSeries].concat(n))}},h=function(e,t,n,r){var i=[];t=s(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n,r){i[e.index]=r,t(n)})},function(e){r(e,i)})};e.map=f(h),e.mapSeries=c(h),e.mapLimit=function(e,t,n,r){return p(t)(e,n,r)};var p=function(e){return l(e,h)};e.reduce=function(t,n,r,i){e.eachSeries(t,function(e,t){r(n,e,function(e,r){n=r,t(e)})},function(e){i(e,n)})},e.inject=e.reduce,e.foldl=e.reduce,e.reduceRight=function(t,n,r,i){var o=s(t,function(e){return e}).reverse();e.reduce(o,n,r,i)},e.foldr=e.reduceRight;var d=function(e,t,n,r){var i=[];t=s(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n&&i.push(e),t()})},function(e){r(s(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};e.filter=f(d),e.filterSeries=c(d),e.select=e.filter,e.selectSeries=e.filterSeries;var v=function(e,t,n,r){var i=[];t=s(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n||i.push(e),t()})},function(e){r(s(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};e.reject=f(v),e.rejectSeries=c(v);var m=function(e,t,n,r){e(t,function(e,t){n(e,function(n){n?(r(e),r=function(){}):t()})},function(e){r()})};e.detect=f(m),e.detectSeries=c(m),e.some=function(t,n,r){e.each(t,function(e,t){n(e,function(e){e&&(r(!0),r=function(){}),t()})},function(e){r(!1)})},e.any=e.some,e.every=function(t,n,r){e.each(t,function(e,t){n(e,function(e){e||(r(!1),r=function(){}),t()})},function(e){r(!0)})},e.all=e.every,e.sortBy=function(t,n,r){e.map(t,function(e,t){n(e,function(n,r){n?t(n):t(null,{value:e,criteria:r})})},function(e,t){if(e)return r(e);var n=function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0};r(null,s(t.sort(n),function(e){return e.value}))})},e.auto=function(t,n){n=n||function(){};var r=u(t);if(!r.length)return n(null);var s={},a=[],f=function(e){a.unshift(e)},l=function(e){for(var t=0;t<a.length;t+=1)if(a[t]===e){a.splice(t,1);return}},c=function(){i(a.slice(0),function(e){e()})};f(function(){u(s).length===r.length&&(n(null,s),n=function(){})}),i(r,function(r){var a=t[r]instanceof Function?[t[r]]:t[r],h=function(t){var o=Array.prototype.slice.call(arguments,1);o.length<=1&&(o=o[0]);if(t){var a={};i(u(s),function(e){a[e]=s[e]}),a[r]=o,n(t,a),n=function(){}}else s[r]=o,e.setImmediate(c)},p=a.slice(0,Math.abs(a.length-1))||[],d=function(){return o(p,function(e,t){return e&&s.hasOwnProperty(t)},!0)&&!s.hasOwnProperty(r)};if(d())a[a.length-1](h,s);else{var v=function(){d()&&(l(v),a[a.length-1](h,s))};f(v)}})},e.waterfall=function(t,n){n=n||function(){};if(t.constructor!==Array){var r=new Error("First argument to waterfall must be an array of functions");return n(r)}if(!t.length)return n();var i=function(t){return function(r){if(r)n.apply(null,arguments),n=function(){};else{var s=Array.prototype.slice.call(arguments,1),o=t.next();o?s.push(i(o)):s.push(n),e.setImmediate(function(){t.apply(null,s)})}}};i(e.iterator(t))()};var g=function(e,t,n){n=n||function(){};if(t.constructor===Array)e.map(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var r={};e.each(u(t),function(e,n){t[e](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[e]=i,n(t)})},function(e){n(e,r)})}};e.parallel=function(t,n){g({map:e.map,each:e.each},t,n)},e.parallelLimit=function(e,t,n){g({map:p(t),each:a(t)},e,n)},e.series=function(t,n){n=n||function(){};if(t.constructor===Array)e.mapSeries(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var r={};e.eachSeries(u(t),function(e,n){t[e](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[e]=i,n(t)})},function(e){n(e,r)})}},e.iterator=function(e){var t=function(n){var r=function(){return e.length&&e[n].apply(null,arguments),r.next()};return r.next=function(){return n<e.length-1?t(n+1):null},r};return t(0)},e.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var y=function(e,t,n,r){var i=[];e(t,function(e,t){n(e,function(e,n){i=i.concat(n||[]),t(e)})},function(e){r(e,i)})};e.concat=f(y),e.concatSeries=c(y),e.whilst=function(t,n,r){t()?n(function(i){if(i)return r(i);e.whilst(t,n,r)}):r()},e.doWhilst=function(t,n,r){t(function(i){if(i)return r(i);n()?e.doWhilst(t,n,r):r()})},e.until=function(t,n,r){t()?r():n(function(i){if(i)return r(i);e.until(t,n,r)})},e.doUntil=function(t,n,r){t(function(i){if(i)return r(i);n()?r():e.doUntil(t,n,r)})},e.queue=function(t,n){function s(t,r,s,o){r.constructor!==Array&&(r=[r]),i(r,function(r){var i={data:r,callback:typeof o=="function"?o:null};s?t.tasks.unshift(i):t.tasks.push(i),t.saturated&&t.tasks.length===n&&t.saturated(),e.setImmediate(t.process)})}n===undefined&&(n=1);var o=0,u={tasks:[],concurrency:n,saturated:null,empty:null,drain:null,push:function(e,t){s(u,e,!1,t)},unshift:function(e,t){s(u,e,!0,t)},process:function(){if(o<u.concurrency&&u.tasks.length){var e=u.tasks.shift();u.empty&&u.tasks.length===0&&u.empty(),o+=1;var n=function(){o-=1,e.callback&&e.callback.apply(e,arguments),u.drain&&u.tasks.length+o===0&&u.drain(),u.process()},i=r(n);t(e.data,i)}},length:function(){return u.tasks.length},running:function(){return o}};return u},e.cargo=function(t,n){var r=!1,o=[],u={tasks:o,payload:n,saturated:null,empty:null,drain:null,push:function(t,r){t.constructor!==Array&&(t=[t]),i(t,function(e){o.push({data:e,callback:typeof r=="function"?r:null}),u.saturated&&o.length===n&&u.saturated()}),e.setImmediate(u.process)},process:function a(){if(r)return;if(o.length===0){u.drain&&u.drain();return}var e=typeof n=="number"?o.splice(0,n):o.splice(0),f=s(e,function(e){return e.data});u.empty&&u.empty(),r=!0,t(f,function(){r=!1;var t=arguments;i(e,function(e){e.callback&&e.callback.apply(null,t)}),a()})},length:function(){return o.length},running:function(){return r}};return u};var b=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);typeof console!="undefined"&&(t?console.error&&console.error(t):console[e]&&i(n,function(t){console[e](t)}))}]))}};e.log=b("log"),e.dir=b("dir"),e.memoize=function(e,t){var n={},r={};t=t||function(e){return e};var i=function(){var i=Array.prototype.slice.call(arguments),s=i.pop(),o=t.apply(null,i);o in n?s.apply(null,n[o]):o in r?r[o].push(s):(r[o]=[s],e.apply(null,i.concat([function(){n[o]=arguments;var e=r[o];delete r[o];for(var t=0,i=e.length;t<i;t++)e[t].apply(null,arguments)}])))};return i.memo=n,i.unmemoized=e,i},e.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},e.times=function(t,n,r){var i=[];for(var s=0;s<t;s++)i.push(s);return e.map(i,n,r)},e.timesSeries=function(t,n,r){var i=[];for(var s=0;s<t;s++)i.push(s);return e.mapSeries(i,n,r)},e.compose=function(){var t=Array.prototype.reverse.call(arguments);return function(){var n=this,r=Array.prototype.slice.call(arguments),i=r.pop();e.reduce(t,r,function(e,t,r){t.apply(n,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);r(e,t)}]))},function(e,t){i.apply(n,[e].concat(t))})}};var w=function(e,t){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),i=r.pop();return e(t,function(e,t){e.apply(n,r.concat([t]))},i)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return n.apply(this,r)}return n};e.applyEach=f(w),e.applyEachSeries=c(w),e.forever=function(e,t){function n(r){if(r){if(t)return t(r);throw r}e(n)}n()},typeof define!="undefined"&&define.amd?define("async",[],function(){return e}):typeof module!="undefined"&&module.exports?module.exports=e:t.async=e}(),define("modules/ppmanager/pass",["require"],function(e){var t=function(e){var t=this;this.inputPin={},this._inputSlot=0,this.parameters={},this.outputPin=null,this.fragmentShader="",this._material=new THREE.ShaderMaterial({vertexShader:["varying vec2 vUv;","void main(){","vUv = vec2(uv.x, uv.y);","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n")}),e=e||{},this.initialize(e),this._camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this._geometry=new THREE.PlaneGeometry(2,2),this._quad=new THREE.Mesh(this._geometry,this._material),this._scene=new THREE.Scene,this._scene.add(this._quad),this._scene.add(this._camera)};return t.prototype={initialize:function(e){e.fragmentShader&&this.setFragmentShader(e.fragmentShader),e.inputPin&&this.addInputPin(e.inputPin),e.outputPin&&this.setOutputPin(e.outputPin),e.parameters&&this.addParameter(e.parameters)},addInputPin:function(e){for(var t in e)this.inputPin[t]=e[t],this._material.uniforms[t]={type:"t",value:e[t]}},addParameter:function(e){for(var t in e)this.parameters[t]=e[t],this._material.uniforms[t]=e[t]},updateParameter:function(e,t){if(typeof e=="string"){var n={};n[e]=t}else n=e;for(var e in n)this.parameters[e].value=n[e],this._material.uniforms[e].value=n[e]},setInputPin:function(e,t){if(typeof e=="string"){var n={};n[e]=t}else var n=e;for(var e in n){this.inputPin[e]=n[e];var r=this._material.uniforms[e];r.value=n[e]}},removeInputPin:function(e){this.inputPin[e]=null;var t=this._material.uniforms[e];t.value=null},setOutputPin:function(e){this.outputPin=e},removeOutputPin:function(){this.outputPin=null},setFragmentShader:function(e){this.fragmentShader=e,this._material.fragmentShader=e,this._material.needsUpdate=!0},setVertexShader:function(e){this._material.vertexShader=e,this._material.needsUpdate=!0},render:function(e,t){this.outputPin&&!t?e.render(this._scene,this._camera,this.outputPin,!0):e.render(this._scene,this._camera)}},t}),define("modules/ppmanager/fx",["require","qpf","async","./pass"],function(e){var t=e("qpf"),n=t.use("core/clazz"),r=t.use("knockout"),i=t.use("ko.mapping"),s=e("async"),o=e("./pass"),u=["fx/lookups/images/amatorka.png","fx/lookups/images/horrorblue.png","fx/lookups/images/bleachbypass.png","fx/lookups/images/latesunset.png","fx/lookups/images/candlelight.png","fx/lookups/images/lookup.png","fx/lookups/images/crispwarm.png","fx/lookups/images/missetikate.png","fx/lookups/images/crispwinter.png","fx/lookups/images/moonlight.png","fx/lookups/images/dropblues.png","fx/lookups/images/nightfromday.png","fx/lookups/images/edgyamber.png","fx/lookups/images/soft_elegance_1.png","fx/lookups/images/fallcolors.png","fx/lookups/images/soft_elegance_2.png","fx/lookups/images/filmstock_50.png","fx/lookups/images/softwarming.png","fx/lookups/images/foggynight.png","fx/lookups/images/tealorangepluscontrast.png","fx/lookups/images/futuristicbleak.png","fx/lookups/images/tensiongreen.png"],a={};s.eachSeries(u,function(e,t){if(a[e])t();else{var n=new Image;n.onload=function(){var r=new THREE.Texture;r.image=n,r.magFilter=THREE.NearestFilter,r.minFilter=THREE.NearestFilter,r.flipY=!1,r.needsUpdate=!0,n.onload=null,a[e]=r,t()},n.src=e}});var f=n.derive(function(){return{_passes:r.observableArray(),parameters:r.observableArray()}},function(){this.passes=i.fromJS(this.passes),_.each(this.passes&&this.passes(),function(e){var t=new o({fragmentShader:e.shaderString(),inputPin:{texture:null},parameters:{imageWidth:{type:"f",value:1024},imageHeight:{type:"f",value:1024}}}),n=e&&e.uniforms;_.each(n,function(e,n){var i={},s=r.utils.unwrapObservable(e.value);if(typeof s=="string"){var o=s.match(/(\S*)\((.*)\)/);if(o){var u=o[1],a=o[2].replace("\n","").split(/\s*,\s*/),f=l[u];f&&(s=f.apply(l,a))}}i[n]={value:s,type:e.type&&e.type()},t.addParameter(i),e.value.subscribe(function(e){t.updateParameter(n,e)}),this.parameters.push(e)},this),this._passes.push(t)},this),this.provides=r.computed(function(){var e=[];return _.each(this.parameters(),function(t){if(!t.ui)return;var n=_.omit(t,"ui","type");_.extend(n,{type:t.ui}),e.push(n)}),e},this)},{eachPass:function(e){_.each(this._passes(),function(t){e&&e(t)})},dispose:function(){}}),l={mat4:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){return _.each(arguments,function(e,t){arguments[t]=parseInt(e)}),new THREE.Matrix4(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v)},mat3:function(e,t,n,r,i,s,o,u,a){return _.each(arguments,function(e,t){arguments[t]=parseInt(e)}),new THREE.Matrix3(e,t,n,r,i,s,o,u,a)},texture:function(e){e="fx/"+e;var t=a[e];if(!t){var t=THREE.ImageUtils.loadTexture(e);t.magFilter=THREE.NearestFilter,t.minFilter=THREE.NearestFilter,t.flipY=!1,t.needsUpdate=!0,a[e]=t}return t}};return f}),define("modules/ppmanager/manager",["require","qpf","./fx","./pass"],function(e){var t=e("qpf"),n=t.use("core/clazz"),r=t.use("knockout"),i=e("./fx"),s=e("./pass"),o={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat},u={},a=n.derive(function(){return{fxs:r.observableArray(),inputRT:new THREE.WebGLRenderTarget(1024,1024,o),outputRT:new THREE.WebGLRenderTarget(1024,1024,o),texture:null,enable:r.observable(!0),outputPass:new s({fragmentShader:["uniform float opacity;","uniform sampler2D texture;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( texture, vUv );","gl_FragColor = opacity * texel;","}"].join("\n"),parameters:{opacity:{type:"f",value:1}},inputPin:{texture:null}}),provides:r.observableArray()}},function(){var e=_.clone(this.fxs());this.fxs.subscribe(function(t){var n=[],i=this.provides(),s=r.utils.compareArrays(e,t);_.each(s,function(t){if(t.status==="retained"){var s=e.indexOf(t.value);n[index]=i[s]}else if(t.status==="added"){var o=t.value;n[t.index]={title:o.name,parameters:r.utils.unwrapObservable(o.provides)}}},this),this.provides(n)},this)},{add:function(e,t){var n=this;this.load(e,function(e){if(typeof e=="function"){var r=new e;n.fxs.push(r),t&&t(r)}else var r=n.buildFx(e);t&&t(r)})},load:function(t,n){if(u[t]){n&&n(u[t]);return}var r=this;e(["fx/"+t],function(r){if(typeof r=="function")n&&n(r);else{var i=r.passes,s=0;_.each(i,function(i,o){i.shader&&(s++,e(["text!shaders/"+i.shader],function(e){i.shaderString=e,s--,s==0&&(u[t]=r,n&&n(r))}))})}})},buildFx:function(e){var t=new i(e);return this.fxs.push(t),t},render:function(e){var t=!0,n=this;this.enable&&this.enable()&&_.each(this.fxs(),function(r){if(r instanceof i)r.eachPass(function(r){t?(r.setInputPin("texture",n.texture),t=!1):r.setInputPin("texture",n.inputRT),r.setOutputPin(n.outputRT),r.render(e),n._swap()});else{var s=r.render(e,t?n.texture:n.inputRT,n.outputRT);s===n.outputRT&&n._swap(),t=!1}}),this.outputPass.setInputPin("texture",t?n.texture:n.inputRT),this.outputPass.render(e)},_swap:function(){var e=this.inputRT;this.inputRT=this.outputRT,this.outputRT=e}});return a}),define("modules/layers/index",["require","../module","text!./layers.xml","./layer","../common/list","../ppmanager/manager"],function(e){var t=e("../module"),n=e("text!./layers.xml"),r=e("./layer"),i=e("../common/list"),s=e("../ppmanager/manager"),o=new t({name:"layers",xml:n,Layer:r,manager:new s});return o.manager.add("coloradjust"),o.setFilter=function(e){o.manager.fxs(_.filter(o.manager.fxs(),function(e){if(!e.__filter__)return!0;e.dispose&&e.dispose()})),o.manager.add(e,function(e){e.__filter__=!0})},o}),define("modules/filters/filter",["require","qpf","text!./filter.html","../layers/index"],function(e){var t=e("qpf"),n=t.use("components/widget/widget"),r=t.use("knockout"),i=e("text!./filter.html"),s=e("../layers/index"),o=n.derive(function(){var e={title:r.observable(""),preview:r.observable(""),description:r.observable(""),name:r.observable(""),use:function(){s.setFilter(this.name())}};return e._previewSrc=r.computed(function(){if(e.preview())return"fx/preview/"+e.preview()}),e},{type:"FILTER",css:"filter",template:i});return o}),define("modules/filters/source",{filters:[{title:"Gaussian",name:"gaussian",preview:"gaussian.jpg",description:""},{title:"Sepia",name:"sepia",preview:"sepia.jpg",description:""},{title:"Miss Etikate",name:"lookups/missetikate",preview:"missetikate.jpg",description:""},{title:"Amatorka",name:"lookups/amatorka",preview:"amatorka.jpg",description:""},{title:"Bleach Bypass",name:"lookups/bleachbypass",preview:"bleachbypass.jpg",description:""},{title:"Candle Light",name:"lookups/candlelight",preview:"candlelight.jpg",description:""},{title:"Crisp Warm",name:"lookups/crispwarm",preview:"crispwarm.jpg",description:""},{title:"Crisp Winter",name:"lookups/crispwinter",preview:"crispwinter.jpg",description:""},{title:"Drop Blues",name:"lookups/dropblues",preview:"dropblues.jpg",description:""},{title:"Edgy Amber",name:"lookups/edgyamber",preview:"edgyamber.jpg",description:""},{title:"Fall Colors",name:"lookups/fallcolors",preview:"fallcolors.jpg",description:""},{title:"Film Stock 50",name:"lookups/filmstock_50",preview:"filmstock_50.jpg",description:""},{title:"Foggy Night",name:"lookups/foggynight",preview:"foggynight.jpg",description:""},{title:"Futuristic Bleak",name:"lookups/futuristicbleak",preview:"futuristicbleak.jpg",description:""},{title:"Horror Blue",name:"lookups/horrorblue",preview:"horrorblue.jpg",description:""},{title:"Late Sunset",name:"lookups/latesunset",preview:"latesunset.jpg",description:""},{title:"Moonlight",name:"lookups/moonlight",preview:"moonlight.jpg",description:""},{title:"Night From Day",name:"lookups/nightfromday",preview:"nightfromday.jpg",description:""},{title:"Soft Warming",name:"lookups/softwarming",preview:"softwarming.jpg",description:""},{title:"Teal Orange Plus...",name:"lookups/tealorangepluscontrast",preview:"tealorangepluscontrast.jpg",description:""},{title:"Tension Green",name:"lookups/tensiongreen",preview:"tensiongreen.jpg",description:""},{title:"Grayscale",name:"grayscale",preview:"grayscale.jpg"},{title:"Soft Elegance",name:"softelegance",preview:"softelegance.jpg",description:""},{title:"Sketch",name:"sketch",preview:"sketch.jpg"},{title:"Toon",name:"toon",preview:"toon.jpg"},{title:"Smooth Toon",name:"smoothtoon",preview:"smoothtoon.jpg"},{title:"Sobel Edge Detection",name:"sobel",preview:"sobel.jpg"},{title:"Threshold Edge Detect",name:"thresholdedge",preview:"threshold.jpg"},{title:"Canny Edge Detection",name:"canny",preview:"canny.jpg"}]}),define("modules/filters/index",["require","../module","text!./filters.xml","qpf","./filter","./source","../layers/index"],function(e){function l(){var e=s.filters[f];e&&o.manager.load(e.name,function(){f++,l()})}var t=e("../module"),n=e("text!./filters.xml"),r=e("qpf"),i=e("./filter"),s=e("./source"),o=e("../layers/index"),u=r.use("knockout"),a=new t({name:"filters",xml:n,filters:u.observableArray(s.filters),FilterView:i,seachKeyword:u.observable("")});a.seachKeyword.subscribe(function(e){e?a.filters(_.filter(a.filters(),function(t){return t.name.indexOf(e.toLowerCase())>=0||t.title.indexOf(e)>=0})):a.filters(s.filters)});var f=0;return l(),a}),define("text!modules/histogram/histogram.xml",[],function(){return'<panel title="Histogram" id="Histogram" onresize="@binding[onResize]">\n	<histogram></histogram>\n</panel>'}),function(e){typeof define!="undefined"&&define.amd?define("qtek",["exports"],e):e(window.qtek={})}(function(e){var t,n,r;(function(e){function d(e,t){return h.call(e,t)}function v(e,t){var n,r,i,s,o,u,a,f,c,h,p=t&&t.split("/"),d=l.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(f=0;f<e.length;f+=1){h=e[f];if(h===".")e.splice(f,1),f-=1;else if(h===".."){if(f===1&&(e[2]===".."||e[0]===".."))break;f>0&&(e.splice(f-1,2),f-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(f=n.length;f>0;f-=1){r=n.slice(0,f).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=f;break}}}if(s)break;!u&&v&&v[r]&&(u=v[r],a=f)}!s&&u&&(s=u,o=a),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function m(t,n){return function(){return s.apply(e,p.call(arguments,0).concat([t,n]))}}function g(e){return function(t){return v(t,e)}}function y(e){return function(t){a[e]=t}}function b(t){if(d(f,t)){var n=f[t];delete f[t],c[t]=!0,i.apply(e,n)}if(!d(a,t)&&!d(c,t))throw new Error("No "+t);return a[t]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice;o=function(e,t){var n,r=w(e),i=r[0];return e=r[1],i&&(i=v(i,t),n=b(i)),i?n&&n.normalize?e=n.normalize(e,g(t)):e=v(e,t):(e=v(e,t),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return m(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:E(e)}}},i=function(t,n,r,i){var s,l,h,p,v,g=[],w;i=i||t;if(typeof r=="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(v=0;v<n.length;v+=1){p=o(n[v],i),l=p.f;if(l==="require")g[v]=u.require(t);else if(l==="exports")g[v]=u.exports(t),w=!0;else if(l==="module")s=g[v]=u.module(t);else if(d(a,l)||d(f,l)||d(c,l))g[v]=b(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,m(i,!0),y(l),{}),g[v]=a[l]}}h=r.apply(a[t],g);if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!w)a[t]=h}else t&&(a[t]=r)},t=n=s=function(t,n,r,a,f){return typeof t=="string"?u[t]?u[t](n):b(o(t,n).f):(t.splice||(l=t,n.splice?(t=n,n=r,r=null):t=e),n=n||function(){},typeof r=="function"&&(r=a,a=f),a?i(e,t,n,r):setTimeout(function(){i(e,t,n,r)},4),s)},s.config=function(e){return l=e,l.deps&&s(l.deps,l.callback),s},r=function(e,t,n){t.splice||(n=t,t=[]),!d(a,e)&&!d(f,e)&&(f[e]=[e,t,n])},r.amd={jQuery:!0}})(),r("build/almond",function(){}),r("2d/camera",function(){}),r("core/mixin/derive",[],function(){function e(e,t,n){typeof t=="object"&&(n=t,t=null);var r={"instanceof":function(e){var t=s;while(t){if(t===e)return!0;t=t.__super__}}},i=this,s=function(n){i.call(this),_.extend(this,typeof e=="function"?e.call(this):e),_.extend(this,n);if(this.constructor==s){var r=s,o=[t];while(r.__super__)r=r.__super__,o.unshift(r.__initialize__);for(var u=0;u<o.length;u++)o[u]&&o[u].call(this)}};return s.__super__=i,s.__initialize__=t,_.extend(s.prototype,i.prototype,r,n),s.prototype.constructor=s,s.derive=i.derive,s}return{derive:e}}),r("core/mixin/notifier",[],function(){return{trigger:function(){if(!this.__handlers__)return;var e=arguments[0],t=Array.prototype.slice.call(arguments,1),n=this.__handlers__[e];if(n)for(var r=0;r<n.length;r+=2){var i=n[r],s=n[r+1];i.apply(s||this,t)}},on:function(e,t,n){if(!e)return;var r=this.__handlers__||(this.__handlers__={});return r[e]||(r[e]=[]),r[e].indexOf(t)==-1&&(r[e].push(t),r[e].push(n)),t},off:function(e,t){var n=this.__handlers__||(this.__handlers__={});if(n[e])if(t){var r=n[e],i=r.indexOf(t);i>=0&&r.splice(i,2)}else n[e]=[]}}}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r.push(t.call(n,e,i,s))}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&r.push(e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?void 0:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t==null?x.identity:t);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n},x.unzip=function(e){var t=[];return x.each(e,function(e,n){x.each(e,function(e,r){t.length<=r&&(t[r]=[]),t[r][n]=e})}),t},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);if(t.length===0)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t,n){var r,i,s,o,u=0,a=function(){u=new Date,s=null,o=e.apply(r,i)};return function(){var f=new Date;!u&&n===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0?(clearTimeout(s),s=null,u=f,o=e.apply(r,i)):s||(s=setTimeout(a,l)),o}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&t.push(n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=M(e[o],t[o],n,r)))break}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&M(e[c],t[c],n,r)))break}if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(Math.max(0,e));for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(e==null)return void 0;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\"+B[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),r("_",function(e){return function(){var t,n;return t||e._}}(this)),r("core/clazz",["require","./mixin/derive","./mixin/notifier","_"],function(e){var t=e("./mixin/derive"),n=e("./mixin/notifier"),r=e("_"),i=new Function;return r.extend(i,t),r.extend(i.prototype,n),i}),function(e){var t={};typeof exports=="undefined"?typeof r=="function"&&typeof r.amd=="object"&&r.amd?(t.exports={},r("glmatrix",[],function(){return t.exports})):t.exports=typeof window!="undefined"?window:e:t.exports=exports,function(e){if(!t)var t=1e-6;if(!n)var n=typeof Float32Array!="undefined"?Float32Array:Array;if(!r)var r=Math.random;var i={};i.setMatrixArrayType=function(e){n=e},typeof e!="undefined"&&(e.glMatrix=i);var s={};s.create=function(){var e=new n(2);return e[0]=0,e[1]=0,e},s.clone=function(e){var t=new n(2);return t[0]=e[0],t[1]=e[1],t},s.fromValues=function(e,t){var r=new n(2);return r[0]=e,r[1]=t,r},s.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},s.set=function(e,t,n){return e[0]=t,e[1]=n,e},s.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},s.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},s.sub=s.subtract,s.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},s.mul=s.multiply,s.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},s.div=s.divide,s.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},s.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},s.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},s.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},s.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},s.dist=s.distance,s.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},s.sqrDist=s.squaredDistance,s.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},s.len=s.length,s.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},s.sqrLen=s.squaredLength,s.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},s.normalize=function(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},s.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},s.cross=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},s.lerp=function(e,t,n,r){var i=t[0],s=t[1];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e},s.random=function(e,t){t=t||1;var n=r()*2*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},s.transformMat2=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e},s.transformMat2d=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e},s.transformMat3=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e},s.transformMat4=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e},s.forEach=function(){var e=s.create();return function(t,n,r,i,s,o){var u,a;n||(n=2),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],s(e,e,o),t[u]=e[0],t[u+1]=e[1];return t}}(),s.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},typeof e!="undefined"&&(e.vec2=s);var o={};o.create=function(){var e=new n(3);return e[0]=0,e[1]=0,e[2]=0,e},o.clone=function(e){var t=new n(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},o.fromValues=function(e,t,r){var i=new n(3);return i[0]=e,i[1]=t,i[2]=r,i},o.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},o.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},o.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},o.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},o.sub=o.subtract,o.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},o.mul=o.multiply,o.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},o.div=o.divide,o.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},o.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},o.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},o.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},o.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},o.dist=o.distance,o.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i},o.sqrDist=o.squaredDistance,o.length=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},o.len=o.length,o.squaredLength=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r},o.sqrLen=o.squaredLength,o.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},o.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e},o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},o.cross=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2];return e[0]=i*a-s*u,e[1]=s*o-r*a,e[2]=r*u-i*o,e},o.lerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e},o.random=function(e,t){t=t||1;var n=r()*2*Math.PI,i=r()*2-1,s=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*s,e[1]=Math.sin(n)*s,e[2]=i*t,e},o.transformMat4=function(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12],e[1]=n[1]*r+n[5]*i+n[9]*s+n[13],e[2]=n[2]*r+n[6]*i+n[10]*s+n[14],e},o.transformMat3=function(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=r*n[0]+i*n[3]+s*n[6],e[1]=r*n[1]+i*n[4]+s*n[7],e[2]=r*n[2]+i*n[5]+s*n[8],e},o.transformQuat=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},o.forEach=function(){var e=o.create();return function(t,n,r,i,s,o){var u,a;n||(n=3),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],s(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2];return t}}(),o.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},typeof e!="undefined"&&(e.vec3=o);var u={};u.create=function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},u.clone=function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},u.fromValues=function(e,t,r,i){var s=new n(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s},u.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},u.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},u.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},u.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e},u.sub=u.subtract,u.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},u.mul=u.multiply,u.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e},u.div=u.divide,u.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},u.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},u.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},u.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},u.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+s*s)},u.dist=u.distance,u.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return n*n+r*r+i*i+s*s},u.sqrDist=u.squaredDistance,u.length=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},u.len=u.length,u.squaredLength=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i},u.sqrLen=u.squaredLength,u.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},u.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o),e},u.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},u.lerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e[3]=u+r*(n[3]-u),e},u.random=function(e,t){return t=t||1,e[0]=r(),e[1]=r(),e[2]=r(),e[3]=r(),u.normalize(e,e),u.scale(e,e,t),e},u.transformMat4=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,e},u.transformQuat=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],u=n[1],a=n[2],f=n[3],l=f*r+u*s-a*i,c=f*i+a*r-o*s,h=f*s+o*i-u*r,p=-o*r-u*i-a*s;return e[0]=l*f+p*-o+c*-a-h*-u,e[1]=c*f+p*-u+h*-o-l*-a,e[2]=h*f+p*-a+l*-u-c*-o,e},u.forEach=function(){var e=u.create();return function(t,n,r,i,s,o){var u,a;n||(n=4),r||(r=0),i?a=Math.min(i*n+r,t.length):a=t.length;for(u=r;u<a;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],e[3]=t[u+3],s(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];return t}}(),u.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},typeof e!="undefined"&&(e.vec4=u);var a={};a.create=function(){var e=new n(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},a.clone=function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},a.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},a.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},a.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*s-i*r;return o?(o=1/o,e[0]=s*o,e[1]=-r*o,e[2]=-i*o,e[3]=n*o,e):null},a.adjoint=function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},a.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},a.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*u+i*f,e[1]=r*a+i*l,e[2]=s*u+o*f,e[3]=s*a+o*l,e},a.mul=a.multiply,a.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+i*u,e[1]=r*-u+i*a,e[2]=s*a+o*u,e[3]=s*-u+o*a,e},a.scale=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1];return e[0]=r*u,e[1]=i*a,e[2]=s*u,e[3]=o*a,e},a.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},typeof e!="undefined"&&(e.mat2=a);var f={};f.create=function(){var e=new n(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},f.clone=function(e){var t=new n(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},f.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},f.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},f.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=n*s-r*i;return a?(a=1/a,e[0]=s*a,e[1]=-r*a,e[2]=-i*a,e[3]=n*a,e[4]=(i*u-s*o)*a,e[5]=(r*o-n*u)*a,e):null},f.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},f.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=n[0],l=n[1],c=n[2],h=n[3],p=n[4],d=n[5];return e[0]=r*f+i*c,e[1]=r*l+i*h,e[2]=s*f+o*c,e[3]=s*l+o*h,e[4]=f*u+c*a+p,e[5]=l*u+h*a+d,e},f.mul=f.multiply,f.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*f,e[1]=-r*f+i*l,e[2]=s*l+o*f,e[3]=-s*f+l*o,e[4]=l*u+f*a,e[5]=l*a-f*u,e},f.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=t[0]*r,e[1]=t[1]*i,e[2]=t[2]*r,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*i,e},f.translate=function(e,t,n){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+n[0],e[5]=t[5]+n[1],e},f.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},typeof e!="undefined"&&(e.mat2d=f);var l={};l.create=function(){var e=new n(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},l.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},l.clone=function(e){var t=new n(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},l.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},l.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},l.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},l.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=l*o-u*f,h=-l*s+u*a,p=f*s-o*a,d=n*c+r*h+i*p;return d?(d=1/d,e[0]=c*d,e[1]=(-l*r+i*f)*d,e[2]=(u*r-i*o)*d,e[3]=h*d,e[4]=(l*n-i*a)*d,e[5]=(-u*n+i*s)*d,e[6]=p*d,e[7]=(-f*n+r*a)*d,e[8]=(o*n-r*s)*d,e):null},l.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8];return e[0]=o*l-u*f,e[1]=i*f-r*l,e[2]=r*u-i*o,e[3]=u*a-s*l,e[4]=n*l-i*a,e[5]=i*s-n*u,e[6]=s*f-o*a,e[7]=r*a-n*f,e[8]=n*o-r*s,e},l.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*(f*s-o*a)+n*(-f*i+o*u)+r*(a*i-s*u)},l.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8];return e[0]=h*r+p*o+d*f,e[1]=h*i+p*u+d*l,e[2]=h*s+p*a+d*c,e[3]=v*r+m*o+g*f,e[4]=v*i+m*u+g*l,e[5]=v*s+m*a+g*c,e[6]=y*r+b*o+w*f,e[7]=y*i+b*u+w*l,e[8]=y*s+b*a+w*c,e},l.mul=l.multiply,l.translate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=n[0],p=n[1];return e[0]=r,e[1]=i,e[2]=s,e[3]=o,e[4]=u,e[5]=a,e[6]=h*r+p*o+f,e[7]=h*i+p*u+l,e[8]=h*s+p*a+c,e},l.rotate=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=Math.sin(n),p=Math.cos(n);return e[0]=p*r+h*o,e[1]=p*i+h*u,e[2]=p*s+h*a,e[3]=p*o-h*r,e[4]=p*u-h*i,e[5]=p*a-h*s,e[6]=f,e[7]=l,e[8]=c,e},l.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},l.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},l.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return e[0]=1-(h+d),e[3]=l+g,e[6]=c-m,e[1]=l-g,e[4]=1-(f+d),e[7]=p+v,e[2]=c+m,e[5]=p-v,e[8]=1-(f+h),e},l.normalFromMat4=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;return O?(O=1/O,e[0]=(u*A-a*L+f*k)*O,e[1]=(a*C-o*A-f*N)*O,e[2]=(o*L-u*C+f*T)*O,e[3]=(i*L-r*A-s*k)*O,e[4]=(n*A-i*C+s*N)*O,e[5]=(r*C-n*L-s*T)*O,e[6]=(v*x-m*S+g*E)*O,e[7]=(m*w-d*x-g*b)*O,e[8]=(d*S-v*w+g*y)*O,e):null},l.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},typeof e!="undefined"&&(e.mat3=l);var c={};c.create=function(){var e=new n(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.clone=function(e){var t=new n(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},c.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.transpose=function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],s=t[6],o=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=i,e[13]=o,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},c.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=n*u-r*o,b=n*a-i*o,w=n*f-s*o,E=r*a-i*u,S=r*f-s*u,x=i*f-s*a,T=l*v-c*d,N=l*m-h*d,C=l*g-p*d,k=c*m-h*v,L=c*g-p*v,A=h*g-p*m,O=y*A-b*L+w*k+E*C-S*N+x*T;return O?(O=1/O,e[0]=(u*A-a*L+f*k)*O,e[1]=(i*L-r*A-s*k)*O,e[2]=(v*x-m*S+g*E)*O,e[3]=(h*S-c*x-p*E)*O,e[4]=(a*C-o*A-f*N)*O,e[5]=(n*A-i*C+s*N)*O,e[6]=(m*w-d*x-g*b)*O,e[7]=(l*x-h*w+p*b)*O,e[8]=(o*L-u*C+f*T)*O,e[9]=(r*C-n*L-s*T)*O,e[10]=(d*S-v*w+g*y)*O,e[11]=(c*w-l*S-p*y)*O,e[12]=(u*N-o*k-a*T)*O,e[13]=(n*k-r*N+i*T)*O,e[14]=(v*b-d*E-m*y)*O,e[15]=(l*E-c*b+h*y)*O,e):null},c.adjoint=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5],a=t[6],f=t[7],l=t[8],c=t[9],h=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15];return e[0]=u*(h*g-p*m)-c*(a*g-f*m)+v*(a*p-f*h),e[1]=-(r*(h*g-p*m)-c*(i*g-s*m)+v*(i*p-s*h)),e[2]=r*(a*g-f*m)-u*(i*g-s*m)+v*(i*f-s*a),e[3]=-(r*(a*p-f*h)-u*(i*p-s*h)+c*(i*f-s*a)),e[4]=-(o*(h*g-p*m)-l*(a*g-f*m)+d*(a*p-f*h)),e[5]=n*(h*g-p*m)-l*(i*g-s*m)+d*(i*p-s*h),e[6]=-(n*(a*g-f*m)-o*(i*g-s*m)+d*(i*f-s*a)),e[7]=n*(a*p-f*h)-o*(i*p-s*h)+l*(i*f-s*a),e[8]=o*(c*g-p*v)-l*(u*g-f*v)+d*(u*p-f*c),e[9]=-(n*(c*g-p*v)-l*(r*g-s*v)+d*(r*p-s*c)),e[10]=n*(u*g-f*v)-o*(r*g-s*v)+d*(r*f-s*u),e[11]=-(n*(u*p-f*c)-o*(r*p-s*c)+l*(r*f-s*u)),e[12]=-(o*(c*m-h*v)-l*(u*m-a*v)+d*(u*h-a*c)),e[13]=n*(c*m-h*v)-l*(r*m-i*v)+d*(r*h-i*c),e[14]=-(n*(u*m-a*v)-o*(r*m-i*v)+d*(r*a-i*u)),e[15]=n*(u*h-a*c)-o*(r*h-i*c)+l*(r*a-i*u),e},c.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14],m=e[15],g=t*o-n*s,y=t*u-r*s,b=t*a-i*s,w=n*u-r*o,E=n*a-i*o,S=r*a-i*u,x=f*d-l*p,T=f*v-c*p,N=f*m-h*p,C=l*v-c*d,k=l*m-h*d,L=c*m-h*v;return g*L-y*k+b*C+w*N-E*T+S*x},c.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=t[4],a=t[5],f=t[6],l=t[7],c=t[8],h=t[9],p=t[10],d=t[11],v=t[12],m=t[13],g=t[14],y=t[15],b=n[0],w=n[1],E=n[2],S=n[3];return e[0]=b*r+w*u+E*c+S*v,e[1]=b*i+w*a+E*h+S*m,e[2]=b*s+w*f+E*p+S*g,e[3]=b*o+w*l+E*d+S*y,b=n[4],w=n[5],E=n[6],S=n[7],e[4]=b*r+w*u+E*c+S*v,e[5]=b*i+w*a+E*h+S*m,e[6]=b*s+w*f+E*p+S*g,e[7]=b*o+w*l+E*d+S*y,b=n[8],w=n[9],E=n[10],S=n[11],e[8]=b*r+w*u+E*c+S*v,e[9]=b*i+w*a+E*h+S*m,e[10]=b*s+w*f+E*p+S*g,e[11]=b*o+w*l+E*d+S*y,b=n[12],w=n[13],E=n[14],S=n[15],e[12]=b*r+w*u+E*c+S*v,e[13]=b*i+w*a+E*h+S*m,e[14]=b*s+w*f+E*p+S*g,e[15]=b*o+w*l+E*d+S*y,e},c.mul=c.multiply,c.translate=function(e,t,n){var r=n[0],i=n[1],s=n[2],o,u,a,f,l,c,h,p,d,v,m,g;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*s+t[12],e[13]=t[1]*r+t[5]*i+t[9]*s+t[13],e[14]=t[2]*r+t[6]*i+t[10]*s+t[14],e[15]=t[3]*r+t[7]*i+t[11]*s+t[15]):(o=t[0],u=t[1],a=t[2],f=t[3],l=t[4],c=t[5],h=t[6],p=t[7],d=t[8],v=t[9],m=t[10],g=t[11],e[0]=o,e[1]=u,e[2]=a,e[3]=f,e[4]=l,e[5]=c,e[6]=h,e[7]=p,e[8]=d,e[9]=v,e[10]=m,e[11]=g,e[12]=o*r+l*i+d*s+t[12],e[13]=u*r+c*i+v*s+t[13],e[14]=a*r+h*i+m*s+t[14],e[15]=f*r+p*i+g*s+t[15]),e},c.scale=function(e,t,n){var r=n[0],i=n[1],s=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.rotate=function(e,n,r,i){var s=i[0],o=i[1],u=i[2],a=Math.sqrt(s*s+o*o+u*u),f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;return Math.abs(a)<t?null:(a=1/a,s*=a,o*=a,u*=a,f=Math.sin(r),l=Math.cos(r),c=1-l,h=n[0],p=n[1],d=n[2],v=n[3],m=n[4],g=n[5],y=n[6],b=n[7],w=n[8],E=n[9],S=n[10],x=n[11],T=s*s*c+l,N=o*s*c+u*f,C=u*s*c-o*f,k=s*o*c-u*f,L=o*o*c+l,A=u*o*c+s*f,O=s*u*c+o*f,M=o*u*c-s*f,_=u*u*c+l,e[0]=h*T+m*N+w*C,e[1]=p*T+g*N+E*C,e[2]=d*T+y*N+S*C,e[3]=v*T+b*N+x*C,e[4]=h*k+m*L+w*A,e[5]=p*k+g*L+E*A,e[6]=d*k+y*L+S*A,e[7]=v*k+b*L+x*A,e[8]=h*O+m*M+w*_,e[9]=p*O+g*M+E*_,e[10]=d*O+y*M+S*_,e[11]=v*O+b*M+x*_,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)},c.rotateX=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[4],o=t[5],u=t[6],a=t[7],f=t[8],l=t[9],c=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+f*r,e[5]=o*i+l*r,e[6]=u*i+c*r,e[7]=a*i+h*r,e[8]=f*i-s*r,e[9]=l*i-o*r,e[10]=c*i-u*r,e[11]=h*i-a*r,e},c.rotateY=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[8],l=t[9],c=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-f*r,e[1]=o*i-l*r,e[2]=u*i-c*r,e[3]=a*i-h*r,e[8]=s*r+f*i,e[9]=o*r+l*i,e[10]=u*r+c*i,e[11]=a*r+h*i,e},c.rotateZ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],o=t[1],u=t[2],a=t[3],f=t[4],l=t[5],c=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+f*r,e[1]=o*i+l*r,e[2]=u*i+c*r,e[3]=a*i+h*r,e[4]=f*i-s*r,e[5]=l*i-o*r,e[6]=c*i-u*r,e[7]=h*i-a*r,e},c.fromRotationTranslation=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=r+r,a=i+i,f=s+s,l=r*u,c=r*a,h=r*f,p=i*a,d=i*f,v=s*f,m=o*u,g=o*a,y=o*f;return e[0]=1-(p+v),e[1]=c+y,e[2]=h-g,e[3]=0,e[4]=c-y,e[5]=1-(l+v),e[6]=d+m,e[7]=0,e[8]=h+g,e[9]=d-m,e[10]=1-(l+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},c.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return e[0]=1-(h+d),e[1]=l+g,e[2]=c-m,e[3]=0,e[4]=l-g,e[5]=1-(f+d),e[6]=p+v,e[7]=0,e[8]=c+m,e[9]=p-v,e[10]=1-(f+h),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},c.frustum=function(e,t,n,r,i,s,o){var u=1/(n-t),a=1/(i-r),f=1/(s-o);return e[0]=s*2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*a,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(i+r)*a,e[10]=(o+s)*f,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*f,e[15]=0,e},c.perspective=function(e,t,n,r,i){var s=1/Math.tan(t/2),o=1/(r-i);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+r)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*r*o,e[15]=0,e},c.ortho=function(e,t,n,r,i,s,o){var u=1/(t-n),a=1/(r-i),f=1/(s-o);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(t+n)*u,e[13]=(i+r)*a,e[14]=(o+s)*f,e[15]=1,e},c.lookAt=function(e,n,r,i){var s,o,u,a,f,l,h,p,d,v,m=n[0],g=n[1],y=n[2],b=i[0],w=i[1],E=i[2],S=r[0],x=r[1],T=r[2];return Math.abs(m-S)<t&&Math.abs(g-x)<t&&Math.abs(y-T)<t?c.identity(e):(h=m-S,p=g-x,d=y-T,v=1/Math.sqrt(h*h+p*p+d*d),h*=v,p*=v,d*=v,s=w*d-E*p,o=E*h-b*d,u=b*p-w*h,v=Math.sqrt(s*s+o*o+u*u),v?(v=1/v,s*=v,o*=v,u*=v):(s=0,o=0,u=0),a=p*u-d*o,f=d*s-h*u,l=h*o-p*s,v=Math.sqrt(a*a+f*f+l*l),v?(v=1/v,a*=v,f*=v,l*=v):(a=0,f=0,l=0),e[0]=s,e[1]=a,e[2]=h,e[3]=0,e[4]=o,e[5]=f,e[6]=p,e[7]=0,e[8]=u,e[9]=l,e[10]=d,e[11]=0,e[12]=-(s*m+o*g+u*y),e[13]=-(a*m+f*g+l*y),e[14]=-(h*m+p*g+d*y),e[15]=1,e)},c.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},typeof e!="undefined"&&(e.mat4=c);var h={};h.create=function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},h.rotationTo=function(){var e=o.create(),t=o.fromValues(1,0,0),n=o.fromValues(0,1,0);return function(r,i,s){var u=o.dot(i,s);return u<-0.999999?(o.cross(e,t,i),o.length(e)<1e-6&&o.cross(e,n,i),o.normalize(e,e),h.setAxisAngle(r,e,Math.PI),r):u>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(o.cross(e,i,s),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+u,h.normalize(r,r))}}(),h.setAxes=function(){var e=l.create();return function(t,n,r,i){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=n[0],e[5]=n[1],e[8]=n[2],h.normalize(t,h.fromMat3(t,e))}}(),h.clone=u.clone,h.fromValues=u.fromValues,h.copy=u.copy,h.set=u.set,h.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},h.setAxisAngle=function(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e},h.add=u.add,h.multiply=function(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],u=n[0],a=n[1],f=n[2],l=n[3];return e[0]=r*l+o*u+i*f-s*a,e[1]=i*l+o*a+s*u-r*f,e[2]=s*l+o*f+r*a-i*u,e[3]=o*l-r*u-i*a-s*f,e},h.mul=h.multiply,h.scale=u.scale,h.rotateX=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+o*u,e[1]=i*a+s*u,e[2]=s*a-i*u,e[3]=o*a-r*u,e},h.rotateY=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a-s*u,e[1]=i*a+o*u,e[2]=s*a+r*u,e[3]=o*a-i*u,e},h.rotateZ=function(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],o=t[3],u=Math.sin(n),a=Math.cos(n);return e[0]=r*a+i*u,e[1]=i*a-r*u,e[2]=s*a+o*u,e[3]=o*a-s*u,e},h.calculateW=function(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},h.dot=u.dot,h.lerp=u.lerp,h.slerp=function(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3],a=n[0],f=n[1],l=n[2],c=n[3],h,p,d,v,m;return p=i*a+s*f+o*l+u*c,p<0&&(p=-p,a=-a,f=-f,l=-l,c=-c),1-p>1e-6?(h=Math.acos(p),d=Math.sin(h),v=Math.sin((1-r)*h)/d,m=Math.sin(r*h)/d):(v=1-r,m=r),e[0]=v*i+m*a,e[1]=v*s+m*f,e[2]=v*o+m*l,e[3]=v*u+m*c,e},h.invert=function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s,u=o?1/o:0;return e[0]=-n*u,e[1]=-r*u,e[2]=-i*u,e[3]=s*u,e},h.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},h.length=u.length,h.len=h.length,h.squaredLength=u.squaredLength,h.sqrLen=h.squaredLength,h.normalize=u.normalize,h.fromMat3=function(){var e=typeof Int8Array!="undefined"?new Int8Array([1,2,0]):[1,2,0];return function(t,n){var r=n[0]+n[4]+n[8],i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(n[7]-n[5])*i,t[1]=(n[2]-n[6])*i,t[2]=(n[3]-n[1])*i;else{var s=0;n[4]>n[0]&&(s=1),n[8]>n[s*3+s]&&(s=2);var o=e[s],u=e[o];i=Math.sqrt(n[s*3+s]-n[o*3+o]-n[u*3+u]+1),t[s]=.5*i,i=.5/i,t[3]=(n[u*3+o]-n[o*3+u])*i,t[o]=(n[o*3+s]+n[s*3+o])*i,t[u]=(n[u*3+s]+n[s*3+u])*i}return t}}(),h.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},typeof e!="undefined"&&(e.quat=h)}(t.exports)}(this),r("2d/style",["require","core/clazz","_"],function(e){function u(e){return(e||"").replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"")}var t=e("core/clazz"),n=e("_"),r=["fillStyle","strokeStyle","lineWidth","shadowColor","shadowOffsetX","shadowOffsetY","shadowBlur","globalAlpha","font"],i={fill:"fillStyle",stroke:"strokeStyle",alpha:"globalAlpha",shadow:["shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor"]},s=/(.*?)\s+(.*?)\s+(.*?)\s+([a-zA-Z0-9\(\)]*)/,o=t.derive({},{bind:function(e){var t=r,o=i;for(var a in o)if(this.hasOwnProperty(a)){var f=o[a],l=this[a];if(f.constructor==Array){var c=s.exec(u(l));if(!c)continue;l=c.slice(1),n.each(l,function(t,n){f[n]&&(e[f[n]]=t)},this)}else e[f]=l}n.each(t,function(t){this.hasOwnProperty(t)&&(e[t]=this[t])},this)}});return o}),r("2d/node",["require","core/clazz","glmatrix","./style"],function(e){var t=e("core/clazz"),n=e("glmatrix"),r=n.vec2,i=n.mat2d,s=e("./style"),o=t.derive(function(){return{__mouseover__:!1,id:0,AABB:[r.fromValues(0,0),r.fromValues(0,0)],z:0,style:null,position:r.fromValues(0,0),rotation:0,scale:r.fromValues(1,1),_transform:i.create(),_transformInverse:i.create(),visible:!0,children:{},intersectLineWidth:0,clip:!1,fill:!0,stroke:!0,fixAA:!0}},function(){this.__GUID__=u()},{updateTransform:function(){var e=this._transform;return i.identity(e),this.scale&&i.scale(e,e,this.scale),this.rotation&&i.rotate(e,e,this.rotation),this.position&&i.translate(e,e,this.position),e},updateTransformInverse:function(){i.invert(this._transformInverse,this._transformInverse)},intersectAABB:function(e,t){var n=this.AABB;return n[0][0]<e&&e<n[1][0]&&n[0][1]<t&&t<n[1][1]},add:function(e){e&&(this.children[e.__GUID__]=e,e.parent=this)},remove:function(e){this.children[e.__GUID__]=null,e.parent=null},draw:function(e){},render:function(e){var t=this._getSortedRenderQueue();e.save();if(this.style)if(!this.style instanceof s)for(var n in this.style)this.style[n].bind(e);else this.style.bind(e);var r=this.updateTransform();e.transform(r[0],r[1],r[2],r[3],r[4],r[5]),this.draw(e),this.clip&&e.clip();for(var i=0;i<t.length;i++)t[i].render(e);e.restore()},_getSortedRenderQueue:function(){var e=[];for(var t in this.children)e.push(this.children[t]);return e.sort(function(e,t){return e.z===t.z?e.__GUID__>t.__GUID__?1:-1:e.z>t.z?1:-1}),e}}),u=function(){var e=0;return function(){return++e}}();return o}),r("2d/util/util",["require"],function(e){return{fixPos:function(e){return[e[0]+.5,e[1]+.5]},fixPosArray:function(e){var t=[],n=e.length;for(var r=0;r<n;r++)t.push(this.fixPos(e[r]));return t},computeAABB:function(e){var t=e[0][0],n=e[0][0],r=e[0][1],i=e[0][1];for(var s=1;s<e.length;s++)t=e[s][0]<t?e[s][0]:t,n=e[s][0]>n?e[s][0]:n,r=e[s][1]<r?e[s][1]:r,i=e[s][1]>i?e[s][1]:i;return[[t,r],[n,i]]}}}),r("2d/renderable/arc",["require","../node","../util/util","glmatrix"],function(e){var t=e("../node"),n=e("../util/util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{center:[0,0],radius:0,startAngle:0,endAngle:Math.PI*2,clockwise:!0}},{computeAABB:function(){this.AABB=[[0,0],[0,0]]},draw:function(e){var t=this.fixAA?n.fixPos(this.center):this.center;ctx.beginPath(),ctx.arc(t[0],t[1],this.radius,this.startAngle,this.endAngle,!this.clockwise),this.stroke&&ctx.stroke(),this.fill&&ctx.fill()},intersect:function(e,t){return!1}});return s}),r("2d/renderable/circle",["require","../node","../util/util","glmatrix"],function(e){var t=e("../node"),n=e("../util/util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){},{computeAABB:function(){this.AABB=[[this.center[0]-this.radius,this.center[1]-this.radius],[this.center[0]+this.radius,this.center[1]+this.radius]]},draw:function(e){var t=this.fixAA?n.fixPos(this.center):this.center;e.beginPath(),e.arc(t[0],t[1],this.radius,0,2*Math.PI,!1),this.stroke&&e.stroke(),this.fill&&e.fill()},intersect:function(){return i.len([this.center[0]-x,this.center[1]-y])<this.radius}});return s}),r("2d/renderable/image",["require","../node","../util/util","glmatrix"],function(e){var t=e("../node"),n=e("../util/util"),r=e("glmatrix"),i=r.vec2,s={},o=t.derive(function(){return{img:"",start:[0,0],size:0,onload:function(){}}},function(){if(typeof this.img=="string"){var e=this;GooJS.Image.load(this.img,function(t){e.img=t,e.onload.call(e)})}},{computeAABB:function(){this.AABB=n.computeAABB([this.start,[this.start[0]+this.size[0],this.start[1]+this.size[1]]])},draw:function(e){var t=this.fixAA?n.fixPos(this.start):this.start;typeof this.img!="string"&&(this.size?e.drawImage(this.img,t[0],t[1],this.size[0],this.size[1]):e.drawImage(this.img,t[0],t[1]))},intersect:function(e,t){return this.intersectAABB(e,t)},load:function(e,t){if(s[e]){var n=s[e];n.constructor==Array?n.push(t):t(n)}else{s[e]=[t];var n=new o;n.onload=function(){each(s[e],function(e){e(n)}),s[e]=n},n.src=e}}});return o}),r("2d/renderable/line",["require","../node","../util/util","glmatrix"],function(e){var t=e("../node"),n=e("../util/util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{start:[0,0],end:[0,0],width:0}},{computeAABB:function(){this.AABB=n.computeAABB([this.start,this.end]),this.AABB[0][0]==this.AABB[1][0]&&(this.AABB[0][0]-=this.width/2,this.AABB[1][0]+=this.width/2),this.AABB[0][1]==this.AABB[1][1]&&(this.AABB[0][1]-=this.width/2,this.AABB[1][1]+=this.width/2)},draw:function(e){var t=this.fixAA?n.fixPos(this.start):this.start,r=this.fixAA?n.fixPos(this.end):this.end;e.beginPath(),e.moveTo(t[0],t[1]),e.lineTo(r[0],r[1]),e.stroke()},intersect:function(e,t){if(!this.intersectAABB(e,t))return!1;var n=[e,t];b=this.start,c=this.end,ba=i.sub([],n,b),bc=i.sub([],c,b);var r=i.dot(bc,ba);i.normalize(bc,bc);var s=i.add(b,i.scale(bc,r)),o=i.length(i.sub(n,n,s));return o<this.width/2}});return s}),r("2d/renderable/path",["require","../node","../util/util","glmatrix"],function(e){var t=e("../node"),n=e("../util/util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{segments:[],globalStyle:!0}},{computeAABB:function(){this.AABB=[[0,0],[0,0]]},draw:function(e){this.globalStyle?this.drawWithSameStyle(e):this.drawWithDifferentStyle(e)},drawWithSameStyle:function(e){var t=this.segments.length,n=this.segments;e.beginPath(),e.moveTo(n[0].point[0],n[0].point[1]);for(var r=1;r<t;r++)if(n[r-1].handleOut||n[r].handleIn){var i=n[r-1].handleOut||n[r-1].point,s=n[r].handleIn||n[r].point;e.bezierCurveTo(i[0],i[1],s[0],s[1],n[r].point[0],n[r].point[1])}else e.lineTo(n[r].point[0],n[r].point[1]);this.fill&&e.fill(),this.stroke&&e.stroke()},drawWithDifferentStyle:function(e){var t=this.segments.length,n=this.segments;for(var r=0;r<t-1;r++){e.save(),n[r].style&&n[r].style.bind(e),e.beginPath(),e.moveTo(n[r].point[0],n[r].point[1]);if(n[r].handleOut||n[r+1].handleIn){var i=n[r].handleOut||n[r].point,s=n[r+1].handleIn||n[r+1].point;e.bezierCurveTo(i[0],i[1],s[0],s[1],n[r+1].point[0],n[r+1].point[1])}else e.lineTo(n[r+1].point[0],n[r+1].point[1]);this.stroke&&e.stroke(),this.fill&&e.fill(),e.restore()}},smooth:function(e){function s(e,t,n){var r=i.scale([],i.add([],t,n),.5);return i.sub([],e,r)}var t=this.segments.length,n=[],r=this.segments;for(var o=0;o<t;o++){var u=r[o].point,a=o==t-1?r[0].point:r[o+1].point;n.push(i.scale([],i.add([],u,a),.5))}for(var o=0;o<t;o++){var u=r[o].point,f=n[o],l=o==0?n[t-1]:n[o-1],e=r[o].smoothLevel||e||1,c=i.scale([],i.add([],f,l),.5);v1=i.sub([],f,c),v2=i.sub([],l,c);var h=s(u,l,f);i.scale(v2,v2,e),i.scale(v1,v1,e),r[o].handleIn=i.add([],i.add([],c,v2),h),r[o].handleOut=i.add([],i.add([],c,v1),h)}r[0].handleOut=r[0].handleIn=null,r[t-1].handleIn=r[t-1].handleOut=null},pushPoints:function(e){for(var t=0;t<e.length;t++)this.segments.push({point:e[t],handleIn:null,handleOut:null})}});return s}),r("2d/renderable/polygon",["require","../node","../util/util","glmatrix"],function(e){var t=e("../node"),n=e("../util/util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{points:[]}},{computeAABB:function(){this.AABB=n.computeAABB(this.points)},draw:function(e){var t=this.fixAA?n.fixPosArray(this.points):this.points;e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(var r=1;r<t.length;r++)e.lineTo(t[r][0],t[r][1]);e.closePath(),this.stroke&&e.stroke(),this.fill&&e.fill()},intersect:function(e,t){if(!this.intersectAABB(e,t))return!1;var n=this.points.length,r=0,i=this.points;for(var s=0;s<n;s++){var o=a.normalize([],[i[s][0]-e,i[s][1]-t]),u=(s+1)%n,a=a.normalize([],[i[u][0]-e,i[u][1]-t]),f=Math.acos(a.dot(o,a));r+=f}return Math.length(r-2*Math.PI)<.1}});return t}),r("2d/renderable/rectangle",["require","../node","../util/util","glmatrix"],function(e){var t=e("../node"),n=e("../util/util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{start:[0,0],size:[0,0]}},{computeAABB:function(){var e=i.add([],this.start,this.size);this.AABB=n.computeAABB([this.start,e])},draw:function(e){var t=this.fixAA?n.fixPos(this.start):this.start;e.beginPath(),e.rect(t[0],t[1],this.size[0],this.size[1]),this.stroke&&e.stroke(),this.fill&&e.fill()},intersect:function(e,t){return this.intersectAABB(e,t)}});return s}),r("2d/renderable/roundedrectangle",["require","../node","../util/util","glmatrix"],function(e){var t=e("../node"),n=e("../util/util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{start:[0,0],size:[0,0],radius:0}},{computeAABB:function(){var e=i.add([],this.start,this.size);this.AABB=n.computeAABB([this.start,e])},draw:function(e){if(this.radius.constructor==Number)var t=[this.radius,this.radius,this.radius,this.radius];else if(this.radius.length==2)var t=[this.radius[0],this.radius[1],this.radius[0],this.radius[1]];else var t=this.radius;var r=this.fixAA?n.fixPos(this.start):this.start,s=this.size,o=i.add([],r,[t[0],0]),u=i.add([],r,[s[0],0]),a=i.add([],r,s),f=i.add([],r,[0,s[1]]);e.beginPath(),e.moveTo(o[0],o[1]),t[1]?e.arcTo(u[0],u[1],a[0],a[1],t[1]):e.lineTo(u[0],u[1]),t[2]?e.arcTo(a[0],a[1],f[0],f[1],t[2]):e.lineTo(a[0],a[1]),t[3]?e.arcTo(f[0],f[1],r[0],r[1],t[3]):e.lineTo(f[0],f[1]),t[0]?e.arcTo(r[0],r[1],u[0],u[1],t[0]):e.lineTo(r[0],r[1]),this.stroke&&e.stroke(),this.fill&&e.fill()},intersect:function(e,t){return!1}});return s}),r("2d/renderable/sector",["require","../node","../util/util","glmatrix"],function(e){var t=e("../node"),n=e("../util/util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{center:[0,0],innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,clockwise:!0}},{computeAABB:function(){this.AABB=[0,0]},intersect:function(e,t){var n=this.startAngle,r=this.endAngle,s=this.innerRadius,o=this.outerRadius,u=this.center,a=i.sub([],[e,t],u),f=i.length(a),l=Math.PI*2;if(f<s||f>o)return!1;var c=Math.atan2(a[1],a[0]);return c<0&&(c+=l),this.clockwise?c<r&&c>n:(n=l-n,r=l-r,c>r&&c<n)},draw:function(e){var t=this.startAngle,r=this.endAngle,s=this.innerRadius,o=this.outerRadius,u=this.fixAA?n.fixPos(this.center):this.center;this.clockwise||(t=Math.PI*2-t,r=Math.PI*2-r);var a=i.add([],u,[s*Math.cos(t),s*Math.sin(t)]),f=i.add([],u,[o*Math.cos(t),o*Math.sin(t)]),l=i.add([],u,[s*Math.cos(r),s*Math.sin(r)]),c=i.add([],u,[o*Math.cos(r),o*Math.sin(r)]);e.beginPath(),e.moveTo(a[0],a[1]),e.lineTo(f[0],f[1]),e.arc(u[0],u[1],o,t,r,!this.clockwise),e.lineTo(l[0],l[1]),e.arc(u[0],u[1],s,r,t,this.clockwise),e.endPath(),this.stroke&&e.stroke(),this.fill&&e.fill()}});return s}),r("2d/renderable/text",["require","../node","../util/util","glmatrix"],function(e){var t=e("../node"),n=e("../util/util"),r=e("glmatrix"),i=r.vec2,s=t.derive(function(){return{text:"",start:[0,0],size:[0,0],font:"",textAlign:"",textBaseline:""}},{computeAABB:function(){this.AABB=n.computeAABB([this.start,[this.start[0]+this.size[0],this.start[1]+this.size[1]]])},draw:function(e){var t=this.fixAA?n.fixPos(this.start):this.start;this.font&&(e.font=this.font),this.textAlign&&(e.textAlign=this.textAlign),this.textBaseline&&(e.textBaseline=this.textBaseline),this.fill&&(this.size.length&&this.size[0]?e.fillText(this.text,t[0],t[1],this.size[0]):e.fillText(this.text,t[0],t[1])),this.stroke&&(this.size.length&&this.size[0]?e.strokeText(this.text,t[0],t[1],this.size[0]):e.strokeText(this.text,t[0],t[1]))},resize:function(e){if(!this.size[0]||this.needResize)this.size[0]=e.measureText(this.text).width,this.size[1]=e.measureText("m").width},intersect:function(e,t){return this.intersectAABB(e,t)}});return s}),r("2d/renderable/textbox",["require","../node","../util/util","glmatrix","./text","_"],function(e){var t=e("../node"),n=e("../util/util"),r=e("glmatrix"),i=r.vec2,s=e("./text"),o=e("_"),u=t.derive(function(){return{text:"",textAlign:"",textBaseline:"top",font:"",start:[0,0],width:0,wordWrap:!1,wordBreak:!1,lineHeight:0,stroke:!1,_texts:[]}},function(){this._oldText=""},{computeAABB:function(){},draw:function(e){if(this.text!=this._oldText){this._oldText=this.text,this.font&&(e.font=this.font);if(this.wordBreak)this._texts=this.computeWordBreak(e);else if(this.wordWrap)this._texts=this.computeWordWrap(e);else{var t=new s({text:this.text,textBaseline:this.textBaseline});this.extendCommonProperties(t),this._texts=[t]}}o.each(this._texts,function(t){t.draw(e)})},computeWordWrap:function(e){if(!this.text)return;var t=this.text.split(" "),n=t.length,r=0,o,u,a=[],f;for(var l=0;l<n;l++)u=l==n-1?t[l]:t[l]+" ",o=e.measureText(u).width,r+o>this.width||!f?(f=new s({text:u,start:i.add([],this.start,[0,this.lineHeight*a.length])}),this.extendCommonProperties(f),a.push(f),r=o):(r+=o,f.text+=u);return a},computeWordBreak:function(e){if(!this.text)return;var t=this.text.length,n,r,o=e.measureText(this.text[0]).width,u=[],a;for(var f=0;f<t;f++){r=this.text[f],n=e.measureText(r).width;if(o+n>this.width||!a){var a=new s({text:r,start:i.add([],this.start,[0,this.lineHeight*u.length])});this.extendCommonProperties(a),u.push(a),o=n}else o+=n,a.text+=r}return u},extendCommonProperties:function(e){var t={};o.extend(e,{textAlign:this.textAlign,textBaseline:this.textBaseline,style:this.style,font:this.font,fill:this.fill,stroke:this.stroke})},intersect:function(e,t){}});return u}),r("2d/renderer",["require","core/clazz"],function(e){var t=e("core/clazz"),n=t.derive(function(){return{canvas:null,context:null,width:0,height:0}},function(){this.canvas||(this.canvas=document.createElement("canvas")),this.width?this.canvas.width=this.width:this.width=this.canvas.width,this.height?this.canvas.height=this.height:this.height=this.canvas.height,this.context=this.canvas.getContext("2d")},{resize:function(e,t){this.canvas.width=e,this.canvas.height=t},render:function(e){this.context.clearRect(0,0,this.width,this.height),e.render(this.context)}});return n}),r("2d/scene",["require","./node"],function(e){var t=e("./node"),n=t.derive({},{});return n}),r("core/event",["require","./clazz"],function(e){var t=e("./clazz"),n=t.derive({cancelBubble:!1},{stopPropagation:function(){this.cancelBubble=!0}});n.throw=function(e,t,n){var r=new MouseEvent(n);r.sourceTarget=t;while(t&&!r.cancelBubble)r.target=t,t.trigger(e,r),t=t.parent}}),r("src/qtek",["require","2d/camera","2d/node","2d/renderable/arc","2d/renderable/circle","2d/renderable/image","2d/renderable/line","2d/renderable/path","2d/renderable/polygon","2d/renderable/rectangle","2d/renderable/roundedrectangle","2d/renderable/sector","2d/renderable/text","2d/renderable/textbox","2d/renderer","2d/scene","2d/style","2d/util/util","core/clazz","core/event","core/mixin/derive","core/mixin/notifier"],function(e){return{"2d":{Camera:e("2d/camera"),Node:e("2d/node"),renderable:{Arc:e("2d/renderable/arc"),Circle:e("2d/renderable/circle"),Image:e("2d/renderable/image"),Line:e("2d/renderable/line"),Path:e("2d/renderable/path"),Polygon:e("2d/renderable/polygon"),Rectangle:e("2d/renderable/rectangle"),RoundedRectangle:e("2d/renderable/roundedrectangle"),Sector:e("2d/renderable/sector"),Text:e("2d/renderable/text"),TextBox:e("2d/renderable/textbox")},Renderer:e("2d/renderer"),Scene:e("2d/scene"),Style:e("2d/style"),util:{util:e("2d/util/util")}},core:{Clazz:e("core/clazz"),Event:e("core/event"),mixin:{derive:e("core/mixin/derive"),notifier:e("core/mixin/notifier")}}}});var i=n("src/qtek");for(var s in i)e[s]=i[s]}),define("modules/histogram/histogram",["require","qpf","qtek"],function(e){var t=e("qpf"),n=e("qtek"),r=n["2d"],i=t.use("components/meta/meta"),s=t.use("knockout"),o=i.derive(function(){return{stage:null,scene:null,paths:{r:null,g:null,b:null},resizeCanvas:null,resizeContext:null,size:256,sample:4}},{type:"HISTOGRAM",css:"histogram",initialize:function(){this.stage=new r.Renderer,this.scene=new r.Scene,this.paths.r=new r.renderable.Path({stroke:!1,style:new r.Style({fill:"red",globalAlpha:.5,shadow:"0 -2 3 black"})}),this.paths.g=new r.renderable.Path({stroke:!1,style:new r.Style({fill:"green",globalAlpha:.5})}),this.paths.b=new r.renderable.Path({stroke:!1,style:new r.Style({fill:"blue",globalAlpha:.5})}),this.scene.add(this.paths.r),this.scene.add(this.paths.g),this.scene.add(this.paths.b);var e=document.createElement("canvas");e.width=this.size,e.height=this.size,this.resizeCanvas=e,this.resizeContext=e.getContext("2d")},template:"",setImage:function(e){this.resizeContext.drawImage(e,0,0,this.size,this.size),this.refresh()},refresh:function(){var e=this.computeHistogram();e.r=this.normalizeHistogram(e.r),e.g=this.normalizeHistogram(e.g),e.b=this.normalizeHistogram(e.b),this.updatePath("r",e.r),this.updatePath("g",e.g),this.updatePath("b",e.b),this.stage.render(this.scene)},initPath:function(e){var t=this.paths[e],n=this.height(),r=this.width()/255*this.sample;t.segments=[{point:[0,n]}];var i=0;for(var s=0;s<256;s+=this.sample)t.segments.push({point:[i,0]}),i+=r;t.pushPoints([[this.width(),n],[0,n]])},updatePath:function(e,t){var n=this.paths[e],r=this.height();for(var i=this.sample;i<257;i+=this.sample)n.segments[i/this.sample-1].point[1]=(1-t[i-1]*2/3)*r},computeHistogram:function(){var e=this.resizeContext.getImageData(0,0,this.size,this.size),t=e.data,n={r:[],g:[],b:[]};for(var r=0;r<256;r++)n.r[r]=0,n.g[r]=0,n.b[r]=0;for(var r=0;r<this.size*this.size;r+=4){var i=t[r],s=t[r+1],o=t[r+2];n.r[i]++,n.g[s]++,n.b[o]++}return n},normalizeHistogram:function(e){var t=Math.max.apply(Math,e),n=[];for(var r=0;r<e.length;r++)n.push(t==0||isNaN(t)?0:e[r]/t);return n},afterRender:function(){this.$el[0].appendChild(this.stage.canvas)},afterResize:function(){this.stage.resize(this.width(),this.height()),this.initPath("r"),this.initPath("g"),this.initPath("b"),this.refresh()}});return i.provideBinding("histogram",o),o}),define("modules/histogram/index",["require","../module","text!./histogram.xml","qpf","../layers/index","./histogram"],function(e){var t=e("../module"),n=e("text!./histogram.xml"),r=e("qpf"),i=e("../layers/index"),s=r.use("knockout");e("./histogram");var o,u=new t({name:"histogram",xml:n,onResize:function(){var e=this;setTimeout(function(){var t=e.$el.find(".qpf-panel-body");o.resize(t.width(),t.height())})},update:function(e){e?setTimeout(function(){o.setImage(e)}):o.refresh()},histogram:null});return u.on("start",function(){o=u.$el.find(".qpf-ui-histogram").qpf("get")[0]}),u}),define("text!modules/imagelist/imagelist.xml",[],function(){return'<container id="ImageList">\n	<container class="wrapper">\n		<list dataSource="@binding[images]" class="image-list" itemView="@binding[ImageItem]"></list>\n	</container>\n	<iconbutton icon="left" class="button-left"></iconbutton>\n	<iconbutton icon="right" class="button-right"></iconbutton>\n</container>'}),define("modules/imagelist/imageitem",["require","qpf"],function(e){var t=e("qpf"),n=t.use("components/meta/meta"),r=t.use("knockout"),i=n.derive(function(){return{title:r.observable(""),thumb:r.observable(""),url:r.observable()}},{type:"IMAGEITEM",css:"image-item",initialize:function(){this.$el.mousedown(function(e){e.preventDefault()})},template:'<div class="qpf-image" data-bind="qpf_image:thumb"></div>'});return r.bindingHandlers.qpf_image={init:function(e,t){e.innerHTML="";var n=r.utils.unwrapObservable(t());if(typeof n=="string"){var i=document.createElement("img");i.src=n}else var i=n;e.appendChild(i)}},i}),define("text!modules/viewport/viewport.xml",[],function(){return'<container id="Viewport" onresize="@binding[onResize]">\n	<viewport onrender="@binding[onRender]"></viewport>\n	<toggle enable="@binding[applyFilter]"></toggle>\n</container>'}),define("modules/viewport/viewport",["require","qpf"],function(e){var t=e("qpf"),n=t.use("components/meta/meta"),r=t.use("knockout"),i=n.derive(function(){return{tag:"canvas"}},{type:"VIEWPORT",css:"viewport",initialize:function(){this.renderer=new THREE.WebGLRenderer({canvas:this.$el[0]})}});return n.provideBinding("viewport",i),i}),define("modules/viewport/index",["require","../module","text!./viewport.xml","../layers/index","../histogram/index","./viewport","qpf"],function(e){function p(){c=this.renderer,f&&clearInterval(f),l&&clearInterval(l),f=setInterval(v,100)}function d(){c&&c.setSize(this.width(),this.height())}function v(){a.trigger("beforerender"),h.render(c),i.update(c.domElement)}var t=e("../module"),n=e("text!./viewport.xml"),r=e("../layers/index"),i=e("../histogram/index"),s=e("./viewport"),o=e("qpf"),u=o.use("knockout"),a=new t({name:"viewport",xml:n,applyFilter:u.observable(!0),onRender:p,onResize:d,texture:new THREE.Texture,resize:function(){var e=a.texture.image,t=e.height/e.width;if(a.mainComponent&&a.mainComponent.parent){var n=a.mainComponent,r=n.parent.width(),i=n.parent.height();t<1?(n.$el.css({"margin-top":(i-r*t)/2+"px","margin-left":"0px"}),n.height(r*t),n.width(r)):(n.$el.css({"margin-left":(r-i/t)/2,"margin-top":"0px"}),n.width(i/t),n.height(i))}},setImage:function(e){var t=this;if(typeof e=="string"){var n=new Image;n.onload=function(){t.texture.needsUpdate=!0,t.resize()},n.src=e,this.texture.image=n}else this.texture.image=e,e.width?(t.texture.needsUpdate=!0,t.resize()):e.onload=function(){t.texture.needsUpdate=!0,t.resize()}}});a.on("start",function(){a.setImage("../file_upload/thumb/1.jpg");var e=new Image;e.onload=function(){a.setImage(e)},e.src="../file_upload/1.jpg"});var f=0,l=0,c,h=r.manager;return h.texture=a.texture,u.computed(function(){h.enable(a.applyFilter()),a.applyFilter(h.enable())}),a}),define("modules/imagelist/index",["require","qpf","../module","text!./imagelist.xml","../common/list","./imageitem","../viewport/index"],function(e){function d(){l=Math.max(0,l-1),a.images(f.slice(l*c,Math.min(f.length,(l+1)*c)))}function v(){l=Math.min(l+1,h),a.images(f.slice(l*c,Math.min(f.length,(l+1)*c)))}var t=e("qpf"),n=t.use("knockout"),r=e("../module"),i=e("text!./imagelist.xml"),s=e("../common/list"),o=e("./imageitem"),u=e("../viewport/index"),a=new r({name:"imagelist",xml:i,images:n.observableArray(),ImageItem:o}),f,l=0,c=5,h;$.get("../file_upload/list.json",function(e){f=e,h=Math.floor(f.length/c-1e-5),a.images(f.slice(0,c))});var p;return a.$el.delegate(".qpf-ui-image-item","click",function(){var e=$(this).find("img")[0];u.setImage(e),p=new Image,p.onload=function(){u.setImage(p)},p.src=$(this).qpf("get")[0].url()}).delegate(".button-left","click",d).delegate(".button-right","click",v),a}),define("text!modules/navigator/navigator.xml",[],function(){return'<panel height="100%" id="Navigator">\n	<navlink title="Cloud" icon="cloud" class="active" href="cloud"></navlink>\n	<navlink title="Camera" icon="camera" href="camera"></navlink>\n	<navlink title="Local" icon="local" href="local"></navlink>\n</panel>'}),define("modules/navigator/navlink",["qpf"],function(){var e=require("qpf"),t=e.use("components/meta/meta"),n=e.use("knockout"),r=t.derive(function(){return{icon:n.observable(),title:n.observable(""),href:n.observable("")}},{type:"NAVLINK",css:"navlink",initialize:function(){var e=this;this.$el.click(function(t){window.location.hash="#/"+e.href()})},template:'<div class="icon" data-bind="css:icon"></div>					<div class="title" data-bind="html:title"></div>'});return t.provideBinding("navlink",r),r}),define("modules/router",["require"],function(e){var t=Router();return t.configure({recurse:"forward"}),t}),define("modules/navigator/index",["require","qpf","../module","text!./navigator.xml","./navlink","../viewport/index","../router"],function(e){function l(){function n(){console.log(arguments)}var e=o.texture;f=document.createElement("video"),e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.image=f,e.generateMipmaps=!1,o.on("beforerender",function(){e.needsUpdate=!0});var t={video:!0};navigator.getUserMedia?navigator.getUserMedia(t,function(e){f.src=e,f.play()},n):navigator.webkitGetUserMedia&&navigator.webkitGetUserMedia(t,function(e){f.src=window.webkitURL.createObjectURL(e),f.play()},n)}var t=e("qpf"),n=t.use("knockout"),r=e("../module"),i=e("text!./navigator.xml"),s=e("./navlink"),o=e("../viewport/index"),u=e("../router"),a=new r({name:"navigator",xml:i});a.$el.delegate(".qpf-ui-navlink","click",function(){var e=$(this),t=e.qpf("get")[0];if(t)switch(t.icon()){case"camera":l();break;case"cloud":switchToCloud()}a.$el.find(".qpf-ui-navlink").removeClass("active"),e.addClass("active")});var f;return a}),define("modules/common/region",["require","qpf","../router"],function(e){var t=e("qpf"),n=t.use("components/meta/meta"),r=t.use("components/base"),i=t.use("knockout"),s=e("../router"),o=r.derive(function(){return{controller:{},_moduleCache:{},_currentModule:null}},{type:"REGION",css:"region",initialize:function(){var e=this;_.each(this.controller,function(t,n){var r=t.url,i=t.context;r==="*"?e.enterModule(n,{},function(){}):(s.on("after",r,e.leaveModule.bind(e,n)),s.on(r,e.enterModule.bind(e,n,i)))})},_updateStatus:function(){var e=this,t=Array.prototype.pop.call(arguments),n=0;_.each(e._moduleCache,function(e){n++,e.__enable__?e.enable(t):e.disable(t)}),n||t()},leaveModule:function(e){var t=this._moduleCache[e],n=Array.prototype.pop.call(arguments);t&&t.disable(n)},enterModule:function(t,n){var r={},i=this,s=Array.prototype.pop.call(arguments),o=Array.prototype.slice.call(arguments,2);n&&_.each(o,function(e,t){var i=n[t];i&&(r[i]=e)});var u=this._moduleCache[t];u?(u.enable(s),u.setContext(r),this._currentModule=u,this.afterResize()):e([t],function(e){if(e&&e.start){var n=e.start();n&&i.$el.append(n),e.mainComponent.parent=i,e.enable(s),e.setContext(r),i._moduleCache[t]=e,i._currentModule=e,i.afterResize()}}),s()},afterResize:function(){this._currentModule&&this._currentModule.mainComponent&&(this._currentModule.mainComponent.width(this.$el.width()),this._currentModule.mainComponent.height(this.$el.height())),r.prototype.afterResize.call(this)}});return n.provideBinding("region",o),o}),define("text!modules/app.xml",[],function(){return'<application>\n	<vbox height="100%">\n		<hbox>\n			<region prefer="70" name="navigator" controller="@binding[navigator]"></region>\n			<vbox flex="1">\n				<region flex="1" name="viewport" controller="@binding[viewport]" style="margin:20px;"></region>\n				<region prefer="100" controller="@binding[imageList]"></region>\n			</vbox>\n			<vbox prefer="250">\n				<region prefer="100" controller="@binding[histogram]" style="margin:10px;"></region>\n				<region name="layers" controller="@binding[layers]"></region>\n			</vbox>\n			<region prefer="200" name="filters" controller="@binding[filters]"></region>\n		</hbox>\n	</vbox>\n</application>'}),define("controllerConfig",{navigator:{"modules/navigator/index":{url:"*"}},viewport:{"modules/viewport/index":{url:"*"}},filters:{"modules/filters/index":{url:"*"}},layers:{"modules/layers/index":{url:"*"}},histogram:{"modules/histogram/index":{url:"*"}},imageList:{"modules/imagelist/index":{url:"*"}}}),define("modules/common/toggle",["require","qpf"],function(e){var t=e("qpf"),n=t.use("components/meta/meta"),r=t.use("knockout"),i=n.derive(function(){return{enable:r.observable(!1)}},{type:"TOGGLE",css:"toggle",initialize:function(){this.$el.mousedown(function(e){e.preventDefault()});var e=this;this.$el.click(function(){e.enable(!e.enable())})},template:'<input type="checkbox" value="None" name="check" data-bind="checked:enable" />	 				 <label></label>'});return n.provideBinding("toggle",i),i}),define("modules/common/iconbutton",["require","qpf"],function(e){var t=e("qpf"),n=t.use("components/meta/button"),r=t.use("components/meta/meta"),i=t.use("knockout"),s=n.derive(function(){return{$el:$("<div></div>"),icon:i.observable("")}},{type:"ICONBUTTON",css:_.union("icon-button",n.prototype.css),template:'<div class="qpf-icon" data-bind="css:icon"></div>'});return r.provideBinding("iconbutton",s),s}),define("app",["require","qpf","modules/common/region","text!modules/app.xml","modules/router","./controllerConfig","modules/common/toggle","modules/common/iconbutton"],function(e){function u(){var e=t.use("knockout"),n=t.use("core/xmlparser"),o=n.parse(r);document.body.appendChild(o),e.applyBindings(s,o),i.init("/")}var t=e("qpf"),n=e("modules/common/region"),r=e("text!modules/app.xml"),i=e("modules/router"),s=e("./controllerConfig"),o=t.use("core/mixin/event");e("modules/common/toggle"),e("modules/common/iconbutton");var a={start:u};return _.extend(a,o),a});