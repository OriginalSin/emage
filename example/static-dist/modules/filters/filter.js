define(["require","qpf","knockout","text!./filter.html","../viewport/index"],function(e){var t=e("qpf"),n=t.use("widget/widget"),r=e("knockout"),i=e("text!./filter.html"),s=e("../viewport/index"),o=n.derive(function(){var e={title:r.observable(""),preview:r.observable(""),description:r.observable(""),name:r.observable(""),parameters:r.observable({}),use:function(){s.filterLayer.use(this.name());var e=this.parameters(),t=!1;if(e){s.filterLayer.set(e);var n=0;for(var r in e)if(e[r]instanceof Image){var i=e[r];i.complete||(t=!0,n++,i.onload=function(){n--,n==0&&s.update()})}}t||s.update()}};return e._previewSrc=r.computed(function(){if(e.preview())return e.preview()}),e},{type:"FILTER",css:"filter",template:i});return o});